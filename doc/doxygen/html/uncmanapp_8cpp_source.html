
<!-- checks_doxygen_header.html -->

<!-- From Sample custom Doxygen header from my_doxygen_header.html  -->-

<!-- Copyright 2011 Pierre Talbot. -->

<!-- Distributed under the Boost Software License, Version 1.0. -->
<!-- (See accompanying file LICENSE_1_0.txt or copy at          -->
<!-- http://www.boost.org/LICENSE_1_0.txt)                      -->

<html> <!-- </html> is in footer. -->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>

  <!-- Add your title here ! -->
  <title>Boost.Checks Tue Jan 17 2012 12:29:03 Boost.quan </title>

  <!-- Add your custom stylesheet here ! -->
  <link href="../checks_doxygen.css" rel="stylesheet" type="text/css"/>
  <!-- Note that this overrides any stylesheet specified in doxyfile setting HTML_STYLESHEET="mystylesheet.css" ! -->
  <link href="tabs.css" rel="stylesheet" type="text/css"/>
</head>

<!-- Add draft background here if, for example, not yet accepted or otherwise not finalised. -->
<body style="background-image: url(../../images/draft.png);">
</body>

<!-- You could also flag status by using a color? -->
<!--<body style="background-image: url(../../images/draft.png) ; color : darkblue"> -->

<!-- </body> is in footer. -->

<!-- Add your logo here or -->
<!-- Boost logo here if accepted after review, else some "Proposed for Boost" logo, for example the one below, or "proposed for Boost" ! -->
<table cellpadding="5" width="100%">
  <tbody>
    <tr>
      <td valign="top"><img alt="Proposed for Boost." src="../proposed_for_boost.png" height="80" width="250"/></td>
    </tr>
  </tbody>
</table>
<p>
  <br/>  <!-- Some space below logo, if needed. -->
</p>

<!-- Generated by Doxygen 1.7.6.1 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">J:/Cpp/Misc/Quan1/uncmanapp.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<a href="uncmanapp_8cpp.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00009"></a>00009 <span class="comment">// Copyright Paul A. Bristow 1998, 2012.</span>
<a name="l00010"></a>00010 
<a name="l00011"></a>00011 <span class="comment">// unc.cpp for for use with declarations in unc.h.</span>
<a name="l00012"></a>00012 <span class="comment">// (See test in unctest.cpp)</span>
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="preprocessor">#ifdef _MSC_VER</span>
<a name="l00015"></a>00015 <span class="preprocessor"></span><span class="preprocessor">#  pragma warning (disable : 4127) // condition expression is constant.</span>
<a name="l00016"></a>00016 <span class="preprocessor"></span><span class="preprocessor">#  pragma warning (disable : 4702) // unreachable code.</span>
<a name="l00017"></a>00017 <span class="preprocessor"></span><span class="preprocessor">#  pragma warning (disable : 4189) // local variable is initialized but not referenced.</span>
<a name="l00018"></a>00018 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00019"></a>00019 <span class="preprocessor"></span>
<a name="l00020"></a>00020 <span class="comment">// but not &lt;iomanip&gt; because defined here (as a copy of code in std::iomanip).</span>
<a name="l00021"></a>00021 <span class="preprocessor">#include &quot;../unc/unc.hpp&quot;</span>
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 <span class="preprocessor">#include &lt;functional&gt;</span> <span class="comment">// for binary_function</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">using</span> std::ostream;
<a name="l00027"></a>00027 
<a name="l00028"></a><a class="code" href="uncmanapp_8cpp.html#a676c7b527f8549b9a1159b5c17291a0a">00028</a> <span class="keyword">typedef</span> std::char_traits&lt;char&gt;::int_type <a class="code" href="uncmanapp_8cpp.html#a676c7b527f8549b9a1159b5c17291a0a">int_char</a>; <span class="comment">// for get, peek etc</span>
<a name="l00029"></a>00029 
<a name="l00030"></a>00030 <span class="comment">//  Defined in SIunits.cpp</span>
<a name="l00031"></a>00031 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_s_iunits_8cpp.html#a30b2140828093227adce3b2b8a0da747">SIprefixes</a>[<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>+1+<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];
<a name="l00032"></a>00032 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="_s_iunits_8cpp.html#a44d651cc217e356bec54cfe98c5d79aa">SIsymbols</a> [<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>+1+<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];
<a name="l00033"></a>00033 <span class="keyword">extern</span> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a> [<a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a> + 1 + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>];
<a name="l00034"></a><a class="code" href="uncmanapp_8cpp.html#a40e45aa12bcc0612336772e53dff1294">00034</a> <span class="keyword">const</span> <span class="keywordtype">double</span> <a class="code" href="uncmanapp_8cpp.html#a40e45aa12bcc0612336772e53dff1294">rounds</a> [17] = <span class="comment">// Quick lookup.</span>
<a name="l00035"></a>00035   {5.0, 5e-1, 5e-2, 5e-3, 5e-4, 5e-5, 5e-6, 5e-7, 5e-8,
<a name="l00036"></a>00036    5e-9, 5e-10, 5e-11, 5e-12, 5e-13, 5e-14, 5e-15, 5e-16}; 
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment">// Default iword() values are all zero - these may not be best,</span>
<a name="l00039"></a>00039 <span class="comment">// so set individual, for example, for 3 sigfigs, os.iword(sigFigsIndex) = 3;</span>
<a name="l00040"></a>00040 <span class="comment">// Function setUncDefaults() does this.</span>
<a name="l00041"></a>00041 <span class="comment">// Note index values must already have been initialised by xalloc calls.</span>
<a name="l00042"></a><a class="code" href="uncmanapp_8cpp.html#a34fc33a216bcb331ef4eb2c42b27f757">00042</a> <span class="keyword">const</span> <span class="keywordtype">long</span> <a class="code" href="_test_quan1_8cpp.html#a34fc33a216bcb331ef4eb2c42b27f757">indexID</a> = 0x48dbaf8;  <span class="comment">// Random id to check this initialisation done OK.</span>
<a name="l00043"></a>00043 <span class="comment">// Can&#39;t use random here because must be const?</span>
<a name="l00044"></a>00044 
<a name="l00045"></a><a class="code" href="uncmanapp_8cpp.html#a5b0f35497ed1de528093784d25448ed4">00045</a> <span class="keywordtype">void</span> <a class="code" href="uncmanapp_8cpp.html#a5b0f35497ed1de528093784d25448ed4">setUncDefaults</a>(std::ios&amp; stream)  <span class="comment">// Usage: setUncDefaults(cout);</span>
<a name="l00046"></a>00046 {
<a name="l00047"></a>00047   <span class="keywordflow">if</span> (<span class="keyword">true</span>)
<a name="l00048"></a>00048   {  <span class="comment">// Set 16 default values.</span>
<a name="l00049"></a>00049     stream.iword(<a class="code" href="_test_quan1_8cpp.html#a357cabd77dda683e78113f19c75869e6">zeroIndex</a>) = <a class="code" href="_test_quan1_8cpp.html#a34fc33a216bcb331ef4eb2c42b27f757">indexID</a>; <span class="comment">// Mark to show that it has been set to defaults.</span>
<a name="l00050"></a>00050     stream.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = 0;  <span class="comment">// iword(1)</span>
<a name="l00051"></a>00051     <span class="comment">// Defaults:</span>
<a name="l00052"></a>00052     <span class="comment">// flex, not set scaled, not autoscaled, not +/-,</span>
<a name="l00053"></a>00053     <span class="comment">// no symbol or prefix, no Noisy, not setSigfigs</span>
<a name="l00054"></a>00054     stream.iword(<a class="code" href="unc_init_8cpp.html#aa63c3a092935f69ee315002c5181f8e6">sigFigsIndex</a>) = 3;  <span class="comment">// Default 3 sig figs.</span>
<a name="l00055"></a>00055     stream.iword(<a class="code" href="unc_init_8cpp.html#abb85e035433d423441cca46a1410eb56">setSigFigsIndex</a>) = 3;  <span class="comment">// Default set 3 sig figs.</span>
<a name="l00056"></a>00056     stream.iword(<a class="code" href="_test_quan1_8cpp.html#a7edb6c5c7929c3cde8986c34985cd884">uncWidthIndex</a>) = 10;  <span class="comment">// Default width 10 to allow +1.234E12_</span>
<a name="l00057"></a>00057     stream.iword(<a class="code" href="unc_init_8cpp.html#a671dfc3c8fb2f20b52981a62f88a200e">uncSetWidthIndex</a>) = 0;  <span class="comment">// Not used</span>
<a name="l00058"></a>00058     stream.iword(<a class="code" href="unc_init_8cpp.html#a7a01c86a0d10789b38c2635118e80111">uncScaleIndex</a>) = 0;  <span class="comment">// Zero scaling means was not scaled.</span>
<a name="l00059"></a>00059     stream.iword(<a class="code" href="unc_init_8cpp.html#ab19a26cad50b9d4c92873496706e98f9">uncSetScaleIndex</a>) = 0;  <span class="comment">// Zero scaling means not scaled.</span>
<a name="l00060"></a>00060     stream.iword(<a class="code" href="unc_init_8cpp.html#a540ce31a9e583612c03e63e1bc11cf82">uncUsedIndex</a>) = 0; <span class="comment">//  None used.</span>
<a name="l00061"></a>00061     <span class="comment">// Previous values.</span>
<a name="l00062"></a>00062     stream.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = 0;  <span class="comment">// 0xFFFFFFFF to mean not valid?</span>
<a name="l00063"></a>00063     stream.iword(<a class="code" href="unc_init_8cpp.html#a3f9aa2e7a8a498537b121000d91d19d4">uncOldWidthIndex</a>) = 0;
<a name="l00064"></a>00064     stream.iword(<a class="code" href="unc_init_8cpp.html#a583f0dc2d61a066d7b984e5388f8ece6">uncOldScaleIndex</a>) = 0;
<a name="l00065"></a>00065     stream.iword(<a class="code" href="unc_init_8cpp.html#aa311b745e265500aedddb1faee22e427">oldSigFigsIndex</a>) = 0;  <span class="comment">//  No previous value.</span>
<a name="l00066"></a>00066     stream.iword(<a class="code" href="_test_quan1_8cpp.html#ad618eda6e95462f32dea23b4bb3e80ac">oldUncUsedIndex</a>) = 0;  <span class="comment">//  No previous value.</span>
<a name="l00067"></a>00067     stream.iword(<a class="code" href="unc_init_8cpp.html#ae9f0027728a2ad546badb0363f3c9590">uncSigFigsIndex</a>) = 2;  <span class="comment">// Default 2 sig figs.</span>
<a name="l00068"></a>00068     stream.iword(<a class="code" href="unc_init_8cpp.html#a463d9bd876b30d86f0169360307a55c3">oldUncSigFigsIndex</a>) = 0;  <span class="comment">// No previous value.</span>
<a name="l00069"></a>00069     stream.iword(<a class="code" href="_test_quan1_8cpp.html#a8af718bd2e2db69efcec51e53e5271ae">topIndex</a>) = <a class="code" href="_test_quan1_8cpp.html#a34fc33a216bcb331ef4eb2c42b27f757">indexID</a>;  <span class="comment">// last .iword(16) as check</span>
<a name="l00070"></a>00070   }
<a name="l00071"></a>00071   <span class="keywordflow">else</span>
<a name="l00072"></a>00072   {
<a name="l00073"></a>00073     cerr &lt;&lt; <span class="stringliteral">&quot;stream.iword(0) = &quot;</span> &lt;&lt; stream.iword(0)
<a name="l00074"></a>00074     &lt;&lt; <span class="stringliteral">&quot; not expected ID &quot;</span> &lt;&lt; hex &lt;&lt; <a class="code" href="_test_quan1_8cpp.html#a34fc33a216bcb331ef4eb2c42b27f757">indexID</a> &lt;&lt; endl;
<a name="l00075"></a>00075   }
<a name="l00076"></a>00076 }
<a name="l00077"></a>00077 
<a name="l00078"></a><a class="code" href="uncmanapp_8cpp.html#a738d7542556b700aff149e232850d1b7">00078</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="uncmanapp_8cpp.html#a738d7542556b700aff149e232850d1b7">uncTypeWords</a>[16] = {  <span class="comment">// Descriptions of each bit.</span>
<a name="l00079"></a>00079   <span class="comment">// see enum unctypes</span>
<a name="l00080"></a>00080   <span class="stringliteral">&quot;zero&quot;</span>, <span class="comment">//   VALUE_ZERO = 1 &lt;&lt; 0, // Too near zero to allow relsd = sd /mean</span>
<a name="l00081"></a>00081   <span class="stringliteral">&quot;int&quot;</span>,  <span class="comment">//  VALUE_INTEGER = 1 &lt;&lt; 1, // Exact integer 2,3,4 ... may not be possible to store.</span>
<a name="l00082"></a>00082   <span class="stringliteral">&quot;rational&quot;</span>, <span class="comment">//  VALUE_RATIONAL = 1 &lt;&lt; 2, // Integers &amp; Fractions 1/2, 1/3, 2/3, 5/4 ...</span>
<a name="l00083"></a>00083   <span class="stringliteral">&quot;-only&quot;</span>, <span class="comment">// VALUE_NEGATIVE_ONLY = 1 &lt;&lt; 3, // Value can ONLY be &lt; 0.0. ? or &lt;=0?</span>
<a name="l00084"></a>00084   <span class="stringliteral">&quot;+only&quot;</span>,  <span class="comment">// VALUE_POSITIVE_ONLY = 1 &lt;&lt; 4, // Value can ONLY be &gt;=0.0.</span>
<a name="l00085"></a>00085   <span class="stringliteral">&quot;unc_known&quot;</span>, <span class="comment">//  UNC_KNOWN = 1 &lt;&lt; 5,    // Uncertainty known (but if not value may known OK).</span>
<a name="l00086"></a>00086   <span class="stringliteral">&quot;noPlus&quot;</span>, <span class="comment">// UNC_NOPLUS = 1 &lt;&lt; 6, // Uncertainty can only be &lt; value, + = zero.</span>
<a name="l00087"></a>00087   <span class="stringliteral">&quot;noMinus&quot;</span>,  <span class="comment">// UNC_NOMINUS = 1 &lt;&lt; 7, // Uncertainty can only be &gt; value - = zero.</span>
<a name="l00088"></a>00088   <span class="stringliteral">&quot;quantize10&quot;</span>, <span class="comment">// UNC_QUAN_DECIMAL = 1 &lt;&lt; 8, // Quantised by least significant decimal digit.</span>
<a name="l00089"></a>00089   <span class="stringliteral">&quot;quantize2&quot;</span>,  <span class="comment">// UNC_QUAN_BINARY = 1 &lt;&lt; 9, // Quantised by least significant binary digit.</span>
<a name="l00090"></a>00090   <span class="stringliteral">&quot;explicit&quot;</span>, <span class="comment">// UNC_EXPLICIT = 1 &lt;&lt; 0xA, //If bit set = 1, uncertainty implicit from sig figs.</span>
<a name="l00091"></a>00091   <span class="stringliteral">&quot;rect&quot;</span>, <span class="comment">// UNC_RECTANGULAR = 1 &lt;&lt; 0xB, // Uncertainty has rectangular probability distribution.</span>
<a name="l00092"></a>00092   <span class="stringliteral">&quot;triang&quot;</span>, <span class="comment">// UNC_TRIANGULAR = 1 &lt;&lt; 0xC, // Uncertainty has triangular probability distribution.</span>
<a name="l00093"></a>00093   <span class="stringliteral">&quot;df_exact&quot;</span>,   <span class="comment">// DEG_FREE_EXACT = 1 &lt;&lt; 0xD, // Known number of observations -1,</span>
<a name="l00094"></a>00094   <span class="stringliteral">&quot;df_known&quot;</span>, <span class="comment">// DEG_FREE_KNOWN = 1 &lt;&lt; 0xE, // Degrees of freedom defined.</span>
<a name="l00095"></a>00095   <span class="stringliteral">&quot;undefined&quot;</span> <span class="comment">// SPARE = 1 &lt;&lt; 0xF // This unc_type is spare.</span>
<a name="l00096"></a>00096 }; <span class="comment">// const char* uncTypeWords</span>
<a name="l00097"></a>00097 
<a name="l00098"></a><a class="code" href="uncmanapp_8cpp.html#a419a0b45441b5d8785390d6382b8955d">00098</a> <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="uncmanapp_8cpp.html#a419a0b45441b5d8785390d6382b8955d">uncFlagWords</a>[16] =
<a name="l00099"></a>00099 { <span class="comment">// See enum uncFlag</span>
<a name="l00100"></a>00100   <span class="stringliteral">&quot;firm&quot;</span>, <span class="comment">// firm or flex, bit 0</span>
<a name="l00101"></a>00101   <span class="stringliteral">&quot;setScaled&quot;</span>, <span class="comment">// bit 1</span>
<a name="l00102"></a>00102   <span class="stringliteral">&quot;autoScaled&quot;</span>, <span class="comment">//bit 2</span>
<a name="l00103"></a>00103   <span class="stringliteral">&quot;add +/-&quot;</span>, <span class="comment">// bit 3</span>
<a name="l00104"></a>00104   <span class="stringliteral">&quot;add SI symbol&quot;</span>, <span class="comment">// bit 4</span>
<a name="l00105"></a>00105   <span class="stringliteral">&quot;add SI prefix&quot;</span>, <span class="comment">// bit 5</span>
<a name="l00106"></a>00106   <span class="stringliteral">&quot;add noisy&quot;</span>, <span class="comment">// bit 6</span>
<a name="l00107"></a>00107   <span class="stringliteral">&quot;set sigfig&quot;</span>, <span class="comment">// bit 7</span>
<a name="l00108"></a>00108   <span class="stringliteral">&quot;set uncsigfig&quot;</span>, <span class="comment">// bit 8</span>
<a name="l00109"></a>00109   <span class="stringliteral">&quot;add deg free&quot;</span>, <span class="comment">// bit 9</span>
<a name="l00110"></a>00110   <span class="stringliteral">&quot;add replicates&quot;</span>, <span class="comment">// bit 0xA</span>
<a name="l00111"></a>00111   <span class="stringliteral">&quot;add limits&quot;</span>, <span class="comment">// bit 0xB</span>
<a name="l00112"></a>00112   <span class="stringliteral">&quot;?&quot;</span>, <span class="comment">// spare // bit 0xC</span>
<a name="l00113"></a>00113   <span class="stringliteral">&quot;?&quot;</span>, <span class="comment">// spare bit 0xD</span>
<a name="l00114"></a>00114   <span class="stringliteral">&quot;?&quot;</span>, <span class="comment">// spare 0xE</span>
<a name="l00115"></a>00115   <span class="stringliteral">&quot;?&quot;</span> <span class="comment">// spare 0xF</span>
<a name="l00116"></a>00116 }; <span class="comment">// const char* uncFlagWords</span>
<a name="l00117"></a>00117 
<a name="l00118"></a><a class="code" href="uncmanapp_8cpp.html#a0d41328b3f1aa71eb45e12c2af1b9c11">00118</a> <span class="keywordtype">void</span> <a class="code" href="uncmanapp_8cpp.html#a0d41328b3f1aa71eb45e12c2af1b9c11">outUncFlags</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> uncFlags, ostream&amp; os)
<a name="l00119"></a>00119 {<span class="comment">// Usage:      outUncFlags(uReal.getUncTypes(), cerr); // logs to cerr.</span>
<a name="l00120"></a>00120   <span class="keyword">const</span> <span class="keywordtype">int</span> up = 8; <span class="comment">// Words across page.</span>
<a name="l00121"></a>00121   <span class="keyword">const</span> <span class="keywordtype">int</span> count = 16;  <span class="comment">// cos using unsigned short int.</span>
<a name="l00122"></a>00122   os &lt;&lt; <span class="stringliteral">&quot;uncFlags (0x&quot;</span> &lt;&lt; hex &lt;&lt; uncFlags &lt;&lt; dec &lt;&lt; <span class="stringliteral">&quot;) &quot;</span> ; <span class="comment">// hex value.</span>
<a name="l00123"></a>00123   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0, j = 1, hit = 0; i &lt; count; ++i)
<a name="l00124"></a>00124   {
<a name="l00125"></a>00125     <span class="keywordflow">if</span> ((uncFlags &amp; j) != 0)
<a name="l00126"></a>00126     {
<a name="l00127"></a>00127       <span class="keywordflow">if</span> (hit == 0)
<a name="l00128"></a>00128       { <span class="comment">// First word no separator.</span>
<a name="l00129"></a>00129         os &lt;&lt; <span class="charliteral">&#39; &#39;</span>;
<a name="l00130"></a>00130       }
<a name="l00131"></a>00131       <span class="keywordflow">else</span>
<a name="l00132"></a>00132       {
<a name="l00133"></a>00133         os &lt;&lt; (( (hit % up) == 0) ? <span class="stringliteral">&quot;,\n&quot;</span> : <span class="stringliteral">&quot;, &quot;</span>);
<a name="l00134"></a>00134       }
<a name="l00135"></a>00135       os        &lt;&lt; <a class="code" href="uncmanapp_8cpp.html#a419a0b45441b5d8785390d6382b8955d">uncFlagWords</a>[i];
<a name="l00136"></a>00136       ++hit; <span class="comment">// Count to add space or newline as appropriate.</span>
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138     j &lt;&lt;= 1;
<a name="l00139"></a>00139   }
<a name="l00140"></a>00140   os &lt;&lt; decimal_point;
<a name="l00141"></a>00141 }  <span class="comment">// outUncFlags</span>
<a name="l00142"></a>00142 
<a name="l00143"></a><a class="code" href="uncmanapp_8cpp.html#a90e5b288b2bb830474bf1d5d12ee9a06">00143</a> <span class="keywordtype">void</span> <a class="code" href="uncmanapp_8cpp.html#a90e5b288b2bb830474bf1d5d12ee9a06">outUncTypes</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> uncTypes, ostream&amp; os)
<a name="l00144"></a>00144 {<span class="comment">// Usage:      outUncTypes(uReal.getUncTypes(), cerr); // logs to cerr.</span>
<a name="l00145"></a>00145   <span class="keyword">const</span> <span class="keywordtype">int</span> up = 8; <span class="comment">// Words across page.</span>
<a name="l00146"></a>00146   <span class="keyword">const</span> <span class="keywordtype">int</span> count = 16;  <span class="comment">// cos using unsigned short int.</span>
<a name="l00147"></a>00147   os &lt;&lt; <span class="stringliteral">&quot;uncTypes (0x&quot;</span> &lt;&lt; hex &lt;&lt; uncTypes &lt;&lt; dec &lt;&lt; <span class="stringliteral">&quot;) &quot;</span>; <span class="comment">// hex value </span>
<a name="l00148"></a>00148   <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0, j = 1, hit = 0; i &lt; count; ++i)
<a name="l00149"></a>00149   {
<a name="l00150"></a>00150     <span class="keywordflow">if</span> ((uncTypes &amp; j) != 0)
<a name="l00151"></a>00151     {
<a name="l00152"></a>00152       <span class="keywordflow">if</span> (hit == 0)
<a name="l00153"></a>00153       { <span class="comment">// First word no separator.</span>
<a name="l00154"></a>00154         os &lt;&lt; <span class="charliteral">&#39; &#39;</span>;
<a name="l00155"></a>00155       }
<a name="l00156"></a>00156       <span class="keywordflow">else</span>
<a name="l00157"></a>00157       {
<a name="l00158"></a>00158         os &lt;&lt; (( (hit % up) == 0) ? <span class="stringliteral">&quot;,\n&quot;</span> : <span class="stringliteral">&quot;, &quot;</span>);
<a name="l00159"></a>00159       }
<a name="l00160"></a>00160       os        &lt;&lt; <a class="code" href="uncmanapp_8cpp.html#a738d7542556b700aff149e232850d1b7">uncTypeWords</a>[i];
<a name="l00161"></a>00161       ++hit; <span class="comment">// Count to add space or newline as appropriate.</span>
<a name="l00162"></a>00162     }
<a name="l00163"></a>00163     j &lt;&lt;= 1;
<a name="l00164"></a>00164   } <span class="comment">// for i</span>
<a name="l00165"></a>00165   os &lt;&lt; decimal_point;
<a name="l00166"></a>00166 }  <span class="comment">// outUncTypes</span>
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 showUncTypes::showUncTypes(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> t) : unc(t) {} <span class="comment">// Constructor.</span>
<a name="l00169"></a>00169 <span class="comment">// Usage: out &lt;&lt; showUncTypes(uncTypes) ...</span>
<a name="l00170"></a>00170 
<a name="l00171"></a><a class="code" href="uncmanapp_8cpp.html#a011933b95b06a0fc126aef12311f05d2">00171</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> showUncTypes&amp; ut)  <span class="comment">// Define.</span>
<a name="l00172"></a>00172 {
<a name="l00173"></a>00173   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> uncTypes = ut.unc;
<a name="l00174"></a>00174   <a class="code" href="uncmanapp_8cpp.html#a90e5b288b2bb830474bf1d5d12ee9a06">outUncTypes</a>(uncTypes, os);
<a name="l00175"></a>00175   <span class="keywordflow">return</span> os;
<a name="l00176"></a>00176 }  <span class="comment">// ostream&amp; operator&lt;&lt; (ostream&amp; os, const showUncTypes&amp; ut)  // Define.</span>
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 
<a name="l00179"></a>00179 <span class="comment">// Manipulator showUncFlags. Usage: out &lt;&lt; showUncFlags(flags)</span>
<a name="l00180"></a>00180 <span class="comment">// (See also below for parameterless manipulator showuncflags:</span>
<a name="l00181"></a>00181 <span class="comment">// Usage: out &lt;&lt; showuncflags ...)</span>
<a name="l00182"></a>00182 
<a name="l00183"></a>00183 <span class="comment">// Class showUncFlags, whose name is that of the manipulator &amp; &lt;&lt; &gt;&gt; operators,</span>
<a name="l00184"></a>00184 <span class="comment">// Class defined in unc.h header, but not the constructor.</span>
<a name="l00185"></a>00185 showUncFlags::showUncFlags(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> f) : flags(f) {} <span class="comment">// Constructor.</span>
<a name="l00186"></a>00186 <span class="comment">// Usage: out &lt;&lt; showUncFlags(flags) ...</span>
<a name="l00187"></a>00187 
<a name="l00188"></a><a class="code" href="uncmanapp_8cpp.html#ab167b372636bb37ae6cbd715561963b7">00188</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> showUncFlags&amp; sf)  <span class="comment">// Define.</span>
<a name="l00189"></a>00189 { <span class="comment">// Output current unc Flags for this ostream.</span>
<a name="l00190"></a>00190   <span class="keywordtype">int</span> uncFlags = sf.flags;
<a name="l00191"></a>00191   <a class="code" href="uncmanapp_8cpp.html#a0d41328b3f1aa71eb45e12c2af1b9c11">outUncFlags</a>(static_cast&lt;unsigned short&gt;(uncFlags), os);
<a name="l00192"></a>00192   <span class="keywordflow">return</span> os;
<a name="l00193"></a>00193 }
<a name="l00194"></a>00194 
<a name="l00195"></a><a class="code" href="uncmanapp_8cpp.html#a3024205ba450d9dc9097d00d880207cd">00195</a> ostream&amp; <a class="code" href="uncmanapp_8cpp.html#a3024205ba450d9dc9097d00d880207cd">showuncflags</a>(ostream&amp; os)
<a name="l00196"></a>00196 { <span class="comment">// Show unc stream state in words for this stream.</span>
<a name="l00197"></a>00197   <span class="comment">// Usage: cout &lt;&lt; showuncflags ...</span>
<a name="l00198"></a>00198   os  &lt;&lt; showUncFlags(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>)));
<a name="l00199"></a>00199   <span class="keywordflow">return</span> os;
<a name="l00200"></a>00200 }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="comment">// Parameterless manipulators to switch format to switch uncFlag bits, </span>
<a name="l00203"></a>00203 <span class="comment">// flex - width just enough to display, suitable for non-tables,</span>
<a name="l00204"></a>00204 <span class="comment">// or firm to fit into a set width, suitable for tables,</span>
<a name="l00205"></a>00205 <span class="comment">// &amp; similarly for scale and autoscale flag bits.</span>
<a name="l00206"></a>00206 <span class="comment">// Note all lowercase names to match ios convention of hex, oct ...</span>
<a name="l00207"></a>00207 
<a name="l00208"></a><a class="code" href="uncmanapp_8cpp.html#a52ded102488994be03061860a37e4c74">00208</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a0b82224c0dd5b59beab5f6b339e10c9e">flexform</a>(ios&amp; iostr)
<a name="l00209"></a>00209 {
<a name="l00210"></a>00210   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda88b7d5932278a29836942737aca6888d">firm</a>;  <span class="comment">// clear bit 0 = 0 to mean flex.</span>
<a name="l00211"></a>00211   <span class="keywordflow">return</span> (iostr);
<a name="l00212"></a>00212 }
<a name="l00213"></a>00213 
<a name="l00214"></a><a class="code" href="uncmanapp_8cpp.html#a1e6f1b463fe919ac21bc3f4135cb93fa">00214</a> ios&amp; <a class="code" href="unc___types_8cpp.html#ad5fbe1b32bd3335b54b32f2b419d78a4">firmform</a>(ios&amp; iostr)
<a name="l00215"></a>00215 {
<a name="l00216"></a>00216   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda88b7d5932278a29836942737aca6888d">firm</a>;  <span class="comment">// set bit 0 = 1 to mean firm not flex.</span>
<a name="l00217"></a>00217   <span class="keywordflow">return</span> (iostr);
<a name="l00218"></a>00218 }
<a name="l00219"></a>00219 
<a name="l00220"></a><a class="code" href="uncmanapp_8cpp.html#a938506fdaa4286a2ba1051e3426a53f6">00220</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a8154734576f584dc995a706c2ea867c3">scale</a>(ios&amp; iostr)
<a name="l00221"></a>00221 {
<a name="l00222"></a>00222   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda4f01a573a3bde4134360c61b86e0deb9">setScaled</a>;  <span class="comment">// set bit 1 = 1 to mean scaled.</span>
<a name="l00223"></a>00223   <span class="keywordflow">return</span> (iostr);
<a name="l00224"></a>00224 }
<a name="l00225"></a>00225 
<a name="l00226"></a><a class="code" href="uncmanapp_8cpp.html#a5b1d519244c1486ba7a0f99aff2fdb10">00226</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a6767a25d6901fc06484bbab1feceaca0">noscale</a>(ios&amp; iostr)
<a name="l00227"></a>00227 {
<a name="l00228"></a>00228   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda4f01a573a3bde4134360c61b86e0deb9">setScaled</a>;  <span class="comment">// clear bit 1 = 0 to mean not scaled.</span>
<a name="l00229"></a>00229   <span class="keywordflow">return</span> (iostr);
<a name="l00230"></a>00230 }
<a name="l00231"></a>00231 
<a name="l00232"></a><a class="code" href="uncmanapp_8cpp.html#a90ff4551cb73c2a7a4a95c1217526c59">00232</a> ios&amp; <a class="code" href="unc___types_8cpp.html#afb4bb655697f3c53acde9c8b1e17066a">autoscale</a>(ios&amp; iostr)
<a name="l00233"></a>00233 {
<a name="l00234"></a>00234   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdabcf7e726f642019083e91a3e3b394bfc">autoScaled</a>;  <span class="comment">// set bit 2 = 1 to mean auto.</span>
<a name="l00235"></a>00235   <span class="keywordflow">return</span> (iostr);
<a name="l00236"></a>00236 }
<a name="l00237"></a>00237 
<a name="l00238"></a><a class="code" href="uncmanapp_8cpp.html#ad489d9b7c9e8776abfc1d7fa2ed29ba0">00238</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a989190729b7cd497a9bddc6804ee0a8a">noautoscale</a>(ios&amp; iostr)
<a name="l00239"></a>00239 {
<a name="l00240"></a>00240   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdabcf7e726f642019083e91a3e3b394bfc">autoScaled</a>;  <span class="comment">// clear bit 2 = 0 to mean fixed.</span>
<a name="l00241"></a>00241   <span class="keywordflow">return</span> (iostr);
<a name="l00242"></a>00242 }
<a name="l00243"></a>00243 
<a name="l00244"></a><a class="code" href="uncmanapp_8cpp.html#aa2a23e457c4eef4832f0376791c55473">00244</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a7b7ae90ee1ba3568cacc4eeda241ec8c">plusminus</a>(ios&amp; iostr)
<a name="l00245"></a>00245 {
<a name="l00246"></a>00246   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda8df10473f985e1e141fe13ce1da4b2e7">plusMinus</a>;  <span class="comment">// set bit 3 = 1 to mean plusminus add +/-.</span>
<a name="l00247"></a>00247   <span class="keywordflow">return</span> (iostr);
<a name="l00248"></a>00248 }
<a name="l00249"></a>00249 
<a name="l00250"></a><a class="code" href="uncmanapp_8cpp.html#a535018f6a45f45fd3b6b5579819271c7">00250</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a4814c9eeb14afbf91af19207c33d5101">noplusminus</a>(ios&amp; iostr)
<a name="l00251"></a>00251 {
<a name="l00252"></a>00252   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda8df10473f985e1e141fe13ce1da4b2e7">plusMinus</a>;  <span class="comment">// clear bit 3 = 0 to mean Do NOT add +/-.</span>
<a name="l00253"></a>00253   <span class="keywordflow">return</span> (iostr);
<a name="l00254"></a>00254 }
<a name="l00255"></a>00255 
<a name="l00256"></a><a class="code" href="uncmanapp_8cpp.html#a6701fb82d305daf2349d635c020dbc4f">00256</a> ios&amp; <a class="code" href="unc___types_8cpp.html#afeb37375291e658c420b02248f51d01a">addSIsymbol</a>(ios&amp; iostr)
<a name="l00257"></a>00257 {
<a name="l00258"></a>00258   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda6baa1727b244f9c27c5fa1ffcac571d0">addSISymbol</a>;  <span class="comment">// set bit 4 = 1 to add SI symbol.</span>
<a name="l00259"></a>00259   <span class="keywordflow">return</span> (iostr);
<a name="l00260"></a>00260 }
<a name="l00261"></a>00261 
<a name="l00262"></a><a class="code" href="uncmanapp_8cpp.html#ada7f23ddb513fe765aba9109f58bd8cc">00262</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a63a10346e6af01465aadf7f7072f6039">noSIsymbol</a>(ios&amp; iostr)
<a name="l00263"></a>00263 {
<a name="l00264"></a>00264   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda6baa1727b244f9c27c5fa1ffcac571d0">addSISymbol</a>;  <span class="comment">// clear bit 4 = 0 for no SI symbol.</span>
<a name="l00265"></a>00265   <span class="keywordflow">return</span> (iostr);
<a name="l00266"></a>00266 }
<a name="l00267"></a>00267 
<a name="l00268"></a><a class="code" href="uncmanapp_8cpp.html#a9027da3b9026fa533b0e1b800bc08fc9">00268</a> ios&amp; <a class="code" href="unc___types_8cpp.html#ae141c48cc091f23ca21fdb61072ea38e">addSIprefix</a>(ios&amp; iostr)
<a name="l00269"></a>00269 { <span class="comment">// Prefix like kilo used rather than symbol k if both SI prefix &amp; symbol set.</span>
<a name="l00270"></a>00270   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdac5a6d576327602677949982970a66740">addSIPrefix</a>;  <span class="comment">// set bit 5 = 1 to add SI prefix</span>
<a name="l00271"></a>00271   <span class="keywordflow">return</span> (iostr);
<a name="l00272"></a>00272 }
<a name="l00273"></a>00273 
<a name="l00274"></a><a class="code" href="uncmanapp_8cpp.html#ab220d904fa63efccb409d2b555d6d5ac">00274</a> ios&amp; <a class="code" href="unc___types_8cpp.html#ada11ec6fc49f46a2e81ec3b3e6152a1a">noSIprefix</a>(ios&amp; iostr)
<a name="l00275"></a>00275 {
<a name="l00276"></a>00276   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdac5a6d576327602677949982970a66740">addSIPrefix</a>;  <span class="comment">// clear bit 5 = 0 for NO prefix.</span>
<a name="l00277"></a>00277   <span class="keywordflow">return</span> (iostr);
<a name="l00278"></a>00278 }
<a name="l00279"></a>00279 
<a name="l00280"></a><a class="code" href="uncmanapp_8cpp.html#ad2c532128c0115135f8767034248964f">00280</a> ios&amp; <a class="code" href="unc___types_8cpp.html#ae70047c2b1966cdba174025d85fa30e0">addNoisyDigit</a>(ios&amp; iostr)
<a name="l00281"></a>00281 {
<a name="l00282"></a>00282   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdab5a6082eb1bac1b504465d874da18664">noisyDigit</a>;  <span class="comment">// set bit 6 = 1 to add noisy digit</span>
<a name="l00283"></a>00283   <span class="keywordflow">return</span> (iostr);
<a name="l00284"></a>00284 }
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="uncmanapp_8cpp.html#ad02b6aa3a096b61d4b7fa231cb0719f0">00286</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a9f951714a00c20ed81f110eeaf4de116">noNoisyDigit</a>(ios&amp; iostr)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdab5a6082eb1bac1b504465d874da18664">noisyDigit</a>;  <span class="comment">// clear bit 6 = 0 for NO noisy digit.</span>
<a name="l00289"></a>00289   <span class="keywordflow">return</span> (iostr);
<a name="l00290"></a>00290 }
<a name="l00291"></a>00291 
<a name="l00292"></a><a class="code" href="uncmanapp_8cpp.html#aa5bb98686478cf69af799c32646e24d6">00292</a> ios&amp; <a class="code" href="unc___types_8cpp.html#ae541169bdaf6afcfc73cc09163b4f50c">setsigfigs</a>(ios&amp; iostr)
<a name="l00293"></a>00293 {
<a name="l00294"></a>00294   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdacfd989abc9a1f8981aa18c4a7961c1ec">setSigFig</a>;  <span class="comment">// set bit 7 = 1 to use set sigfigs</span>
<a name="l00295"></a>00295   <span class="keywordflow">return</span> (iostr);
<a name="l00296"></a>00296 }
<a name="l00297"></a>00297 
<a name="l00298"></a><a class="code" href="uncmanapp_8cpp.html#a5ca8b5591b0a39eda72a4aef7b1c4446">00298</a> ios&amp; <a class="code" href="unc___types_8cpp.html#afa564bb459b9c9fc328d54f3a4b92602">autosigfigs</a>(ios&amp; iostr)
<a name="l00299"></a>00299 {
<a name="l00300"></a>00300   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdacfd989abc9a1f8981aa18c4a7961c1ec">setSigFig</a>;  <span class="comment">// clear bit 7 = 0 for auto sigfigs</span>
<a name="l00301"></a>00301   <span class="keywordflow">return</span> (iostr);
<a name="l00302"></a>00302 }
<a name="l00303"></a>00303 
<a name="l00304"></a><a class="code" href="uncmanapp_8cpp.html#aecec025c55a8db99a67846b388748c41">00304</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a643ffb3fac6c9f07452de5281ca44fd2">setuncsigfigs</a>(ios&amp; iostr)
<a name="l00305"></a>00305 {
<a name="l00306"></a>00306   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaf4ddab58ce26b9216745d277e6016a62">setUncSigFig</a>;  <span class="comment">// set bit 8 = 1 to use set uncsigfigs</span>
<a name="l00307"></a>00307   <span class="keywordflow">return</span> (iostr);
<a name="l00308"></a>00308 }
<a name="l00309"></a>00309 
<a name="l00310"></a><a class="code" href="uncmanapp_8cpp.html#af5029c0b8fe57c31c4210b5cecc7453d">00310</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a2e7a3f9724ea296d1231d8aac87c8f65">autouncsigfigs</a>(ios&amp; iostr)
<a name="l00311"></a>00311 {
<a name="l00312"></a>00312   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaf4ddab58ce26b9216745d277e6016a62">setUncSigFig</a>;  <span class="comment">// clear bit 8 = 0 for auto unc sigfigs</span>
<a name="l00313"></a>00313   <span class="keywordflow">return</span> (iostr);
<a name="l00314"></a>00314 }
<a name="l00315"></a>00315 
<a name="l00316"></a><a class="code" href="uncmanapp_8cpp.html#a8477ec80390d525093fdb2677c446780">00316</a> ios&amp; <a class="code" href="unc___types_8cpp.html#af773e9fcd7ebc670da23549e4062dcde">adddegfree</a>(ios&amp; iostr)
<a name="l00317"></a>00317 {
<a name="l00318"></a>00318   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaac97fd648aedffb05975e58a9531eee9">degfree</a>;  <span class="comment">// set bit 9 = 1 to mean show degrees of freedom.</span>
<a name="l00319"></a>00319   <span class="keywordflow">return</span> (iostr);
<a name="l00320"></a>00320 }
<a name="l00321"></a>00321 
<a name="l00322"></a><a class="code" href="uncmanapp_8cpp.html#a5b03a40388055d3a32cefc75033b9007">00322</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a220e13d4a356fe81522363280abf75cd">nodegfree</a>(ios&amp; iostr)
<a name="l00323"></a>00323 {
<a name="l00324"></a>00324   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaac97fd648aedffb05975e58a9531eee9">degfree</a>;  <span class="comment">// clear bit 9 = 0 to mean no degrees of freedom.</span>
<a name="l00325"></a>00325   <span class="keywordflow">return</span> (iostr);
<a name="l00326"></a>00326 }
<a name="l00327"></a>00327 
<a name="l00328"></a><a class="code" href="uncmanapp_8cpp.html#abe6638fbaafe5dbab495583d2d2b388b">00328</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a05269f75c823a46d18d8cc4fa65ae3a6">addreplicates</a>(ios&amp; iostr)
<a name="l00329"></a>00329 {  <span class="comment">// Only show degrees of freedom if &gt; 1.</span>
<a name="l00330"></a>00330   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaff39f67935d3386b19b8a89be2eb711a">replicates</a>;  <span class="comment">// set bit 0xA = 1 to mean show degrees of freedom &gt; 1.</span>
<a name="l00331"></a>00331   <span class="keywordflow">return</span> (iostr);
<a name="l00332"></a>00332 }
<a name="l00333"></a>00333 
<a name="l00334"></a><a class="code" href="uncmanapp_8cpp.html#a8e42c396246beebc44e4c6cd22b25db7">00334</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a9250bd5968204e67c008b19df48f85a2">noreplicates</a>(ios&amp; iostr)
<a name="l00335"></a>00335 {
<a name="l00336"></a>00336   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaff39f67935d3386b19b8a89be2eb711a">replicates</a>;  <span class="comment">// clear bit 0xA = 0 to mean no degrees of freedom &gt;1.</span>
<a name="l00337"></a>00337   <span class="comment">// BUT still show degrees of freedom if required.</span>
<a name="l00338"></a>00338   <span class="keywordflow">return</span> (iostr);
<a name="l00339"></a>00339 }
<a name="l00340"></a>00340 
<a name="l00341"></a><a class="code" href="uncmanapp_8cpp.html#a11c094f0420f56da0241745610f20d92">00341</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a695d703f72359927467fd2b5f3630891">addlimits</a>(ios&amp; iostr)
<a name="l00342"></a>00342 {
<a name="l00343"></a>00343   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda12e427a814d05cf13103a609ef21c2f0">limits</a>;  <span class="comment">// Set bit 0xB = 0 to mean show limits.</span>
<a name="l00344"></a>00344   <span class="keywordflow">return</span> (iostr);
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
<a name="l00347"></a><a class="code" href="uncmanapp_8cpp.html#a463f4683bb909827155363d36993c97a">00347</a> ios&amp; <a class="code" href="unc___types_8cpp.html#a286b7e45bb5a873dc525929711ddcbb5">nolimits</a>(ios&amp; iostr)
<a name="l00348"></a>00348 {
<a name="l00349"></a>00349   iostr.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda12e427a814d05cf13103a609ef21c2f0">limits</a>;  <span class="comment">// clear bit 0xB = 0 to mean no limits shown.</span>
<a name="l00350"></a>00350   <span class="keywordflow">return</span> (iostr);
<a name="l00351"></a>00351 }
<a name="l00352"></a>00352 <span class="comment">// May need istream operator&gt;&gt; versions too?</span>
<a name="l00353"></a>00353 
<a name="l00354"></a>00354 <span class="comment">// Two overloaded uFlags functions, like ios setf. </span>
<a name="l00355"></a>00355 <span class="comment">// (1st just returns current, other sets &amp; returns old).</span>
<a name="l00356"></a><a class="code" href="uncmanapp_8cpp.html#a7d0d137308df368848401a18bf9df066">00356</a>  <span class="keywordtype">long</span> <a class="code" href="uncmanapp_8cpp.html#a7d0d137308df368848401a18bf9df066">uFlags</a>(ios&amp; str)
<a name="l00357"></a>00357 {
<a name="l00358"></a>00358   <span class="keywordflow">return</span> str.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Return streams current unc flags.</span>
<a name="l00359"></a>00359   <span class="comment">//  Unlike ios member function fmtflags ios::flags(),</span>
<a name="l00360"></a>00360   <span class="comment">//  these need to know their ios.</span>
<a name="l00361"></a>00361 }
<a name="l00362"></a>00362 
<a name="l00363"></a><a class="code" href="uncmanapp_8cpp.html#a4d3104d15c73eed409ab6b74fae7351f">00363</a> <span class="keywordtype">long</span> <a class="code" href="uncmanapp_8cpp.html#a7d0d137308df368848401a18bf9df066">uFlags</a>(ios&amp; str, <span class="keywordtype">long</span> flags) <span class="comment">// Assign new &amp; return old.</span>
<a name="l00364"></a>00364 {
<a name="l00365"></a>00365   <span class="comment">// lock();  may be required for multitasking (MT defined).</span>
<a name="l00366"></a>00366   <span class="keywordtype">long</span> oldflags = str.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save to return</span>
<a name="l00367"></a>00367   str.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = flags;  <span class="comment">// Assign all bits.</span>
<a name="l00368"></a>00368   <span class="comment">// unlock();</span>
<a name="l00369"></a>00369   <span class="keywordflow">return</span> oldflags;  <span class="comment">// Previous flags.</span>
<a name="l00370"></a>00370 }
<a name="l00371"></a>00371 
<a name="l00372"></a><a class="code" href="uncmanapp_8cpp.html#a3d52c272f51739ebd36e7d2dce53c64d">00372</a> <span class="keywordtype">long</span> <a class="code" href="uncmanapp_8cpp.html#a3d52c272f51739ebd36e7d2dce53c64d">setuFlags</a>(ios&amp; str, <span class="keywordtype">long</span> flags)  <span class="comment">// Set selected bits &amp; return old.</span>
<a name="l00373"></a>00373 {
<a name="l00374"></a>00374   <span class="keywordtype">long</span> oldflags = str.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save to return.</span>
<a name="l00375"></a>00375   <span class="comment">// lock();</span>
<a name="l00376"></a>00376   str.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= flags;  <span class="comment">// OR Set = 1 specific bits.</span>
<a name="l00377"></a>00377   <span class="comment">// unlock();</span>
<a name="l00378"></a>00378   <span class="keywordflow">return</span> oldflags;  <span class="comment">// Previous;</span>
<a name="l00379"></a>00379 }
<a name="l00380"></a>00380 
<a name="l00381"></a><a class="code" href="uncmanapp_8cpp.html#a20081fc901af9b6cdce50a7b14ebccd1">00381</a> <span class="keywordtype">long</span> <a class="code" href="uncmanapp_8cpp.html#a20081fc901af9b6cdce50a7b14ebccd1">resetuFlags</a>(ios&amp; str, <span class="keywordtype">long</span> flags)  <span class="comment">// Reset bits &amp; return old.</span>
<a name="l00382"></a>00382 {
<a name="l00383"></a>00383   <span class="keywordtype">long</span> oldflags = str.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// to return</span>
<a name="l00384"></a>00384   <span class="comment">// lock();</span>
<a name="l00385"></a>00385   str.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= (~flags);  <span class="comment">// reset specified bits.</span>
<a name="l00386"></a>00386   <span class="comment">// unlock();</span>
<a name="l00387"></a>00387   <span class="keywordflow">return</span> oldflags;  <span class="comment">// Previous.</span>
<a name="l00388"></a>00388 }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390 <span class="comment">// Manipulator creation using class whose name is that of the manipulator</span>
<a name="l00391"></a>00391 <span class="comment">// &amp; &lt;&lt; &amp; &gt;&gt; operators.</span>
<a name="l00392"></a>00392 <span class="comment">// Steve Teale p 182 suggests that this is longer code than using template</span>
<a name="l00393"></a>00393 <span class="comment">// O, I or Smanip, but simpler to code and understand, and will run faster.</span>
<a name="l00394"></a>00394 
<a name="l00395"></a>00395 <span class="comment">// setAllUncflags(int flags);</span>
<a name="l00396"></a>00396 <span class="comment">// Usage: out &lt;&lt; setAllUncFlags(0x5a) ...</span>
<a name="l00397"></a>00397 setAllUncFlags::setAllUncFlags(<span class="keywordtype">int</span> w) : flags(w) {}
<a name="l00398"></a>00398  <span class="comment">// Constructor initialisation assigns flags = w.</span>
<a name="l00399"></a>00399 
<a name="l00400"></a><a class="code" href="uncmanapp_8cpp.html#ab1af6624da76fcd03d0900b334c7b519">00400</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> setAllUncFlags&amp; sf)
<a name="l00401"></a>00401 {
<a name="l00402"></a>00402   os.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all old flags.</span>
<a name="l00403"></a>00403   os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = sf.flags;  <span class="comment">// Set all flags.  </span>
<a name="l00404"></a>00404   <span class="keywordflow">return</span> os;
<a name="l00405"></a>00405 }
<a name="l00406"></a>00406 
<a name="l00407"></a><a class="code" href="uncmanapp_8cpp.html#a9195d7684a5eecb8d2a7403a7be27d21">00407</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> setAllUncFlags&amp; sf)
<a name="l00408"></a>00408 {
<a name="l00409"></a>00409   is.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all old flags.</span>
<a name="l00410"></a>00410   is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = sf.flags;  <span class="comment">// Set all flags.</span>
<a name="l00411"></a>00411   <span class="keywordflow">return</span> is;
<a name="l00412"></a>00412 }
<a name="l00413"></a>00413 
<a name="l00414"></a>00414 <span class="comment">// setUncflags(int flags, int mask);</span>
<a name="l00415"></a>00415 <span class="comment">// Usage: out &lt;&lt; setUncFlags(0x7) ...</span>
<a name="l00416"></a>00416 setUncFlags::setUncFlags(<span class="keywordtype">int</span> w) : flags(w) {}  <span class="comment">// Constructor initialisation flags = w.</span>
<a name="l00417"></a>00417 
<a name="l00418"></a><a class="code" href="uncmanapp_8cpp.html#a917b7ee3f14bcefdba2b930963d8c242">00418</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> setUncFlags&amp; sf)
<a name="l00419"></a>00419 {
<a name="l00420"></a>00420   os.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all oldflags.</span>
<a name="l00421"></a>00421   os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= sf.flags;  <span class="comment">// Set (OR in) selected flags.</span>
<a name="l00422"></a>00422   <span class="keywordflow">return</span> os;
<a name="l00423"></a>00423 }
<a name="l00424"></a>00424 
<a name="l00425"></a><a class="code" href="uncmanapp_8cpp.html#ad602c366114d949f7be7b4f954e97494">00425</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> setUncFlags&amp; sf)
<a name="l00426"></a>00426 {
<a name="l00427"></a>00427   is.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all old flags.</span>
<a name="l00428"></a>00428   is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) |= sf.flags;   <span class="comment">// Set (OR in) selected flags.</span>
<a name="l00429"></a>00429   <span class="keywordflow">return</span> is;
<a name="l00430"></a>00430 }
<a name="l00431"></a>00431 
<a name="l00432"></a>00432 <span class="comment">// setMaskedUncflags(int flags, int mask);</span>
<a name="l00433"></a>00433 <span class="comment">// Usage: out &lt;&lt; setMaskedUncFlags(0xFFFF, 0x7) ...</span>
<a name="l00434"></a>00434 setMaskedUncFlags::setMaskedUncFlags(<span class="keywordtype">int</span> w, <span class="keywordtype">int</span> m) : flags(w), mask(m) {}
<a name="l00435"></a>00435   <span class="comment">// flags = w; mask = m; in effect.</span>
<a name="l00436"></a>00436 
<a name="l00437"></a><a class="code" href="uncmanapp_8cpp.html#acca9712ff324bd5388f8b4e920611bb1">00437</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> setMaskedUncFlags&amp; sf)
<a name="l00438"></a>00438 {
<a name="l00439"></a>00439   os.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all flags.</span>
<a name="l00440"></a>00440   os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = 
<a name="l00441"></a>00441     (sf.flags &amp; sf.mask) | (sf.flags &amp; ~sf.mask);  <span class="comment">// Set selected flags to mask.</span>
<a name="l00442"></a>00442   <span class="keywordflow">return</span> os;
<a name="l00443"></a>00443 }
<a name="l00444"></a>00444 
<a name="l00445"></a><a class="code" href="uncmanapp_8cpp.html#a4ab705f462044fdf7baa595c5c73dde8">00445</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> setMaskedUncFlags&amp; sf)
<a name="l00446"></a>00446 {
<a name="l00447"></a>00447   is.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all flags.</span>
<a name="l00448"></a>00448   is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) =
<a name="l00449"></a>00449     (sf.flags &amp; sf.mask) | (sf.flags &amp; ~sf.mask);  <span class="comment">// Set selected flags to mask.</span>
<a name="l00450"></a>00450   <span class="keywordflow">return</span> is;
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00453"></a>00453 <span class="comment">// resetUncflags(int flags);</span>
<a name="l00454"></a>00454 <span class="comment">// Usage: out &lt;&lt; setMaskedUncFlags(0xF) ...</span>
<a name="l00455"></a>00455 resetUncFlags::resetUncFlags(<span class="keywordtype">int</span> w) : flags(w) {}  <span class="comment">// Constructor initialisation flags = w.</span>
<a name="l00456"></a>00456 
<a name="l00457"></a><a class="code" href="uncmanapp_8cpp.html#a3f1c8fc2847a3fd607ff5f53c07897a1">00457</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> resetUncFlags&amp; sf)
<a name="l00458"></a>00458 {
<a name="l00459"></a>00459   os.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save previous.</span>
<a name="l00460"></a>00460   os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~sf.flags;  <span class="comment">// Clear specific bits = 0.</span>
<a name="l00461"></a>00461   <span class="keywordflow">return</span> os;
<a name="l00462"></a>00462 }
<a name="l00463"></a>00463 
<a name="l00464"></a><a class="code" href="uncmanapp_8cpp.html#aa08145fa1ddd126896923bd8a843d688">00464</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> resetUncFlags&amp; sf)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466   is.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save previous.</span>
<a name="l00467"></a>00467   is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~sf.flags;  <span class="comment">//  Clear specific bits = 0.</span>
<a name="l00468"></a>00468   <span class="keywordflow">return</span> is;
<a name="l00469"></a>00469 }
<a name="l00470"></a>00470 
<a name="l00471"></a>00471 <span class="comment">// setMaskedUncflags(int flags, int mask);</span>
<a name="l00472"></a>00472 <span class="comment">// Usage: out &lt;&lt; setMaskedUncFlags(0xFFFF, 0x7) ...</span>
<a name="l00473"></a>00473 resetMaskedUncFlags::resetMaskedUncFlags(<span class="keywordtype">int</span> w, <span class="keywordtype">int</span> m) : flags(w), mask(m) {} 
<a name="l00474"></a>00474 <span class="comment">// Constructor initialisation flags = w.</span>
<a name="l00475"></a>00475 
<a name="l00476"></a><a class="code" href="uncmanapp_8cpp.html#a809b0887a6eb5563245dcf10f807c33e">00476</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> resetMaskedUncFlags&amp; sf)
<a name="l00477"></a>00477 {
<a name="l00478"></a>00478   os.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all flags.</span>
<a name="l00479"></a>00479   os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = 
<a name="l00480"></a>00480     (sf.flags &amp; sf.mask) &amp; ~(sf.flags &amp; ~sf.mask);  <span class="comment">// Clear selected flags to mask.</span>
<a name="l00481"></a>00481   <span class="keywordflow">return</span> os;
<a name="l00482"></a>00482 }
<a name="l00483"></a>00483 
<a name="l00484"></a><a class="code" href="uncmanapp_8cpp.html#a836380a959708225e44d1146391e7d46">00484</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> resetMaskedUncFlags&amp; sf)
<a name="l00485"></a>00485 {
<a name="l00486"></a>00486   is.iword(<a class="code" href="unc_init_8cpp.html#ab5f1365fe3afb715b512eda132f833bb">uncOldFlagsIndex</a>) = is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// Save all flags.</span>
<a name="l00487"></a>00487   is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) =
<a name="l00488"></a>00488     (sf.flags &amp; sf.mask) &amp; ~(sf.flags &amp; ~sf.mask);  <span class="comment">// Clear selected flags to mask.</span>
<a name="l00489"></a>00489   <span class="keywordflow">return</span> is;
<a name="l00490"></a>00490 }
<a name="l00491"></a>00491 
<a name="l00492"></a>00492 <span class="comment">// setUncWidth(int width);</span>
<a name="l00493"></a>00493 <span class="comment">// Usage: out &lt;&lt; setUncWidth(12) ...</span>
<a name="l00494"></a>00494 setUncWidth::setUncWidth(<span class="keywordtype">int</span> w) : uncWidth(w) {}  <span class="comment">// Constructor - initialisation width = w.</span>
<a name="l00495"></a>00495 
<a name="l00496"></a><a class="code" href="uncmanapp_8cpp.html#a7e4e8025a820dd1ff03615d4dce5d093">00496</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> setUncWidth&amp; sw)
<a name="l00497"></a>00497 {
<a name="l00498"></a>00498   os.iword(<a class="code" href="unc_init_8cpp.html#a3f9aa2e7a8a498537b121000d91d19d4">uncOldWidthIndex</a>) = os.iword(<a class="code" href="_test_quan1_8cpp.html#a7edb6c5c7929c3cde8986c34985cd884">uncWidthIndex</a>);  <span class="comment">// Save.</span>
<a name="l00499"></a>00499   os.iword(<a class="code" href="_test_quan1_8cpp.html#a7edb6c5c7929c3cde8986c34985cd884">uncWidthIndex</a>) = sw.uncWidth;  <span class="comment">// Set new uncertain width.</span>
<a name="l00500"></a>00500   <span class="keywordflow">return</span> os;
<a name="l00501"></a>00501 }
<a name="l00502"></a>00502 
<a name="l00503"></a><a class="code" href="uncmanapp_8cpp.html#a8113437fb3cdce9f48fa699025ea8b19">00503</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> setUncWidth&amp; sw)
<a name="l00504"></a>00504 {
<a name="l00505"></a>00505   is.iword(<a class="code" href="unc_init_8cpp.html#a3f9aa2e7a8a498537b121000d91d19d4">uncOldWidthIndex</a>) = is.iword(<a class="code" href="_test_quan1_8cpp.html#a7edb6c5c7929c3cde8986c34985cd884">uncWidthIndex</a>);  <span class="comment">// Save.</span>
<a name="l00506"></a>00506   is.iword(<a class="code" href="_test_quan1_8cpp.html#a7edb6c5c7929c3cde8986c34985cd884">uncWidthIndex</a>) = sw.uncWidth;
<a name="l00507"></a>00507   <span class="keywordflow">return</span> is;
<a name="l00508"></a>00508 }
<a name="l00509"></a>00509 
<a name="l00510"></a>00510 <span class="comment">// setUncScale(int scale);</span>
<a name="l00511"></a>00511 <span class="comment">// Usage: out &lt;&lt; setUncScale(6)  ... // == 10**6</span>
<a name="l00512"></a>00512 <span class="comment">// &amp; &lt;&lt; scale to use set scale value, or &lt;&lt; noscale to not use.</span>
<a name="l00513"></a>00513 setUncScale::setUncScale(<span class="keywordtype">int</span> w) : uncscale(w) {}  <span class="comment">// Constructor - initialisation scale = w.</span>
<a name="l00514"></a>00514 
<a name="l00515"></a><a class="code" href="uncmanapp_8cpp.html#ad9cb7f30a76c22df6a402980daf0a721">00515</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> setUncScale&amp; sc)
<a name="l00516"></a>00516 {
<a name="l00517"></a>00517   os.iword(<a class="code" href="unc_init_8cpp.html#a583f0dc2d61a066d7b984e5388f8ece6">uncOldScaleIndex</a>) = os.iword(<a class="code" href="unc_init_8cpp.html#ab19a26cad50b9d4c92873496706e98f9">uncSetScaleIndex</a>);  <span class="comment">// Save old.</span>
<a name="l00518"></a>00518   os.iword(<a class="code" href="unc_init_8cpp.html#ab19a26cad50b9d4c92873496706e98f9">uncSetScaleIndex</a>) = sc.uncscale;
<a name="l00519"></a>00519   <span class="keywordflow">return</span> os;
<a name="l00520"></a>00520 }
<a name="l00521"></a>00521 
<a name="l00522"></a><a class="code" href="uncmanapp_8cpp.html#a344ad39def03c1248e0d82d5ddd1db3c">00522</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> setUncScale&amp; sc)
<a name="l00523"></a>00523 {
<a name="l00524"></a>00524   is.iword(<a class="code" href="unc_init_8cpp.html#a583f0dc2d61a066d7b984e5388f8ece6">uncOldScaleIndex</a>) = is.iword(<a class="code" href="unc_init_8cpp.html#ab19a26cad50b9d4c92873496706e98f9">uncSetScaleIndex</a>);  <span class="comment">// Save old.</span>
<a name="l00525"></a>00525   is.iword(<a class="code" href="unc_init_8cpp.html#ab19a26cad50b9d4c92873496706e98f9">uncSetScaleIndex</a>) = sc.uncscale;
<a name="l00526"></a>00526   <span class="keywordflow">return</span> is;
<a name="l00527"></a>00527 }
<a name="l00528"></a>00528 
<a name="l00529"></a>00529 <span class="comment">// setSigFigs(int sigFigs);</span>
<a name="l00530"></a>00530 <span class="comment">// Usage: out &lt;&lt; setSigFigs(6) ...</span>
<a name="l00531"></a>00531 <span class="comment">// &amp; &lt;&lt; sigfiged to use set sigFigs value, or noSigfiged to not use.</span>
<a name="l00532"></a>00532 setSigFigs::setSigFigs(<span class="keywordtype">int</span> w) : sigFigs(w) {}  <span class="comment">// Constructor</span>
<a name="l00533"></a>00533 
<a name="l00534"></a><a class="code" href="uncmanapp_8cpp.html#a655d48758749ed15f11da54f31d20909">00534</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> setSigFigs&amp; sf)
<a name="l00535"></a>00535 {
<a name="l00536"></a>00536   os.iword(<a class="code" href="unc_init_8cpp.html#aa311b745e265500aedddb1faee22e427">oldSigFigsIndex</a>) = os.iword(<a class="code" href="unc_init_8cpp.html#abb85e035433d423441cca46a1410eb56">setSigFigsIndex</a>);  <span class="comment">// Save previous.</span>
<a name="l00537"></a>00537   os.iword(<a class="code" href="unc_init_8cpp.html#abb85e035433d423441cca46a1410eb56">setSigFigsIndex</a>) = sf.sigFigs;  <span class="comment">// Set new sigfigs.</span>
<a name="l00538"></a>00538   <span class="keywordflow">return</span> os;
<a name="l00539"></a>00539 }
<a name="l00540"></a>00540 
<a name="l00541"></a><a class="code" href="uncmanapp_8cpp.html#af017d33478b2e240f288b926c0810827">00541</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> setSigFigs&amp; sf)
<a name="l00542"></a>00542 {
<a name="l00543"></a>00543   is.iword(<a class="code" href="unc_init_8cpp.html#aa311b745e265500aedddb1faee22e427">oldSigFigsIndex</a>) = is.iword(<a class="code" href="unc_init_8cpp.html#abb85e035433d423441cca46a1410eb56">setSigFigsIndex</a>);  <span class="comment">// Save previous.</span>
<a name="l00544"></a>00544   is.iword(<a class="code" href="unc_init_8cpp.html#abb85e035433d423441cca46a1410eb56">setSigFigsIndex</a>) = sf.sigFigs;  <span class="comment">// Set new sigfigs.</span>
<a name="l00545"></a>00545   <span class="keywordflow">return</span> is;
<a name="l00546"></a>00546 }
<a name="l00547"></a>00547 
<a name="l00548"></a>00548 <span class="comment">// setUncSigfigs(int sigfigs);</span>
<a name="l00549"></a>00549 <span class="comment">// Usage: out &lt;&lt; setUncSigfigs(3) ... = cout.iword[uncSigFigsIndex] = 3;</span>
<a name="l00550"></a>00550 setUncSigFigs::setUncSigFigs(<span class="keywordtype">int</span> w) : uncSigFigs(w) {}  <span class="comment">// Constructor</span>
<a name="l00551"></a>00551 
<a name="l00552"></a><a class="code" href="uncmanapp_8cpp.html#ad9e65795f992f87236f8915902877129">00552</a> ostream&amp; <a class="code" href="meas_8cpp.html#af67bc5edfb491605709f14598394353c">operator&lt;&lt; </a>(ostream&amp; os, <span class="keyword">const</span> setUncSigFigs&amp; usf)
<a name="l00553"></a>00553 {
<a name="l00554"></a>00554   os.iword(<a class="code" href="unc_init_8cpp.html#a463d9bd876b30d86f0169360307a55c3">oldUncSigFigsIndex</a>) = os.iword(<a class="code" href="unc_init_8cpp.html#ae9f0027728a2ad546badb0363f3c9590">uncSigFigsIndex</a>);  <span class="comment">// Save previous.</span>
<a name="l00555"></a>00555   os.iword(<a class="code" href="unc_init_8cpp.html#ae9f0027728a2ad546badb0363f3c9590">uncSigFigsIndex</a>) = usf.uncSigFigs;  <span class="comment">// Set new uncSigFigs.</span>
<a name="l00556"></a>00556   <span class="keywordflow">return</span> os;
<a name="l00557"></a>00557 }
<a name="l00558"></a>00558 
<a name="l00559"></a><a class="code" href="uncmanapp_8cpp.html#a3eaec4e6346967413ce676dc88a330c2">00559</a> istream&amp; <a class="code" href="meas_8cpp.html#ad99bda367a17a1a1be124200f6da5298">operator&gt;&gt; </a>(istream&amp; is, <span class="keyword">const</span> setUncSigFigs&amp; usf)
<a name="l00560"></a>00560 {
<a name="l00561"></a>00561   is.iword(<a class="code" href="unc_init_8cpp.html#a463d9bd876b30d86f0169360307a55c3">oldUncSigFigsIndex</a>) = is.iword(<a class="code" href="unc_init_8cpp.html#ae9f0027728a2ad546badb0363f3c9590">uncSigFigsIndex</a>);  <span class="comment">// Save previous.</span>
<a name="l00562"></a>00562   is.iword(<a class="code" href="unc_init_8cpp.html#ae9f0027728a2ad546badb0363f3c9590">uncSigFigsIndex</a>) = usf.uncSigFigs;  <span class="comment">// Set new uncSigFigs.</span>
<a name="l00563"></a>00563   <span class="keywordflow">return</span> is;
<a name="l00564"></a>00564 }
<a name="l00565"></a>00565 
<a name="l00566"></a>00566 <span class="comment">// Placed here just for testing.</span>
<a name="l00567"></a>00567 <span class="comment">// Note both versions needed unless use a template.</span>
<a name="l00568"></a>00568 <span class="keyword">template</span>&lt;&gt; UReal&lt;true&gt;::~UReal()  <span class="comment">// Definition.</span>
<a name="l00569"></a>00569 {
<a name="l00570"></a>00570   <span class="keywordflow">if</span> (cdtrace)
<a name="l00571"></a>00571     {
<a name="l00572"></a>00572     cerr &lt;&lt; <span class="stringliteral">&quot;\n___ Destruct UReal members: value &quot;</span>
<a name="l00573"></a>00573       &lt;&lt; setprecision (std::numeric_limits&lt;double&gt;::digits10)   &lt;&lt; m_value
<a name="l00574"></a>00574       &lt;&lt; setprecision (std::numeric_limits&lt;float&gt;::digits10) &lt;&lt; <span class="stringliteral">&quot;, Unc &quot;</span> &lt;&lt; float(m_uncertainty)
<a name="l00575"></a>00575       &lt;&lt; <span class="stringliteral">&quot;, df &quot;</span> &lt;&lt; dec &lt;&lt; m_degFree &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; showUncTypes(m_types)
<a name="l00576"></a>00576       &lt;&lt; endl;
<a name="l00577"></a>00577     }
<a name="l00578"></a>00578 }  <span class="comment">// UReal&lt;true&gt;::~UReal()  Destructor</span>
<a name="l00579"></a>00579 
<a name="l00580"></a>00580 <span class="keyword">template</span>&lt;&gt; UReal&lt;false&gt;::~UReal()  <span class="comment">// Definition.</span>
<a name="l00581"></a>00581 {
<a name="l00582"></a>00582   <span class="keywordflow">if</span> (cdtrace)
<a name="l00583"></a>00583     {
<a name="l00584"></a>00584     cerr &lt;&lt; <span class="stringliteral">&quot;\n___ Destruct UReal members: value &quot;</span>
<a name="l00585"></a>00585       &lt;&lt; setprecision (std::numeric_limits&lt;double&gt;::digits10)   &lt;&lt; m_value
<a name="l00586"></a>00586       &lt;&lt; setprecision (std::numeric_limits&lt;float&gt;::digits10) &lt;&lt; <span class="stringliteral">&quot;, Unc &quot;</span> &lt;&lt; float(m_uncertainty)
<a name="l00587"></a>00587        &lt;&lt; <span class="stringliteral">&quot;, df &quot;</span> &lt;&lt; dec &lt;&lt; m_degFree &lt;&lt; <span class="stringliteral">&quot;, &quot;</span> &lt;&lt; showUncTypes(m_types)
<a name="l00588"></a>00588       &lt;&lt; endl;
<a name="l00589"></a>00589     }
<a name="l00590"></a>00590 }  <span class="comment">// UReal&lt;false&gt;::~UReal() Destructor</span>
<a name="l00591"></a>00591 
<a name="l00592"></a>00592 
<a name="l00593"></a>00593 
<a name="l00594"></a>00594 <span class="comment">/*</span>
<a name="l00595"></a>00595 <span class="comment">   </span>
<a name="l00596"></a>00596 <span class="comment">template&lt;bool isCorrelated&gt;</span>
<a name="l00597"></a>00597 <span class="comment">UReal&lt;isCorrelated&gt;::~UReal()  // Template Definition.</span>
<a name="l00598"></a>00598 <span class="comment">{ // UReal Destructor.</span>
<a name="l00599"></a>00599 <span class="comment">  if (cdtrace)</span>
<a name="l00600"></a>00600 <span class="comment">  {</span>
<a name="l00601"></a>00601 <span class="comment">    cerr &lt;&lt; &quot;\n___ Destruct UReal members: &quot;</span>
<a name="l00602"></a>00602 <span class="comment">      &lt;&lt; m_value &lt;&lt; &quot;, Unc &quot; &lt;&lt; float(m_uncertainty)</span>
<a name="l00603"></a>00603 <span class="comment">      &lt;&lt; &quot;, df &quot; &lt;&lt; dec &lt;&lt; m_degFree &lt;&lt; showUncTypes(m_types)</span>
<a name="l00604"></a>00604 <span class="comment">      &lt;&lt; endl;</span>
<a name="l00605"></a>00605 <span class="comment">  } // cdtrace</span>
<a name="l00606"></a>00606 <span class="comment">}  // ~UReal Destructor.</span>
<a name="l00607"></a>00607 <span class="comment"></span>
<a name="l00608"></a>00608 <span class="comment">UReal&lt;true&gt;::~UReal(); // Definition.</span>
<a name="l00609"></a>00609 <span class="comment">UReal&lt;false&gt;::~UReal();  // Definition.</span>
<a name="l00610"></a>00610 <span class="comment"></span>
<a name="l00611"></a>00611 <span class="comment">  //fails to link, LNK2001:</span>
<a name="l00612"></a>00612 <span class="comment"></span>
<a name="l00613"></a>00613 <span class="comment"> // UReal&lt;0&gt;::~UReal&lt;0&gt;(void)&quot;</span>
<a name="l00614"></a>00614 <span class="comment">// UReal&lt;1&gt;::~UReal&lt;1&gt;(void)&quot;</span>
<a name="l00615"></a>00615 <span class="comment"></span>
<a name="l00616"></a>00616 <span class="comment">Failed to move this too:</span>
<a name="l00617"></a>00617 <span class="comment"></span>
<a name="l00618"></a>00618 <span class="comment">  UReal&lt;true&gt;::UReal operator+ (void) const;  // Unary +</span>
<a name="l00619"></a>00619 <span class="comment"></span>
<a name="l00620"></a>00620 <span class="comment">//UReal&lt;bool isCorrelated&gt;::operator+ (void) const;  // Unary +</span>
<a name="l00621"></a>00621 <span class="comment"></span>
<a name="l00622"></a>00622 <span class="comment">UReal&lt;true&gt;::operator+ (void) const  // Unary +</span>
<a name="l00623"></a>00623 <span class="comment">  {  // &#39;slope&#39; d f(x)/dx = +1</span>
<a name="l00624"></a>00624 <span class="comment">    return *this;  // All members remain unchanged.</span>
<a name="l00625"></a>00625 <span class="comment">  }</span>
<a name="l00626"></a>00626 <span class="comment"></span>
<a name="l00627"></a>00627 <span class="comment">//      UReal&lt;true&gt; operator+ (void) const;</span>
<a name="l00628"></a>00628 <span class="comment"></span>
<a name="l00629"></a>00629 <span class="comment"></span>
<a name="l00630"></a>00630 <span class="comment"></span>
<a name="l00631"></a>00631 <span class="comment">*/</span>
<a name="l00632"></a>00632 
<a name="l00633"></a><a class="code" href="uncmanapp_8cpp.html#a937f836821910c2e2002d2f7ae65a520">00633</a> <span class="keywordtype">void</span> <a class="code" href="uncmanapp_8cpp.html#a937f836821910c2e2002d2f7ae65a520">uncertainRead</a>(
<a name="l00634"></a>00634                    <span class="keywordtype">double</span>&amp; value,  <span class="comment">// mean, central or most probable value.</span>
<a name="l00635"></a>00635                    <span class="keywordtype">double</span>&amp; stdDeviation,
<a name="l00636"></a>00636                    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>&amp; degreesOfFreedom,  <span class="comment">// 1 observation.</span>
<a name="l00637"></a>00637                    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span>&amp; types, <span class="comment">// TODO settings bits.</span>
<a name="l00638"></a>00638                    istream&amp; is = cin)
<a name="l00639"></a>00639 {       <span class="comment">// Inputs uncertainty as value,</span>
<a name="l00640"></a>00640   <span class="comment">// &amp; optionally [[+]|[-] &lt;standard deviation&gt;],</span>
<a name="l00641"></a>00641   <span class="comment">// &amp; optionally degrees of freedom [(&lt;short int&gt;)] like (99)</span>
<a name="l00642"></a>00642   <span class="comment">// Used by istream&amp; operator&gt;&gt; (istream&amp;, UReal&lt;isCorrelated&gt;&amp;)</span>
<a name="l00643"></a>00643   <span class="comment">/* Original simple version:</span>
<a name="l00644"></a>00644 <span class="comment">    char plus, slash, minus;</span>
<a name="l00645"></a>00645 <span class="comment">    is &gt;&gt; value &gt;&gt; plus &gt;&gt; slash &gt;&gt; minus &gt;&gt; stdDeviation;</span>
<a name="l00646"></a>00646 <span class="comment">    if ((plus != &#39;+&#39;) || (slash != &#39;/&#39;) || (minus != &#39;-&#39;))      </span>
<a name="l00647"></a>00647 <span class="comment">    {</span>
<a name="l00648"></a>00648 <span class="comment">    cerr &lt;&lt; &quot;Unexpected characters encountered in reading &quot;</span>
<a name="l00649"></a>00649 <span class="comment">    &quot;value +/- stdDeviation !&quot; &lt;&lt; endl;</span>
<a name="l00650"></a>00650 <span class="comment">    is.setf(ios::failbit);</span>
<a name="l00651"></a>00651 <span class="comment">    }</span>
<a name="l00652"></a>00652 <span class="comment">  */</span>
<a name="l00653"></a>00653 
<a name="l00654"></a>00654   <span class="keywordtype">int</span> iv = 0;  <span class="comment">// Integer part of floating point number.</span>
<a name="l00655"></a>00655   <span class="keywordtype">double</span> fv = 0.0;  <span class="comment">// Fractional part of floating point number.</span>
<a name="l00656"></a>00656   <span class="keywordtype">int</span> exponent = 0; <span class="comment">// Exponent power of 10, default 10*0 = 1.0.</span>
<a name="l00657"></a>00657   <span class="comment">// bool isPositive = true; // Value input is &gt;= 0.</span>
<a name="l00658"></a>00658   <span class="keywordtype">bool</span> isNegativeValue = <span class="keyword">false</span>; <span class="comment">// Value input &lt; 0.</span>
<a name="l00659"></a>00659   <span class="keywordtype">bool</span> isPlusMinus = <span class="keyword">false</span>;  <span class="comment">// Normal case is +/- or +|-.</span>
<a name="l00660"></a>00660   <span class="keywordtype">bool</span> isPlus = <span class="keyword">false</span>;
<a name="l00661"></a>00661   <span class="keywordtype">bool</span> isMinus = <span class="keyword">false</span>;
<a name="l00662"></a>00662   <span class="keywordtype">bool</span> isExactValue = <span class="keyword">true</span>;
<a name="l00663"></a>00663   <span class="keywordtype">bool</span> isIntegerValue = <span class="keyword">true</span>;
<a name="l00664"></a>00664   std::streamsize avail = is.rdbuf()-&gt;in_avail();
<a name="l00665"></a>00665   <span class="comment">// cout &lt;&lt; &quot; (&quot; &lt;&lt; avail &lt;&lt; &quot;)   &quot;;</span>
<a name="l00666"></a>00666   <span class="keywordflow">if</span> (avail == 0)
<a name="l00667"></a>00667   {
<a name="l00668"></a>00668     cerr &lt;&lt; <span class="stringliteral">&quot;!!! No input!&quot;</span> &lt;&lt; endl;
<a name="l00669"></a>00669     value = QNaN;
<a name="l00670"></a>00670     stdDeviation = QNaNf;
<a name="l00671"></a>00671     types = 0U;
<a name="l00672"></a>00672     <span class="keywordflow">return</span>;
<a name="l00673"></a>00673   }
<a name="l00674"></a>00674   iv = 0;  <span class="comment">// Integer part of float.</span>
<a name="l00675"></a>00675   fv = 0.0;     <span class="comment">// Fraction part of float.</span>
<a name="l00676"></a>00676   value = 0.0;  <span class="comment">// double value.</span>
<a name="l00677"></a>00677   exponent = 0;  <span class="comment">// 10**Exponent if E format.</span>
<a name="l00678"></a>00678   isIntegerValue = <span class="keyword">true</span>; isExactValue = <span class="keyword">true</span>;  <span class="comment">// Assume no digits follow.</span>
<a name="l00679"></a>00679   stdDeviation = 0.0f;  <span class="comment">// Exact.</span>
<a name="l00680"></a>00680   degreesOfFreedom = 0;  <span class="comment">// Default == 1 observation.</span>
<a name="l00681"></a>00681   types = 0U;
<a name="l00682"></a>00682 
<a name="l00683"></a>00683   is &gt;&gt; ws;  <span class="comment">// Skip leading whitespace.</span>
<a name="l00684"></a>00684   is &gt;&gt; iv;  <span class="comment">// &amp; get integer part.</span>
<a name="l00685"></a>00685   <span class="keywordflow">if</span> (!is)
<a name="l00686"></a>00686   {
<a name="l00687"></a>00687     cerr &lt;&lt; <span class="stringliteral">&quot;No numeric input! &quot;</span> &lt;&lt; endl;;
<a name="l00688"></a>00688     value = QNaN;
<a name="l00689"></a>00689     <span class="keywordflow">return</span>;
<a name="l00690"></a>00690   }
<a name="l00691"></a>00691   isNegativeValue = (iv &lt; 0) ? <span class="keyword">true</span> : <span class="keyword">false</span>;
<a name="l00692"></a>00692   <span class="comment">// Overflow possible here if &gt; numeric_limits&lt;long&gt;::max() == 2147483647</span>
<a name="l00693"></a>00693   <span class="comment">// for example 99999999999999</span>
<a name="l00694"></a>00694   <span class="keywordflow">if</span> (is.fail())
<a name="l00695"></a>00695   {  <span class="comment">// Check for overflow &amp; other problems.</span>
<a name="l00696"></a>00696     cerr &lt;&lt; <span class="stringliteral">&quot;value input failed! &quot;</span> &lt;&lt; endl;
<a name="l00697"></a>00697     value = QNaN;
<a name="l00698"></a>00698     stdDeviation = QNaNf;
<a name="l00699"></a>00699     types = 0U;
<a name="l00700"></a>00700     <span class="keywordflow">return</span>;
<a name="l00701"></a>00701   }
<a name="l00702"></a>00702   <span class="comment">// if (is.bad()) // Not useful to distinguish overflow etc.</span>
<a name="l00703"></a>00703   <span class="comment">// if (is.eof()) // Sets fail for overflow, so not useful.</span>
<a name="l00704"></a>00704 
<a name="l00705"></a>00705   <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;.&#39;</span>)   <span class="comment">// locale.decimal_point[0] better</span>
<a name="l00706"></a>00706   {  <span class="comment">// a fractional part may follow.</span>
<a name="l00707"></a>00707     is.get();  <span class="comment">// Get decimal_point</span>
<a name="l00708"></a>00708     isIntegerValue = <span class="keyword">false</span>; isExactValue = <span class="keyword">false</span>;  <span class="comment">// Even if no digits follow.</span>
<a name="l00709"></a>00709     <span class="keywordtype">int</span> count = 0;
<a name="l00710"></a>00710     stdDeviation = 0.5f;  <span class="comment">// 100. implies 100.0 +/- 0.5</span>
<a name="l00711"></a>00711     <span class="keywordflow">if</span> (isdigit(is.peek()))
<a name="l00712"></a>00712     {  <span class="comment">// Is a fraction part.</span>
<a name="l00713"></a>00713       <span class="keywordtype">double</span> fracTen = 1.0;
<a name="l00714"></a>00714         <span class="keywordflow">while</span> (isdigit(is.peek()))
<a name="l00715"></a>00715         {
<a name="l00716"></a>00716           ++count;
<a name="l00717"></a>00717           stdDeviation *= 0.1f; <span class="comment">// stdDeviation = 0.05, 0.005 ...</span>
<a name="l00718"></a>00718           fracTen *= 0.1;
<a name="l00719"></a>00719           <span class="keywordtype">int</span> digit = (is.get() -<span class="charliteral">&#39;0&#39;</span>);
<a name="l00720"></a>00720           fv += digit * fracTen;
<a name="l00721"></a>00721           <span class="comment">// underflow to zero here.</span>
<a name="l00722"></a>00722         }
<a name="l00723"></a>00723         <span class="keywordflow">if</span> (isNegativeValue) fv = -fv;
<a name="l00724"></a>00724         types |= <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ad390fdd921c136180ceb271f498f450b">UNC_QUAN_DECIMAL</a>;  <span class="comment">// Quantised by least significant decimal digit.</span>
<a name="l00725"></a>00725         types &amp;= ~<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>;  <span class="comment">// Implied by sig figs.</span>
<a name="l00726"></a>00726       }  <span class="comment">// Is a fraction part.</span>
<a name="l00727"></a>00727     }  <span class="comment">// is a decimal_point</span>
<a name="l00728"></a>00728     value = iv + fv;
<a name="l00729"></a>00729     <span class="keywordflow">if</span> ((is.peek() &amp; 0x5F ) == <span class="charliteral">&#39;E&#39;</span>  ) <span class="comment">// &#39;e&#39; or &#39;E&#39;</span>
<a name="l00730"></a>00730     {
<a name="l00731"></a>00731       is.get();  <span class="comment">// &#39;e&#39; or &#39;E&#39;</span>
<a name="l00732"></a>00732       is &gt;&gt; exponent;
<a name="l00733"></a>00733       <span class="keywordflow">if</span> (exponent &gt; <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>)
<a name="l00734"></a>00734       {  <span class="comment">// Too big for uncertain read!</span>
<a name="l00735"></a>00735         cerr &lt;&lt; <span class="stringliteral">&quot;Exponent &quot;</span> &lt;&lt; exponent
<a name="l00736"></a>00736           &lt;&lt; <span class="stringliteral">&quot; is &gt; maximum of &quot;</span> &lt;&lt; <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a> &lt;&lt; <span class="stringliteral">&quot;! &quot;</span>;
<a name="l00737"></a>00737         exponent = <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>;  <span class="comment">// And Throw a wobbler!</span>
<a name="l00738"></a>00738       }
<a name="l00739"></a>00739       <span class="keywordflow">else</span> <span class="keywordflow">if</span>   (exponent &lt; -<a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>)
<a name="l00740"></a>00740       {
<a name="l00741"></a>00741         cerr &lt;&lt; <span class="stringliteral">&quot;Exponent &quot;</span> &lt;&lt; exponent
<a name="l00742"></a>00742           &lt;&lt; <span class="stringliteral">&quot; is &lt; minimum of &quot;</span> &lt;&lt; -<a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a> &lt;&lt; <span class="stringliteral">&quot;! &quot;</span>;
<a name="l00743"></a>00743         exponent = -<a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>;  <span class="comment">// And Throw a wobbler!</span>
<a name="l00744"></a>00744       }  <span class="comment">// Check exponent.</span>
<a name="l00745"></a>00745 
<a name="l00746"></a>00746       <span class="keywordflow">if</span> (exponent &lt; 0)
<a name="l00747"></a>00747       {
<a name="l00748"></a>00748         isIntegerValue = <span class="keyword">false</span>; isExactValue = <span class="keyword">false</span>;  <span class="comment">// Because &lt; unity.</span>
<a name="l00749"></a>00749         stdDeviation = 0.5f;  <span class="comment">// Will be scaled by 10**exponent</span>
<a name="l00750"></a>00750       }
<a name="l00751"></a>00751       value = value * <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[exponent + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>];
<a name="l00752"></a>00752       stdDeviation = stdDeviation * powersOfTen[exponent + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>];
<a name="l00753"></a>00753     }  <span class="comment">// Exponent</span>
<a name="l00754"></a>00754 
<a name="l00755"></a>00755     <span class="keywordflow">if</span> (isIntegerValue)
<a name="l00756"></a>00756     {
<a name="l00757"></a>00757       value = iv;
<a name="l00758"></a>00758       types |= <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a>;
<a name="l00759"></a>00759       cerr &lt;&lt; <span class="stringliteral">&quot;URead: Exact integer &quot;</span> &lt;&lt; value;
<a name="l00760"></a>00760     }
<a name="l00761"></a>00761     <span class="keywordflow">else</span>
<a name="l00762"></a>00762     {
<a name="l00763"></a>00763       types |= <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a>; <span class="comment">// Known .</span>
<a name="l00764"></a>00764       types &amp;= ~<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>; <span class="comment">// but implicit, as yet.</span>
<a name="l00765"></a>00765       <span class="keywordflow">if</span> (trace)
<a name="l00766"></a>00766       {
<a name="l00767"></a>00767         cerr &lt;&lt; <span class="stringliteral">&quot;URead: &quot;</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">&quot; implicit +/- &quot;</span> &lt;&lt; stdDeviation &lt;&lt; <span class="stringliteral">&quot;. &quot;</span>;
<a name="l00768"></a>00768       }
<a name="l00769"></a>00769     }
<a name="l00770"></a>00770 
<a name="l00771"></a>00771     <span class="comment">/*  to show how many more chars available from input stream is:</span>
<a name="l00772"></a>00772 <span class="comment">    avail = is.rdbuf()-&gt;in_avail();</span>
<a name="l00773"></a>00773 <span class="comment">    if (avail &gt; 0)</span>
<a name="l00774"></a>00774 <span class="comment">    {</span>
<a name="l00775"></a>00775 <span class="comment">    cerr &lt;&lt; &quot; (&quot; &lt;&lt; avail &lt;&lt; &quot;) &quot;&lt;&lt; flush;</span>
<a name="l00776"></a>00776 <span class="comment">    }</span>
<a name="l00777"></a>00777 <span class="comment">    else</span>
<a name="l00778"></a>00778 <span class="comment">    {</span>
<a name="l00779"></a>00779 <span class="comment">    cerr &lt;&lt; endl;</span>
<a name="l00780"></a>00780 <span class="comment">    return;</span>
<a name="l00781"></a>00781 <span class="comment">    }</span>
<a name="l00782"></a>00782 <span class="comment">    */</span>
<a name="l00783"></a>00783     is &gt;&gt; ws; <span class="comment">// Skip whitespace between 123.45 and +/-</span>
<a name="l00784"></a>00784     <span class="comment">// if (is.fail() ) return;  // EOF?</span>
<a name="l00785"></a>00785 
<a name="l00786"></a>00786     <span class="comment">//  Check if explicit uncertainty +/- or +|- follows,</span>
<a name="l00787"></a>00787     <span class="comment">//  &amp; read uncertainty if it does.</span>
<a name="l00788"></a>00788     <span class="keywordtype">double</span> expUnc = -1; <span class="comment">// Explicit uncertainty?</span>
<a name="l00789"></a>00789     <span class="comment">// if (p == 0x??)  // TODO? files code for +- symbol, is.get() is &gt;&gt; expUnc;</span>
<a name="l00790"></a>00790     <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;+&#39;</span>)
<a name="l00791"></a>00791     {
<a name="l00792"></a>00792       <span class="comment">//std::char_traits&lt;char&gt;::int_type c =</span>
<a name="l00793"></a>00793       is.get(); <span class="comment">// c not used  TODO!!!!!!!!!!!!!!</span>
<a name="l00794"></a>00794       isPlus = <span class="keyword">true</span>;
<a name="l00795"></a>00795       <a class="code" href="uncmanapp_8cpp.html#a676c7b527f8549b9a1159b5c17291a0a">int_char</a> p = is.peek();
<a name="l00796"></a>00796       <span class="keywordflow">if</span> (p == <span class="charliteral">&#39;/&#39;</span> || p == <span class="charliteral">&#39;|&#39;</span> || p == 0xdd)  <span class="comment">// 0xdd is File code for |</span>
<a name="l00797"></a>00797       {  <span class="comment">// +/- and +|- both allowed.</span>
<a name="l00798"></a>00798         <span class="comment">// Assume +/+ values just + and -/-  or values just -.</span>
<a name="l00799"></a>00799         is.get();
<a name="l00800"></a>00800         <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;+&#39;</span>)
<a name="l00801"></a>00801         {
<a name="l00802"></a>00802           isPlus = <span class="keyword">true</span>;
<a name="l00803"></a>00803           <span class="keywordflow">if</span> (isMinus)
<a name="l00804"></a>00804           {
<a name="l00805"></a>00805             isPlusMinus = <span class="keyword">true</span>;  <span class="comment">// If plus or minus.</span>
<a name="l00806"></a>00806           }
<a name="l00807"></a>00807           <span class="comment">// else +/+</span>
<a name="l00808"></a>00808           is.get();
<a name="l00809"></a>00809           is &gt;&gt; expUnc;  <span class="comment">// Explicit uncertainty.</span>
<a name="l00810"></a>00810           <span class="keywordflow">if</span> (!is.fail())
<a name="l00811"></a>00811           { <span class="comment">// OK, set bits.</span>
<a name="l00812"></a>00812             types |= (<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00813"></a>00813           }
<a name="l00814"></a>00814           <span class="keywordflow">else</span>
<a name="l00815"></a>00815           { <span class="comment">// NotOK so clear.</span>
<a name="l00816"></a>00816             types &amp;= ~(<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00817"></a>00817           }
<a name="l00818"></a>00818         }  <span class="comment">// == &#39;+&#39;</span>
<a name="l00819"></a>00819         <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;-&#39;</span>)
<a name="l00820"></a>00820         {
<a name="l00821"></a>00821           isMinus = <span class="keyword">true</span>;
<a name="l00822"></a>00822           <span class="keywordflow">if</span> (isPlus)
<a name="l00823"></a>00823           {
<a name="l00824"></a>00824             isPlusMinus = <span class="keyword">true</span>;  <span class="comment">// If plus or minus.</span>
<a name="l00825"></a>00825           }
<a name="l00826"></a>00826           <span class="comment">// else -/-</span>
<a name="l00827"></a>00827           is.get();
<a name="l00828"></a>00828           is &gt;&gt; expUnc; <span class="comment">// Explicit uncertainty.</span>
<a name="l00829"></a>00829           <span class="keywordflow">if</span> (!is.fail())
<a name="l00830"></a>00830           { <span class="comment">// OK, set bits.</span>
<a name="l00831"></a>00831             types |= (<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00832"></a>00832           }
<a name="l00833"></a>00833           <span class="keywordflow">else</span>
<a name="l00834"></a>00834           { <span class="comment">// NotOK so clear.</span>
<a name="l00835"></a>00835             types &amp;= ~(<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00836"></a>00836           }
<a name="l00837"></a>00837         } <span class="comment">// == &#39;-&#39;</span>
<a name="l00838"></a>00838       }
<a name="l00839"></a>00839     } <span class="comment">// == &#39;+&#39;</span>
<a name="l00840"></a>00840     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;-&#39;</span>)
<a name="l00841"></a>00841     {
<a name="l00842"></a>00842       is.get();
<a name="l00843"></a>00843       isMinus = <span class="keyword">true</span>;
<a name="l00844"></a>00844       <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;/&#39;</span> || is.peek() == <span class="charliteral">&#39;|&#39;</span>)
<a name="l00845"></a>00845       {  <span class="comment">// +/- and +|- both allowed.</span>
<a name="l00846"></a>00846         <span class="comment">// Assume +/+ and -/- values just + or - .</span>
<a name="l00847"></a>00847         is.get();
<a name="l00848"></a>00848         <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;+&#39;</span>)
<a name="l00849"></a>00849         {
<a name="l00850"></a>00850           isPlus = <span class="keyword">true</span>;
<a name="l00851"></a>00851           <span class="keywordflow">if</span> (isMinus)
<a name="l00852"></a>00852           {
<a name="l00853"></a>00853             isPlusMinus = <span class="keyword">true</span>;  <span class="comment">// If plus or minus.</span>
<a name="l00854"></a>00854           }
<a name="l00855"></a>00855           <span class="comment">// else +/+</span>
<a name="l00856"></a>00856           is.get();
<a name="l00857"></a>00857           is &gt;&gt; expUnc;  <span class="comment">// Explicit uncertainty.</span>
<a name="l00858"></a>00858           <span class="keywordflow">if</span> (!is.fail())
<a name="l00859"></a>00859           { <span class="comment">// OK, set bits.</span>
<a name="l00860"></a>00860             types |= (<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00861"></a>00861           }
<a name="l00862"></a>00862           <span class="keywordflow">else</span>
<a name="l00863"></a>00863           { <span class="comment">// NotOK so clear.</span>
<a name="l00864"></a>00864             types &amp;= ~(<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00865"></a>00865           }
<a name="l00866"></a>00866 
<a name="l00867"></a>00867         }
<a name="l00868"></a>00868         <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;-&#39;</span>)
<a name="l00869"></a>00869         {
<a name="l00870"></a>00870           isMinus = <span class="keyword">true</span>;
<a name="l00871"></a>00871           <span class="keywordflow">if</span> (isPlus)
<a name="l00872"></a>00872           {
<a name="l00873"></a>00873             isPlusMinus = <span class="keyword">true</span>;  <span class="comment">// If plus or minus.</span>
<a name="l00874"></a>00874           }
<a name="l00875"></a>00875           <span class="comment">// else -/-</span>
<a name="l00876"></a>00876           is.get();
<a name="l00877"></a>00877           is &gt;&gt; expUnc; <span class="comment">// Explicit uncertainty.</span>
<a name="l00878"></a>00878           <span class="keywordflow">if</span> (!is.fail())
<a name="l00879"></a>00879           { <span class="comment">// OK, so set bits.</span>
<a name="l00880"></a>00880             types |= (<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00881"></a>00881           }
<a name="l00882"></a>00882           <span class="keywordflow">else</span>
<a name="l00883"></a>00883           { <span class="comment">// NotOK so clear.</span>
<a name="l00884"></a>00884             types &amp;= ~(<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00885"></a>00885           }
<a name="l00886"></a>00886         }
<a name="l00887"></a>00887       }
<a name="l00888"></a>00888     }  <span class="comment">// == &#39;-&#39;</span>
<a name="l00889"></a>00889     <span class="keywordflow">if</span> (expUnc &gt;= 0)
<a name="l00890"></a>00890     {  <span class="comment">// Should never go negative.</span>
<a name="l00891"></a>00891       cerr &lt;&lt; <span class="stringliteral">&quot;Explicit +/- &quot;</span> &lt;&lt; expUnc;
<a name="l00892"></a>00892       types |= (<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a>);
<a name="l00893"></a>00893 
<a name="l00894"></a>00894       stdDeviation = expUnc;
<a name="l00895"></a>00895       <span class="keywordflow">if</span> (!isPlusMinus)  <span class="comment">// Only + or -, but not both.</span>
<a name="l00896"></a>00896       {
<a name="l00897"></a>00897         <span class="keywordflow">if</span> (isPlus) types |= <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a5d47c395882673b486113eb7de38a73f">UNC_NOMINUS</a>;
<a name="l00898"></a>00898         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isMinus) types |= <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a10120ed09bb2013a9640635f2a799fbc">UNC_NOPLUS</a>;
<a name="l00899"></a>00899       }
<a name="l00900"></a>00900     }
<a name="l00901"></a>00901     <span class="comment">// degrees of freedom as (99) might follow.</span>
<a name="l00902"></a>00902     <span class="comment">// already set degreesOfFreedom = 0;  // Default == 1 observation.</span>
<a name="l00903"></a>00903     is &gt;&gt; ws; <span class="comment">// eat any whitespace before (99).</span>
<a name="l00904"></a>00904     <span class="keywordflow">if</span> (is.peek() == <span class="charliteral">&#39;(&#39;</span>)
<a name="l00905"></a>00905     { <span class="comment">// (99) ?</span>
<a name="l00906"></a>00906       <a class="code" href="uncmanapp_8cpp.html#a676c7b527f8549b9a1159b5c17291a0a">int_char</a> c =      is.get();  <span class="comment">// &#39;(&#39;</span>
<a name="l00907"></a>00907       <span class="keywordtype">long</span> df;
<a name="l00908"></a>00908       <span class="comment">// degreesOfFreedom is only unsigned short 16 bit integer, so might overflow.</span>
<a name="l00909"></a>00909       is &gt;&gt; df;  <span class="comment">// read into temporary to do some checks.</span>
<a name="l00910"></a>00910       <span class="keywordflow">if</span> (is.fail()) <span class="comment">// int not read</span>
<a name="l00911"></a>00911       {
<a name="l00912"></a>00912         degreesOfFreedom = std::numeric_limits&lt;unsigned short int&gt;::max(); <span class="comment">//0xFFFF; = Not known.</span>
<a name="l00913"></a>00913         types &amp;= ~(<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ac81ce34078572393881cc54d19c6a7b8">DEG_FREE_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a6d646b27d92c48dec8b1e8723131f600">DEG_FREE_EXACT</a>);
<a name="l00914"></a>00914       }
<a name="l00915"></a>00915       <span class="keywordflow">else</span>
<a name="l00916"></a>00916       {  <span class="comment">// long degrees of freedom read OK and &gt;=0, but check not too big.</span>
<a name="l00917"></a>00917         <span class="keywordflow">if</span> (df &lt; 0)  <span class="comment">// Can&#39;t have negative degrees of freedom!</span>
<a name="l00918"></a>00918         {
<a name="l00919"></a>00919           degreesOfFreedom = std::numeric_limits&lt;unsigned short int&gt;::max(); <span class="comment">//0xFFFF; = Not known.</span>
<a name="l00920"></a>00920           types &amp;= ~(<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ac81ce34078572393881cc54d19c6a7b8">DEG_FREE_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a6d646b27d92c48dec8b1e8723131f600">DEG_FREE_EXACT</a>); <span class="comment">// NOT defined.</span>
<a name="l00921"></a>00921         }
<a name="l00922"></a>00922         <span class="keywordflow">else</span>
<a name="l00923"></a>00923         {
<a name="l00924"></a>00924           degreesOfFreedom =
<a name="l00925"></a>00925             (df &gt;= std::numeric_limits&lt;unsigned short int&gt;::max()) ?
<a name="l00926"></a>00926             static_cast&lt;unsigned short int&gt;(std::numeric_limits&lt;unsigned short int&gt;::max() -1)
<a name="l00927"></a>00927             <span class="comment">// max df allowed.</span>
<a name="l00928"></a>00928             : static_cast&lt;unsigned short int&gt;(df - 1); <span class="comment">// 1 observation == 0 degfree.</span>
<a name="l00929"></a>00929         }
<a name="l00930"></a>00930         c =     is.peek();  <span class="comment">// Expect &#39;)&#39;</span>
<a name="l00931"></a>00931         <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;)&#39;</span>)
<a name="l00932"></a>00932         {
<a name="l00933"></a>00933           is.get();  <span class="comment">// &#39;)&#39;</span>
<a name="l00934"></a>00934           types |= (<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ac81ce34078572393881cc54d19c6a7b8">DEG_FREE_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a6d646b27d92c48dec8b1e8723131f600">DEG_FREE_EXACT</a>);  <span class="comment">// deg_free IS known.</span>
<a name="l00935"></a>00935         }
<a name="l00936"></a>00936         <span class="keywordflow">if</span> (c != <span class="charliteral">&#39;)&#39;</span> || (is.fail()) )
<a name="l00937"></a>00937         {
<a name="l00938"></a>00938           degreesOfFreedom = std::numeric_limits&lt;unsigned short int&gt;::max(); <span class="comment">//0xFFFF; = Not known.</span>
<a name="l00939"></a>00939           types &amp;= ~(<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ac81ce34078572393881cc54d19c6a7b8">DEG_FREE_KNOWN</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a6d646b27d92c48dec8b1e8723131f600">DEG_FREE_EXACT</a>); <span class="comment">// NOT defined.</span>
<a name="l00940"></a>00940         }
<a name="l00941"></a>00941       }
<a name="l00942"></a>00942     } <span class="comment">// Read degFree (99)</span>
<a name="l00943"></a>00943     <span class="keywordflow">else</span>
<a name="l00944"></a>00944     { <span class="comment">// No (df)</span>
<a name="l00945"></a>00945       types |= <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ac81ce34078572393881cc54d19c6a7b8">DEG_FREE_KNOWN</a> ;  <span class="comment">// deg_free IS known, but not exact.</span>
<a name="l00946"></a>00946     }
<a name="l00947"></a>00947   <span class="keywordflow">if</span> (trace)
<a name="l00948"></a>00948   {
<a name="l00949"></a>00949     cerr &lt;&lt; <span class="stringliteral">&quot;\n&gt;&gt;&gt; UncertainRead:&quot;</span><span class="stringliteral">&quot;\n&quot;</span><span class="stringliteral">&quot;value &quot;</span>
<a name="l00950"></a>00950       &lt;&lt; setprecision (std::numeric_limits&lt;double&gt;::digits10)&lt;&lt; value
<a name="l00951"></a>00951       &lt;&lt; setprecision (std::numeric_limits&lt;float&gt;::digits10) &lt;&lt; <span class="stringliteral">&quot;, SD &quot;</span> &lt;&lt; stdDeviation
<a name="l00952"></a>00952       &lt;&lt; <span class="stringliteral">&quot;, df &quot;</span> &lt;&lt; dec &lt;&lt; degreesOfFreedom
<a name="l00953"></a>00953       &lt;&lt; <span class="stringliteral">&quot;, uncFlags: &quot;</span> &lt;&lt; hex &lt;&lt; is.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>)       &lt;&lt; dec &lt;&lt; boolalpha 
<a name="l00954"></a>00954       &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; showUncTypes(types)
<a name="l00955"></a>00955       &lt;&lt; endl;
<a name="l00956"></a>00956   }
<a name="l00957"></a>00957   <span class="comment">// Restore is flags?</span>
<a name="l00958"></a>00958 } <span class="comment">// void uncertainRead(double&amp; value,  double&amp; stdDeviation,</span>
<a name="l00959"></a>00959   <span class="comment">//    unsigned short int&amp; degreesOfFreedom, unsigned short int&amp; types, istream&amp; is);</span>
<a name="l00960"></a>00960 
<a name="l00961"></a>00961 
<a name="l00962"></a><a class="code" href="uncmanapp_8cpp.html#ad557d4bbf09fc9c5be7fe73797f2858e">00962</a> <span class="keywordtype">void</span> <a class="code" href="uncmanapp_8cpp.html#ad557d4bbf09fc9c5be7fe73797f2858e">uncertainPrint</a>(
<a name="l00963"></a>00963                     <span class="keywordtype">double</span> value, <span class="comment">// Mean or most likely value.</span>
<a name="l00964"></a>00964                     <span class="keywordtype">float</span> stdDeviation, <span class="comment">// Standard deviation.</span>
<a name="l00965"></a>00965                     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> degFree, <span class="comment">// Degrees of freedom.</span>
<a name="l00966"></a>00966                     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> uncTypes, <span class="comment">// 16 Uncertain type flags.</span>
<a name="l00967"></a>00967                     ostream&amp; os = cout)  <span class="comment">// Output stream, default cout.</span>
<a name="l00968"></a>00968 {
<a name="l00969"></a>00969   <span class="comment">// const int savedWidth = os.width();  //  NOT useful to restore ios.</span>
<a name="l00970"></a>00970   <span class="keyword">const</span> <span class="keywordtype">int</span> savedUncFlags = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>);  <span class="comment">// For restore?</span>
<a name="l00971"></a>00971   <span class="keyword">const</span> <span class="keywordtype">int</span> savedUncWidth = os.iword(<a class="code" href="_test_quan1_8cpp.html#a7edb6c5c7929c3cde8986c34985cd884">uncWidthIndex</a>); <span class="comment">// For restore?</span>
<a name="l00972"></a>00972   <span class="keywordtype">int</span> uncWidth = os.iword(<a class="code" href="_test_quan1_8cpp.html#a7edb6c5c7929c3cde8986c34985cd884">uncWidthIndex</a>);
<a name="l00973"></a>00973   <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span> uncFlags = <span class="keyword">static_cast&lt;</span><span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> <span class="keywordtype">int</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>));
<a name="l00974"></a>00974   <span class="keyword">const</span> <span class="keywordtype">double</span> DIGITS_STEP = 1.9999; <span class="comment">// When to change number of digits:</span>
<a name="l00975"></a>00975   <span class="comment">// If is 1.9999 then display 0.10 to 0.19 but 0.2 to 0.9.</span>
<a name="l00976"></a>00976 
<a name="l00977"></a>00977   <span class="keywordflow">if</span> (trace)
<a name="l00978"></a>00978   {
<a name="l00979"></a>00979     cerr &lt;&lt; <span class="stringliteral">&quot;\n&lt;&lt;&lt; UncertainPrint: &quot;</span>
<a name="l00980"></a>00980       &lt;&lt; setprecision (std::numeric_limits&lt;double&gt;::digits10) &lt;&lt; value
<a name="l00981"></a>00981       &lt;&lt; setprecision (std::numeric_limits&lt;float&gt;::digits10) &lt;&lt; <span class="stringliteral">&quot;, SD &quot;</span> &lt;&lt; stdDeviation
<a name="l00982"></a>00982       &lt;&lt; <span class="stringliteral">&quot;, df &quot;</span> &lt;&lt; dec &lt;&lt; degFree
<a name="l00983"></a>00983       &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; showUncFlags(uncFlags) <span class="comment">// == os.iword(uncFlagsIndex)</span>
<a name="l00984"></a>00984       &lt;&lt; <span class="stringliteral">&quot;, &quot;</span>&lt;&lt; showUncTypes(uncTypes)
<a name="l00985"></a>00985       &lt;&lt; <span class="stringliteral">&quot;, uncWidth = &quot;</span> &lt;&lt; dec &lt;&lt; uncWidth &lt;&lt; endl;
<a name="l00986"></a>00986   }
<a name="l00987"></a>00987   <span class="keywordtype">bool</span> isNoisyDigit = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdab5a6082eb1bac1b504465d874da18664">noisyDigit</a>);
<a name="l00988"></a>00988   <span class="keywordtype">bool</span> isPlusMinus = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda8df10473f985e1e141fe13ce1da4b2e7">plusMinus</a>);
<a name="l00989"></a>00989   <span class="comment">// Uncertainty as +/- is required too (but ignore if exact or integer).</span>
<a name="l00990"></a>00990   <span class="keywordtype">bool</span> isDegfree = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>((os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaac97fd648aedffb05975e58a9531eee9">degfree</a>) &amp;&amp; (uncTypes &amp; <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ac81ce34078572393881cc54d19c6a7b8">DEG_FREE_KNOWN</a>));
<a name="l00991"></a>00991   <span class="keywordtype">bool</span> isLimits =   <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda12e427a814d05cf13103a609ef21c2f0">limits</a>);
<a name="l00992"></a>00992   <span class="keywordtype">bool</span> isReplicates = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>((os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaff39f67935d3386b19b8a89be2eb711a">replicates</a>) &amp;&amp; (uncTypes &amp; DEG_FREE_KNOWN) &amp;&amp; (degFree &gt; 0));
<a name="l00993"></a>00993   <span class="keywordtype">bool</span> isExactValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>  <span class="comment">// If both NOPLUS AND NOMINUS bits = 1.</span>
<a name="l00994"></a>00994     ( ((uncTypes &amp; VALUE_EXACT) == VALUE_EXACT) <span class="comment">// Both UNC_NOPLUS &amp; NOMINUS bits set.</span>
<a name="l00995"></a>00995       || (uncTypes &amp; (<a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a4dbdbb9f0703c560765df0b495e2e08e">VALUE_INTEGER</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387af56de87cd01d5725c429f2fc72f855da">VALUE_RATIONAL</a>)) );
<a name="l00996"></a>00996       <span class="comment">// Integers and Rationals are all implicitly exact, but zero is NOT necessarily .</span>
<a name="l00997"></a>00997 
<a name="l00998"></a>00998   <span class="keywordtype">bool</span> isIntegerValue = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(uncTypes &amp; <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a4dbdbb9f0703c560765df0b495e2e08e">VALUE_INTEGER</a>);
<a name="l00999"></a>00999   <span class="keywordflow">if</span> (isExactValue || isIntegerValue )
<a name="l01000"></a>01000   {
<a name="l01001"></a>01001     stdDeviation = 0.0f;  <span class="comment">// uncTypes take precedence over value of stdDeviation.  Best?</span>
<a name="l01002"></a>01002     degFree = (<span class="keywordtype">unsigned</span> short)0;
<a name="l01003"></a>01003     <span class="comment">// May be useful convention that exact values have 1 reading &amp; so degFree == 0?</span>
<a name="l01004"></a>01004     isPlusMinus = <span class="keyword">false</span>;  <span class="comment">// because exact.</span>
<a name="l01005"></a>01005   }  <span class="comment">// exact or integer</span>
<a name="l01006"></a>01006 
<a name="l01007"></a>01007   <span class="keywordtype">bool</span> uncKnown = uncTypes &amp; <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a>; <span class="comment">// Uncertainty is Known.</span>
<a name="l01008"></a>01008   <span class="comment">// !_finite(double(stdDeviation))) // should be (double) but seems to work with both.</span>
<a name="l01009"></a>01009   <span class="keywordflow">if</span> (!_finite(stdDeviation))
<a name="l01010"></a>01010   {     <span class="comment">// SD is NaN or infinity.</span>
<a name="l01011"></a>01011     <span class="keywordflow">if</span> (!_isnan(stdDeviation)) <span class="comment">// stdDeviation == infinity.</span>
<a name="l01012"></a>01012     {   <span class="comment">// If SD == +infinity, then convention is that value is undefined too.</span>
<a name="l01013"></a>01013       value = QNaN; <span class="comment">// std::numeric_limits&lt;double&gt;::quiet_NaN();</span>
<a name="l01014"></a>01014       uncTypes = 0U;
<a name="l01015"></a>01015       isExactValue = <span class="keyword">false</span>;
<a name="l01016"></a>01016       isIntegerValue = <span class="keyword">false</span>;
<a name="l01017"></a>01017       uncKnown = <span class="keyword">false</span>;
<a name="l01018"></a>01018     }
<a name="l01019"></a>01019     <span class="keywordflow">else</span>  <span class="comment">// If not infinity then must be NaN.</span>
<a name="l01020"></a>01020     { <span class="comment">// SD == NaN then SD undefined, but value is OK, so leave the VALUE unc_types.</span>
<a name="l01021"></a>01021       uncTypes &amp;= ~(UNC_KNOWN | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a10120ed09bb2013a9640635f2a799fbc">UNC_NOPLUS</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a5d47c395882673b486113eb7de38a73f">UNC_NOMINUS</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387ad390fdd921c136180ceb271f498f450b">UNC_QUAN_DECIMAL</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a4cf174c7d02ea9c53ef092e7eff71f6d">UNC_QUAN_BINARY</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387acf9d469a96dfa8cbf7ef3d753b4d4bbe">UNC_RECTANGULAR</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387af426cf32f3cbb354af02e42c2685e7a0">UNC_TRIANGULAR</a>);
<a name="l01022"></a>01022       isExactValue = <span class="keyword">false</span>; 
<a name="l01023"></a>01023       uncKnown = <span class="keyword">false</span>;
<a name="l01024"></a>01024     }
<a name="l01025"></a>01025     <span class="comment">// (stdDeviation == INFINITYf)  // test doesn&#39;t work usefully!</span>
<a name="l01026"></a>01026     <span class="comment">// if ((stdDeviation == NaNf) || (stdDeviation == SNaNf)) always succeeds!</span>
<a name="l01027"></a>01027   }
<a name="l01028"></a>01028   <span class="keywordflow">else</span>  <span class="comment">// stdDeviation is finite &amp; uncertainty is known.</span>
<a name="l01029"></a>01029   <span class="keywordflow">if</span> ((0.f == stdDeviation) &amp;&amp; ((uncTypes &amp; <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a3468dd60340b5a8782fcb9e9ac211eec">UNC_KNOWN</a>) == UNC_KNOWN) ) <span class="comment">// Explicitly exact.</span>
<a name="l01030"></a>01030   {
<a name="l01031"></a>01031     uncKnown = <span class="keyword">true</span>;
<a name="l01032"></a>01032     isExactValue = <span class="keyword">true</span>;
<a name="l01033"></a>01033   }
<a name="l01034"></a>01034   <span class="keywordflow">else</span>
<a name="l01035"></a>01035   { <span class="comment">// Not exact, so may want to display limits.</span>
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (isLimits)
<a name="l01037"></a>01037     { <span class="comment">// Show lower limit value - uncertainty.</span>
<a name="l01038"></a>01038       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> oldFlags = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>); <span class="comment">// Save to allow restore for central value.</span>
<a name="l01039"></a>01039       <span class="comment">// MUST Switch off display of limits - or will recurse for ever!</span>
<a name="l01040"></a>01040       <span class="comment">// And switch off degrees of freedom and plusminus, etc because misleading.</span>
<a name="l01041"></a>01041       os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~(<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda8df10473f985e1e141fe13ce1da4b2e7">plusMinus</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda12e427a814d05cf13103a609ef21c2f0">limits</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaac97fd648aedffb05975e58a9531eee9">degfree</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdab5a6082eb1bac1b504465d874da18664">noisyDigit</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda6baa1727b244f9c27c5fa1ffcac571d0">addSISymbol</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaff39f67935d3386b19b8a89be2eb711a">replicates</a>);
<a name="l01042"></a>01042       <span class="comment">// clear bits = 0 to mean these items NOT shown.</span>
<a name="l01043"></a>01043       <a class="code" href="uncmanapp_8cpp.html#ad557d4bbf09fc9c5be7fe73797f2858e">uncertainPrint</a>(value - stdDeviation, stdDeviation, degFree, UNC_KNOWN | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a6d646b27d92c48dec8b1e8723131f600">DEG_FREE_EXACT</a> | DEG_FREE_KNOWN, os);
<a name="l01044"></a>01044       os &lt;&lt; <span class="stringliteral">&quot; &lt; &quot;</span>; <span class="comment">// So display format is 1.2 &lt; 1.3 &lt; 1.4  or  1.2 &lt; 1.3 +/-0.05 &lt; 1.4</span>
<a name="l01045"></a>01045       os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = oldFlags; <span class="comment">// Restore for display of limits other items after central value.</span>
<a name="l01046"></a>01046     }
<a name="l01047"></a>01047   }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049   std::streamsize used = 0; <span class="comment">// Count of non-padding chars actually used.</span>
<a name="l01050"></a>01050   <span class="keyword">const</span> <span class="keywordtype">short</span> expDigits = 2;  <span class="comment">// Number of exponent digits, 2 for float</span>
<a name="l01051"></a>01051   <span class="comment">// 3 can be necessary for double (max exponent 340), (4 for long double).</span>
<a name="l01052"></a>01052   <span class="comment">// Simplest to just provide space for 2 as &gt;e100 is rare and consequence</span>
<a name="l01053"></a>01053   <span class="comment">// is only layout disruption (one or two extra characters)</span>
<a name="l01054"></a>01054   <span class="keyword">const</span> <span class="keywordtype">char</span>* SIsymbol = <a class="code" href="_s_iunits_8cpp.html#a44d651cc217e356bec54cfe98c5d79aa">SIsymbols</a>[<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];  <span class="comment">// n, u, m, k, M, G ...</span>
<a name="l01055"></a>01055   <span class="keyword">const</span> <span class="keywordtype">char</span>* SIprefix = <a class="code" href="_s_iunits_8cpp.html#a30b2140828093227adce3b2b8a0da747">SIprefixes</a>[<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];  <span class="comment">// nano, micro, milli ...</span>
<a name="l01056"></a>01056   <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> SIindex = <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>;  <span class="comment">// unity so SI symbol &amp; prefix == &quot;&quot;</span>
<a name="l01057"></a>01057   <span class="keyword">const</span> <span class="keywordtype">long</span> savedFlags = os.flags();  <span class="comment">// Save in case need to restore ios.</span>
<a name="l01058"></a>01058 
<a name="l01059"></a>01059   <span class="keywordflow">if</span> (!_finite(value))
<a name="l01060"></a>01060   <span class="comment">// if ( (value == NaN)|| (value == SNaN)|| (value == INFINITY) )</span>
<a name="l01061"></a>01061   {
<a name="l01062"></a>01062     os &lt;&lt; <span class="stringliteral">&quot;? &quot;</span>; used = 2;  <span class="comment">// &quot;? &quot;  space needed?</span>
<a name="l01063"></a>01063   }
<a name="l01064"></a>01064   <span class="keywordflow">else</span>
<a name="l01065"></a>01065   {  <span class="comment">// value is finite, so can test if negative or zero.</span>
<a name="l01066"></a>01066     <span class="keyword">const</span> <span class="keywordtype">double</span> savedValue = value;  <span class="comment">// Save in case need original.</span>
<a name="l01067"></a>01067     <span class="keywordtype">bool</span> isNegativeValue = (value &lt; 0.0);
<a name="l01068"></a>01068     <span class="keywordtype">bool</span> isZeroValue = (0.0 == value);
<a name="l01069"></a>01069     <span class="keywordflow">if</span> (isNegativeValue)
<a name="l01070"></a>01070     {
<a name="l01071"></a>01071       value =  fabs (value);  <span class="comment">// Can now ignore effect of negativeness.</span>
<a name="l01072"></a>01072     }  <span class="comment">// isNegativeValue</span>
<a name="l01073"></a>01073     <span class="keywordtype">bool</span> firmFormat = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda88b7d5932278a29836942737aca6888d">firm</a>;
<a name="l01074"></a>01074     <span class="comment">// Firm (nearly fixed) width suits tables.</span>
<a name="l01075"></a>01075     <span class="comment">// Width&lt;=0 taken to mean no justification or padding.</span>
<a name="l01076"></a>01076     <span class="comment">// Since default width after each item output = 0, defaults to flexFormat.</span>
<a name="l01077"></a>01077     <span class="keywordtype">bool</span> flexFormat = !firmFormat;
<a name="l01078"></a>01078     <span class="comment">// Suitable for free non-tabulated layout.</span>
<a name="l01079"></a>01079     <span class="comment">// Width&lt;=0 taken to mean no justification or padding.</span>
<a name="l01080"></a>01080     <span class="comment">// Since default width after each item output = 0, defaults to flexFormat.</span>
<a name="l01081"></a>01081     <span class="keywordtype">bool</span> isSetScale = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda4f01a573a3bde4134360c61b86e0deb9">setScaled</a>);
<a name="l01082"></a>01082     <span class="comment">// Defined to mean scale to suitable power of 10.</span>
<a name="l01083"></a>01083     <span class="comment">// Signal need to use SI symbol like M, k... , or prefix.</span>
<a name="l01084"></a>01084     <span class="comment">// for example: 2 for c, 3 for k, 6 for M, -3 for m,</span>
<a name="l01085"></a>01085     <span class="keywordtype">int</span> scaler = (isSetScale) ? os.iword(<a class="code" href="unc_init_8cpp.html#ab19a26cad50b9d4c92873496706e98f9">uncSetScaleIndex</a>) : 0;
<a name="l01086"></a>01086     <span class="comment">// If setscale then scaled to SI multiple set by SetScale(int).</span>
<a name="l01087"></a>01087     <span class="keywordflow">if</span> (abs(scaler) &gt; <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>)  <span class="comment">// Setscale value must be -24 to +24!</span>
<a name="l01088"></a>01088       <span class="comment">// (probably caused by a programming error?)</span>
<a name="l01089"></a>01089     {   <span class="comment">// Don&#39;t bother to try (&amp; may well fail to display too)</span>
<a name="l01090"></a>01090       scaler = 0; <span class="comment">// 10**0 = unity</span>
<a name="l01091"></a>01091       isSetScale = <span class="keyword">false</span>;
<a name="l01092"></a>01092       <span class="keywordflow">if</span> (trace)
<a name="l01093"></a>01093       {
<a name="l01094"></a>01094         cerr &lt;&lt; <span class="stringliteral">&quot;scale &quot;</span> &lt;&lt; scaler &lt;&lt; <span class="stringliteral">&quot; SI max power of ten &quot;</span> &lt;&lt; <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a> &lt;&lt;
<a name="l01095"></a>01095           <span class="stringliteral">&quot; will not be scaled &amp; will show as exp format!&quot;</span>&lt;&lt; endl;
<a name="l01096"></a>01096       }  <span class="comment">// trace</span>
<a name="l01097"></a>01097     } <span class="comment">// scaler check.</span>
<a name="l01098"></a>01098     <span class="keywordtype">bool</span> isAutoScale = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdabcf7e726f642019083e91a3e3b394bfc">autoScaled</a>);
<a name="l01099"></a>01099     <span class="comment">// Automatically scales to suit the value.</span>
<a name="l01100"></a>01100     <span class="comment">// If isSetScale (but not auto) power of 10 ** scale, using value of scaler,</span>
<a name="l01101"></a>01101     <span class="comment">// else just the unit, for example 123.4 g.</span>
<a name="l01102"></a>01102     <span class="keywordflow">if</span> (isAutoScale)
<a name="l01103"></a>01103     {           <span class="comment">// Autoscale overrides Setscale &amp; its scale value is ignored.</span>
<a name="l01104"></a>01104       isSetScale = <span class="keyword">false</span>;
<a name="l01105"></a>01105     }
<a name="l01106"></a>01106     <span class="keywordtype">bool</span> isScaled = isAutoScale || isSetScale;
<a name="l01107"></a>01107     <span class="keywordtype">bool</span> beenScaled = <span class="keyword">false</span>; <span class="comment">// Only set when really has been scaled.</span>
<a name="l01108"></a>01108 
<a name="l01109"></a>01109     <span class="comment">// Format flags from ios.</span>
<a name="l01110"></a>01110     <span class="keywordtype">int</span> iosFlags = os.flags();
<a name="l01111"></a>01111     <span class="keywordtype">bool</span> isUppercase = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::uppercase);
<a name="l01112"></a>01112     <span class="keywordtype">bool</span> isExpFormat = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::scientific);
<a name="l01113"></a>01113     <span class="comment">// Taken to mean that exponential format wanted (always possible).</span>
<a name="l01114"></a>01114     <span class="keywordflow">if</span> (isAutoScale) isExpFormat = <span class="keyword">false</span>;  <span class="comment">// Autoscale overrides expformat.</span>
<a name="l01115"></a>01115     <span class="keywordtype">bool</span> isFixed = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::fixed);
<a name="l01116"></a>01116     <span class="comment">// Taken to mean that d.dddd format wanted, if possible.</span>
<a name="l01117"></a>01117     <span class="keywordtype">bool</span> leftJustify = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::left);
<a name="l01118"></a>01118     <span class="comment">// left justify, pad after. (only for firmFormat).</span>
<a name="l01119"></a>01119     <span class="keywordtype">bool</span> rightJustify = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::right);
<a name="l01120"></a>01120     <span class="comment">// right justify, pad before (only for firmFormat)</span>
<a name="l01121"></a>01121     <span class="keywordtype">bool</span> intJustify = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::internal);
<a name="l01122"></a>01122     <span class="comment">// Interpretation not defined yet, but might use to center in field?</span>
<a name="l01123"></a>01123     <span class="keywordtype">bool</span> uppercase = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>( iosFlags &amp; ios::uppercase);
<a name="l01124"></a>01124     <span class="comment">// Exponential format is, for example, 1E6 else 1e6.</span>
<a name="l01125"></a>01125     <span class="keywordtype">bool</span> showPoint = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::showpoint);
<a name="l01126"></a>01126     <span class="comment">// Means decimal point is always shown, for example 900. even if not needed.</span>
<a name="l01127"></a>01127     <span class="keywordtype">bool</span> showpos = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(iosFlags &amp; ios::showpos);
<a name="l01128"></a>01128     <span class="comment">// Show + sign always.</span>
<a name="l01129"></a>01129     <span class="keywordtype">char</span> expChar = (isUppercase) ? <span class="charliteral">&#39;E&#39;</span> : <span class="charliteral">&#39;e&#39;</span>;  <span class="comment">// For exponential format.</span>
<a name="l01130"></a>01130 
<a name="l01131"></a>01131     <span class="keywordtype">char</span> filler = os.fill();  <span class="comment">// fill char set by os.fill(&#39; &#39;);</span>
<a name="l01132"></a>01132     <span class="keywordflow">if</span> (<span class="keyword">false</span>) {cerr &lt;&lt; std::hexbase &lt;&lt; <span class="stringliteral">&quot;filler &quot;</span> &lt;&lt; int(filler) &lt;&lt; space
<a name="l01133"></a>01133       &lt;&lt; <span class="charliteral">&#39;\&#39;&#39;</span> &lt;&lt; filler &lt;&lt; <span class="charliteral">&#39;\&#39;&#39;</span>&lt;&lt; endl;}
<a name="l01134"></a>01134     <span class="comment">// Default fill char is a space, but use _ while testing.</span>
<a name="l01135"></a>01135     filler = <span class="charliteral">&#39;_&#39;</span>;
<a name="l01136"></a>01136 
<a name="l01137"></a>01137     <span class="keywordtype">char</span> sign = (isNegativeValue) ? <span class="charliteral">&#39;-&#39;</span>: <span class="comment">// Always show -</span>
<a name="l01138"></a>01138     (showpos ? <span class="charliteral">&#39;+&#39;</span> :  <span class="comment">// + only if showpos.</span>
<a name="l01139"></a>01139     (firmFormat ? <span class="charliteral">&#39; &#39;</span> : 0 ) ); <span class="comment">// space where sign char only for firmFormat.</span>
<a name="l01140"></a>01140 
<a name="l01141"></a>01141     <span class="keywordflow">if</span> (isZeroValue)
<a name="l01142"></a>01142     {  <span class="comment">// Keep display of zero simple (&amp; avoid pits like divide by zero!).</span>
<a name="l01143"></a>01143       isAutoScale = <span class="keyword">false</span>; isSetScale = <span class="keyword">false</span>; isExpFormat = <span class="keyword">false</span>;
<a name="l01144"></a>01144       SIsymbol = <a class="code" href="_s_iunits_8cpp.html#a44d651cc217e356bec54cfe98c5d79aa">SIsymbols</a>[<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>]; <span class="comment">// Unity index so NO symbol,</span>
<a name="l01145"></a>01145       SIprefix = <a class="code" href="_s_iunits_8cpp.html#a30b2140828093227adce3b2b8a0da747">SIprefixes</a>[<a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];  <span class="comment">// NOR prefix, both == &quot;&quot;.</span>
<a name="l01146"></a>01146       SIindex = <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>; <span class="comment">// 24</span>
<a name="l01147"></a>01147     }  <span class="comment">// is ZeroValue.</span>
<a name="l01148"></a>01148     <span class="comment">// int precision = os.precision(); // Number of significant decimal digits,</span>
<a name="l01149"></a>01149     std::streamsize savedPrecision = os.precision();  <span class="comment">// Save to restore.</span>
<a name="l01150"></a>01150     <span class="keywordtype">int</span> padleft = 0, padright = 0;  <span class="comment">// Padding to output before &amp; after.</span>
<a name="l01151"></a>01151     std::streamsize  sigFigs = <a class="code" href="_s_iunits_8hpp.html#a81bf85f628cebd9a5de9f91acade1c0b">notOK</a>;  <span class="comment">// Significant digits for value.</span>
<a name="l01152"></a>01152     std::streamsize  sdSigFigs = <a class="code" href="_s_iunits_8hpp.html#a81bf85f628cebd9a5de9f91acade1c0b">notOK</a>;  <span class="comment">// Significant digits for sd.</span>
<a name="l01153"></a>01153     std::streamsize  sigFigsSet = <a class="code" href="_s_iunits_8hpp.html#a81bf85f628cebd9a5de9f91acade1c0b">notOK</a>; <span class="comment">// Unless set by: out &lt;&lt; setSigfigs(4)</span>
<a name="l01154"></a>01154     std::streamsize  uncSigFigsSet = <a class="code" href="_s_iunits_8hpp.html#a81bf85f628cebd9a5de9f91acade1c0b">notOK</a>; <span class="comment">// Unless set by: out &lt;&lt; setUncSigfigs(4)</span>
<a name="l01155"></a>01155     <span class="keywordtype">bool</span> isSigFigsSet
<a name="l01156"></a>01156       = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdacfd989abc9a1f8981aa18c4a7961c1ec">setSigFig</a>);
<a name="l01157"></a>01157     <span class="keywordflow">if</span> (isSigFigsSet)
<a name="l01158"></a>01158     { <span class="comment">// out &lt;&lt; sigfiged signals to use the setsigfigs value.</span>
<a name="l01159"></a>01159       sigFigsSet = os.iword(<a class="code" href="unc_init_8cpp.html#abb85e035433d423441cca46a1410eb56">setSigFigsIndex</a>);
<a name="l01160"></a>01160       <span class="comment">// Use setSigFigs value set by: out &lt;&lt; setSigfigs(4) ...</span>
<a name="l01161"></a>01161     }  <span class="comment">// else need to calculate sigFigs - see below.</span>
<a name="l01162"></a>01162     <span class="keywordtype">bool</span> isUncSigFigsSet
<a name="l01163"></a>01163       = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaf4ddab58ce26b9216745d277e6016a62">setUncSigFig</a>);
<a name="l01164"></a>01164     <span class="keywordflow">if</span> (isUncSigFigsSet)
<a name="l01165"></a>01165     { <span class="comment">// out &lt;&lt; uncsigfiged signals to use the setuncsigfigs value.</span>
<a name="l01166"></a>01166       uncSigFigsSet = os.iword(<a class="code" href="unc_init_8cpp.html#ae9f0027728a2ad546badb0363f3c9590">uncSigFigsIndex</a>);
<a name="l01167"></a>01167       <span class="comment">// Use setUncSigFigs value set by: out &lt;&lt; setUncSigfigs(2) ...</span>
<a name="l01168"></a>01168     }
<a name="l01169"></a>01169     <span class="keywordflow">else</span>
<a name="l01170"></a>01170     { <span class="comment">// Need to calculate sdSigFigs - see more below.</span>
<a name="l01171"></a>01171       sdSigFigs = 1;
<a name="l01172"></a>01172       <span class="comment">// Sigfigs for display of standard deviation as d.d.</span>
<a name="l01173"></a>01173       <span class="comment">// (Increased below if degrees of freedom &gt;= 10).</span>
<a name="l01174"></a>01174     }
<a name="l01175"></a>01175     <span class="keywordflow">if</span> (trace)
<a name="l01176"></a>01176     {
<a name="l01177"></a>01177       cerr &lt;&lt; <span class="stringliteral">&quot;Output Settings: &quot;</span> &lt;&lt; boolalpha &lt;&lt; dec
<a name="l01178"></a>01178         &lt;&lt; (firmFormat ? <span class="stringliteral">&quot;firm &quot;</span> : <span class="stringliteral">&quot;flex &quot;</span>)
<a name="l01179"></a>01179         &lt;&lt; (isAutoScale ? <span class="stringliteral">&quot;autoScale &quot;</span> : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01180"></a>01180         &lt;&lt; (isSetScale ? <span class="stringliteral">&quot;setScale &quot;</span> : <span class="stringliteral">&quot;&quot;</span>) ;
<a name="l01181"></a>01181       <span class="keywordflow">if</span> (isSetScale)
<a name="l01182"></a>01182       {
<a name="l01183"></a>01183         cerr &lt;&lt; <span class="stringliteral">&quot;, set scaler &quot;</span> &lt;&lt; scaler &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;
<a name="l01184"></a>01184       }
<a name="l01185"></a>01185       <span class="keywordflow">if</span> (isScaled)
<a name="l01186"></a>01186       {
<a name="l01187"></a>01187         cerr &lt;&lt; <span class="stringliteral">&quot; isScaled, &quot;</span>  ;
<a name="l01188"></a>01188       }
<a name="l01189"></a>01189       <span class="keywordflow">if</span> (isNegativeValue)
<a name="l01190"></a>01190       {
<a name="l01191"></a>01191         cerr &lt;&lt; <span class="stringliteral">&quot; neg sign, &quot;</span>;
<a name="l01192"></a>01192       }
<a name="l01193"></a>01193       <span class="keywordflow">if</span> (isSigFigsSet)
<a name="l01194"></a>01194       {
<a name="l01195"></a>01195         cerr &lt;&lt; <span class="stringliteral">&quot;SigFigsSet &quot;</span>  &lt;&lt; sigFigsSet
<a name="l01196"></a>01196           &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;
<a name="l01197"></a>01197       }
<a name="l01198"></a>01198       <span class="keywordflow">if</span> (isUncSigFigsSet)
<a name="l01199"></a>01199       {
<a name="l01200"></a>01200         cerr &lt;&lt; <span class="stringliteral">&quot;uncSigfigsSet &quot;</span>  &lt;&lt; uncSigFigsSet &lt;&lt; <span class="charliteral">&#39;,&#39;</span>;
<a name="l01201"></a>01201       }
<a name="l01202"></a>01202       cerr
<a name="l01203"></a>01203         &lt;&lt; (isDegfree ? <span class="stringliteral">&quot; (99) &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01204"></a>01204         &lt;&lt; (isPlusMinus ? <span class="stringliteral">&quot; +/- &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01205"></a>01205         &lt;&lt; (isLimits ? <span class="stringliteral">&quot; &lt; &lt; &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01206"></a>01206         &lt;&lt; (isUppercase ? <span class="stringliteral">&quot;upper &quot;</span> : <span class="stringliteral">&quot;lower &quot;</span>)
<a name="l01207"></a>01207         &lt;&lt; (isExpFormat ? <span class="stringliteral">&quot;expFormat &quot;</span> : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01208"></a>01208         &lt;&lt; (isFixed ? <span class="stringliteral">&quot;fix &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01209"></a>01209         &lt;&lt; (leftJustify  ? <span class="stringliteral">&quot;left &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01210"></a>01210         &lt;&lt; (rightJustify ? <span class="stringliteral">&quot;right &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01211"></a>01211         &lt;&lt; (intJustify ? <span class="stringliteral">&quot;int &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01212"></a>01212         &lt;&lt; (showpos ? <span class="stringliteral">&quot;show + &quot;</span> : <span class="stringliteral">&quot; &quot;</span> )
<a name="l01213"></a>01213         &lt;&lt; (showPoint ? <span class="stringliteral">&quot;show . &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01214"></a>01214         &lt;&lt; (isExactValue ? <span class="stringliteral">&quot;isExactValue &quot;</span> : <span class="stringliteral">&quot; &quot;</span> )
<a name="l01215"></a>01215         &lt;&lt; (isIntegerValue ? <span class="stringliteral">&quot;isIntegerValue &quot;</span> : <span class="stringliteral">&quot; &quot;</span> )
<a name="l01216"></a>01216         &lt;&lt; (isZeroValue ? <span class="stringliteral">&quot;isZeroValue &quot;</span> : <span class="stringliteral">&quot; &quot;</span> )
<a name="l01217"></a>01217         &lt;&lt; (uncKnown ? <span class="stringliteral">&quot;uncKnown &quot;</span> : <span class="stringliteral">&quot; &quot;</span> )
<a name="l01218"></a>01218         &lt;&lt; endl;
<a name="l01219"></a>01219     }  <span class="comment">// trace</span>
<a name="l01220"></a>01220 
<a name="l01221"></a>01221     <span class="comment">// Check value in range 10**+24 or 10**-24 (SI symbols known).</span>
<a name="l01222"></a>01222     <span class="keywordflow">if</span> (!isZeroValue &amp;&amp;
<a name="l01223"></a>01223       (value &lt; <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[<a class="code" href="_s_iunits_8hpp.html#ab0ac556e9c8fe1b807da3ccdf7c9db8f">SIbottomPowerTen</a>]) <span class="comment">// &lt; 10^-24</span>
<a name="l01224"></a>01224        || (value &gt; <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[<a class="code" href="_s_iunits_8hpp.html#af6c3c0e286105087d8da17a5dcdeac87">SItopPowerTen</a>]) ) <span class="comment">// &gt; 10^+24</span>
<a name="l01225"></a>01225     {
<a name="l01226"></a>01226       cerr &lt;&lt; <span class="stringliteral">&quot;Value &quot;</span> &lt;&lt; savedValue
<a name="l01227"></a>01227         &lt;&lt; <span class="stringliteral">&quot; outside range to be output as an uncertain! (&quot;</span>
<a name="l01228"></a>01228         &lt;&lt; <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[0] <span class="comment">// 1E-38 or</span>
<a name="l01229"></a>01229         &lt;&lt; <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[<a class="code" href="_s_iunits_8hpp.html#ab0ac556e9c8fe1b807da3ccdf7c9db8f">SIbottomPowerTen</a>]
<a name="l01230"></a>01230         &lt;&lt; <span class="stringliteral">&quot; to &quot;</span> &lt;&lt; <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[<a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>+<a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>] <span class="comment">// 1E+38</span>
<a name="l01231"></a>01231         &lt;&lt; <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[<a class="code" href="_s_iunits_8hpp.html#af6c3c0e286105087d8da17a5dcdeac87">SItopPowerTen</a>]
<a name="l01232"></a>01232         &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> &lt;&lt; endl;
<a name="l01233"></a>01233       os.precision(sigFigs);
<a name="l01234"></a>01234       os &lt;&lt; scientific &lt;&lt; savedValue;  <span class="comment">// d.dE-99 format</span>
<a name="l01235"></a>01235       <span class="comment">// Restore flags too?</span>
<a name="l01236"></a>01236       os.precision(savedPrecision); <span class="comment">// Restore stream as on entry.</span>
<a name="l01237"></a>01237       os.flags(savedFlags);  <span class="comment">// Restore flags IS useful too.</span>
<a name="l01238"></a>01238       <span class="keywordflow">return</span>;
<a name="l01239"></a>01239     }  <span class="comment">// Check in SI multiples range 10**24.</span>
<a name="l01240"></a>01240 
<a name="l01241"></a>01241     <span class="keywordtype">int</span> place = 0; <span class="comment">// for position of decimal point.</span>
<a name="l01242"></a>01242     <span class="comment">// place == 1 means d.dd...</span>
<a name="l01243"></a>01243     <span class="comment">// If dd.d place = 2, d.d place = 1, 0.d place = 0, 0.0d place -1.</span>
<a name="l01244"></a>01244     <span class="comment">// (Or if extra &#39;noisy&#39; digit wanted).</span>
<a name="l01245"></a>01245     std::streamsize neededWidth = 0; <span class="comment">// To calculate actual width required.</span>
<a name="l01246"></a>01246     <span class="comment">// for firmFormat so can work out padding (and if it won&#39;t fit)</span>
<a name="l01247"></a>01247     <span class="comment">// not sure how to advise that it won&#39;t fit?)</span>
<a name="l01248"></a>01248     <span class="keywordflow">if</span> (showPoint || isNegativeValue) { neededWidth++; }  <span class="comment">// Will show decimal point.</span>
<a name="l01249"></a>01249     <span class="keywordflow">if</span> (sign !=0) { neededWidth++; }  <span class="comment">//  + or - sign char needed.</span>
<a name="l01250"></a>01250     <span class="keywordflow">if</span> (isExpFormat) { neededWidth += 4; }  <span class="comment">// space for E+99</span>
<a name="l01251"></a>01251     std::streamsize pad = uncWidth - neededWidth;  <span class="comment">// number of padding spaces (if any)</span>
<a name="l01252"></a>01252     <span class="keywordflow">if</span> (pad &lt; 0)
<a name="l01253"></a>01253     {  <span class="comment">// Too big for width!</span>
<a name="l01254"></a>01254       cerr &lt;&lt; <span class="stringliteral">&quot;NeededWidth = &quot;</span> &lt;&lt; neededWidth
<a name="l01255"></a>01255         &lt;&lt; <span class="stringliteral">&quot;, but uncWidth only &quot;</span> &lt;&lt; uncWidth &lt;&lt; <span class="stringliteral">&quot; set!&quot;</span> &lt;&lt; endl;
<a name="l01256"></a>01256       <span class="comment">// if (pad=0) fits just right &amp; no padding needed.</span>
<a name="l01257"></a>01257     } <span class="comment">// pad &lt; 0</span>
<a name="l01258"></a>01258 
<a name="l01259"></a>01259     <span class="keywordtype">double</span> roundedValue = 0.0;
<a name="l01260"></a>01260     <span class="keywordtype">double</span> unitsValue = value;
<a name="l01261"></a>01261     <span class="keywordtype">double</span> roundedUnitsValue = unitsValue;
<a name="l01262"></a>01262     <span class="keywordtype">double</span> powerOfTen = (isZeroValue) ? 1.0 : <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[0];  <span class="comment">// 10**-38 to start.</span>
<a name="l01263"></a>01263     <span class="comment">// powerOfTen[maxPowerTen-SImaxPowerTen] starts at 10**-24</span>
<a name="l01264"></a>01264     <span class="keywordtype">double</span> scalePower10 = 0.0;  <span class="comment">// 0.1, 1.0, 10.0 100.0 ... == powersOfTen[?]</span>
<a name="l01265"></a>01265     <span class="keywordtype">float</span> scaledStdDeviation = stdDeviation;  <span class="comment">// Scale later if necessary.</span>
<a name="l01266"></a>01266     <span class="keywordtype">double</span> unitsScaledStdDeviation = double(stdDeviation);
<a name="l01267"></a>01267     <span class="keywordtype">float</span> unitSD = stdDeviation; <span class="comment">// d.dd 10**sdExponent, scaled later perhaps.</span>
<a name="l01268"></a>01268     <span class="keywordtype">float</span> roundedUnitSD = 0.0f; <span class="comment">// d.dd</span>
<a name="l01269"></a>01269     <span class="keywordtype">double</span> SDpowerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[<a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a> - <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];  <span class="comment">// 10**-24</span>
<a name="l01270"></a>01270     <span class="keywordtype">double</span> scaledValue = value; <span class="comment">// = scaledValue * 10**scale10.</span>
<a name="l01271"></a>01271     <span class="keywordtype">int</span> scale10 = 0;  <span class="comment">// power of ten (un-)scaled,</span>
<a name="l01272"></a>01272     <span class="comment">// 0 == scale10 means (un-)scaled by unity. 3 means divided by 1000 ...</span>
<a name="l01273"></a>01273     <span class="keywordflow">if</span> (isScaled)
<a name="l01274"></a>01274     { <span class="comment">// autoscaled or set scaled.</span>
<a name="l01275"></a>01275       <span class="keywordflow">if</span> (isAutoScale &amp;&amp; !isIntegerValue)
<a name="l01276"></a>01276       { <span class="comment">// Try to scale value (already abs(value)) to a multiple of 1000.</span>
<a name="l01277"></a>01277         <span class="comment">// &amp;&amp; !isIntegerValue because pointless.</span>
<a name="l01278"></a>01278         <span class="comment">// &amp;&amp; !isIntegerValue means 1000 m not 1 km.</span>
<a name="l01279"></a>01279         <span class="comment">// &amp;&amp; !isExactValue means 1 inch = 0.0254 m not 2.54 mm.</span>
<a name="l01280"></a>01280         <span class="comment">// if (isAutoScale &amp;&amp; !isZeroValue &amp;&amp; !isExactValue &amp;&amp; !isIntegerValue)</span>
<a name="l01281"></a>01281         <span class="comment">// Don&#39;t try to scale if zero, exact or integer?</span>
<a name="l01282"></a>01282         <span class="comment">// (Already checked to be in range of SI multiples).</span>
<a name="l01283"></a>01283         isScaled = <span class="keyword">true</span>;
<a name="l01284"></a>01284         <span class="keywordflow">while</span> (scaledValue &gt; 1000.0)
<a name="l01285"></a>01285         {
<a name="l01286"></a>01286           scale10 += 3;                 <span class="comment">// Scale to multiple of 1000.</span>
<a name="l01287"></a>01287           scaledValue *= 0.001;  <span class="comment">// FP multiply faster than divide.</span>
<a name="l01288"></a>01288           beenScaled = <span class="keyword">true</span>;
<a name="l01289"></a>01289         }
<a name="l01290"></a>01290         <span class="keywordflow">while</span> (scaledValue &lt; 1.0)  <span class="comment">// d.ddd... or &lt; 0.001 to allow 0.00dd...</span>
<a name="l01291"></a>01291         {
<a name="l01292"></a>01292           scale10 -= 3;
<a name="l01293"></a>01293           scaledValue *= 1000.0;  <span class="comment">// FP multiply faster than divide.</span>
<a name="l01294"></a>01294           beenScaled = <span class="keyword">true</span>;
<a name="l01295"></a>01295         }
<a name="l01296"></a>01296         SIindex = scale10 + <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>;
<a name="l01297"></a>01297         SIsymbol = <a class="code" href="_s_iunits_8cpp.html#a44d651cc217e356bec54cfe98c5d79aa">SIsymbols</a>[scale10 + <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];
<a name="l01298"></a>01298         SIprefix = <a class="code" href="_s_iunits_8cpp.html#a30b2140828093227adce3b2b8a0da747">SIprefixes</a>[scale10 + <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];
<a name="l01299"></a>01299         scalePower10 = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[scale10 + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>]; <span class="comment">// 10**scaler.</span>
<a name="l01300"></a>01300         os.iword(<a class="code" href="unc_init_8cpp.html#a7a01c86a0d10789b38c2635118e80111">uncScaleIndex</a>) = scale10; <span class="comment">// Save for possible subsequent re-use.</span>
<a name="l01301"></a>01301       }  <span class="comment">// if Autoscale.</span>
<a name="l01302"></a>01302       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isSetScale &amp;&amp; !isZeroValue)  <span class="comment">// Can scale if integer or exact?</span>
<a name="l01303"></a>01303       { <span class="comment">// Scale as set to value in scaler,</span>
<a name="l01304"></a>01304         <span class="comment">// for example with &lt;&lt; scale &lt;&lt; setUncScale(6) for M.</span>
<a name="l01305"></a>01305         isScaled = <span class="keyword">true</span>;
<a name="l01306"></a>01306         scale10 = scaler; <span class="comment">// 0 = 10**0 = 1 = no scaling, no symbol nor prefix.</span>
<a name="l01307"></a>01307         <span class="comment">// scaler = 6 means scaled by 10**6</span>
<a name="l01308"></a>01308         <span class="comment">// scaler has already been checked 10**-24 &lt;= scaler &lt;= 10**maxPowerTen</span>
<a name="l01309"></a>01309 
<a name="l01310"></a>01310         SIindex = scale10 + <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>;
<a name="l01311"></a>01311         SIsymbol = <a class="code" href="_s_iunits_8cpp.html#a44d651cc217e356bec54cfe98c5d79aa">SIsymbols</a>[scale10 + <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];
<a name="l01312"></a>01312         SIprefix = <a class="code" href="_s_iunits_8cpp.html#a30b2140828093227adce3b2b8a0da747">SIprefixes</a>[scale10 + <a class="code" href="_s_iunits_8hpp.html#a6247a4754a37a5db9232f217bec6a2b8">SImaxPowerTen</a>];
<a name="l01313"></a>01313         scalePower10 = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[scale10 + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>]; <span class="comment">// 10**scaler.</span>
<a name="l01314"></a>01314         scaledValue = scaledValue / scalePower10;
<a name="l01315"></a>01315         beenScaled = <span class="keyword">true</span>;
<a name="l01316"></a>01316       }  <span class="comment">// if Setscaled to scaler.</span>
<a name="l01317"></a>01317 
<a name="l01318"></a>01318       <span class="keywordflow">if</span> (trace)
<a name="l01319"></a>01319       {
<a name="l01320"></a>01320         cerr &lt;&lt; <span class="stringliteral">&quot;Value &quot;</span> &lt;&lt; value
<a name="l01321"></a>01321           &lt;&lt; (beenScaled ? <span class="stringliteral">&quot; has been &quot;</span> : <span class="stringliteral">&quot; has not been &quot;</span>)
<a name="l01322"></a>01322           &lt;&lt; (isSetScale ? <span class="stringliteral">&quot;set &quot;</span> : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01323"></a>01323           &lt;&lt; (isAutoScale ? <span class="stringliteral">&quot;auto &quot;</span> : <span class="stringliteral">&quot;&quot;</span>)
<a name="l01324"></a>01324           &lt;&lt; (isScaled ? <span class="stringliteral">&quot;scaled &quot;</span> : <span class="stringliteral">&quot; &quot;</span>)
<a name="l01325"></a>01325           &lt;&lt; <span class="stringliteral">&quot;, scaledValue &quot;</span> &lt;&lt; scaledValue
<a name="l01326"></a>01326           &lt;&lt;  <span class="stringliteral">&quot;, scale 10**&quot;</span> &lt;&lt; scale10
<a name="l01327"></a>01327           &lt;&lt; <span class="stringliteral">&quot;, SI symbol &quot;</span> &lt;&lt; SIsymbol
<a name="l01328"></a>01328           &lt;&lt; <span class="stringliteral">&quot;, prefix &quot;</span> &lt;&lt; SIprefix
<a name="l01329"></a>01329           &lt;&lt; <span class="stringliteral">&quot;, index &quot;</span> &lt;&lt; SIindex
<a name="l01330"></a>01330           &lt;&lt; endl;
<a name="l01331"></a>01331       }  <span class="comment">// trace</span>
<a name="l01332"></a>01332     } <span class="comment">// isScaled</span>
<a name="l01333"></a>01333     <span class="keywordflow">else</span>
<a name="l01334"></a>01334     {  <span class="comment">// NOT scaled.</span>
<a name="l01335"></a>01335       <span class="keywordflow">if</span> (trace)
<a name="l01336"></a>01336       {
<a name="l01337"></a>01337         cerr &lt;&lt; <span class="stringliteral">&quot;Value &quot;</span> &lt;&lt; value &lt;&lt; <span class="stringliteral">&quot; was not scaled.&quot;</span> &lt;&lt; endl;
<a name="l01338"></a>01338       }
<a name="l01339"></a>01339     }  <span class="comment">// !isScaled</span>
<a name="l01340"></a>01340 
<a name="l01341"></a>01341     <span class="comment">//  ScaledValue is in range OK, exponent == 0</span>
<a name="l01342"></a>01342     <span class="comment">//  so find power of ten of ms digit, 9 = 10**0, 90 10**2</span>
<a name="l01343"></a>01343     <span class="keywordtype">int</span> exponent = 0; <span class="comment">// To hold calculated 10** exponent.</span>
<a name="l01344"></a>01344     <span class="keywordtype">int</span> sdExponent = 0; <span class="comment">// If value is d.d, then exponent = 0.</span>
<a name="l01345"></a>01345 
<a name="l01346"></a>01346     <span class="keywordflow">if</span> (!isZeroValue)
<a name="l01347"></a>01347     {  <span class="comment">// Get scaled value into significand (unitsValue) &amp; exponent (powerOfTen).</span>
<a name="l01348"></a>01348       <span class="keywordflow">while</span> (scaledValue &gt;= powerOfTen)
<a name="l01349"></a>01349       {  <span class="comment">// Possibly &gt; better then &gt;=, or use epsilon?</span>
<a name="l01350"></a>01350         exponent++;
<a name="l01351"></a>01351         powerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[exponent];  <span class="comment">// 0.01, 0.01, 1, 10, 100 ...</span>
<a name="l01352"></a>01352       }
<a name="l01353"></a>01353       powerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[exponent - 1];
<a name="l01354"></a>01354       unitsValue =  scaledValue / powerOfTen;  <span class="comment">// Shifted to d.ddd...</span>
<a name="l01355"></a>01355       exponent -= <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a> + 1;  <span class="comment">// If d.d exponent = 0 (10**0 = unity)</span>
<a name="l01356"></a>01356       place = exponent + 1;
<a name="l01357"></a>01357       <span class="comment">// If dd.d place = 2, d.d place = 1, 0.d place = 0, 0.0d place -1.</span>
<a name="l01358"></a>01358       cerr &lt;&lt; <span class="stringliteral">&quot;unitsValue &quot;</span> &lt;&lt; unitsValue
<a name="l01359"></a>01359         &lt;&lt; <span class="stringliteral">&quot;, PowerOfTen &quot;</span> &lt;&lt; powerOfTen
<a name="l01360"></a>01360         &lt;&lt; <span class="stringliteral">&quot;, exponent &quot;</span> &lt;&lt; exponent
<a name="l01361"></a>01361         &lt;&lt; <span class="stringliteral">&quot;, place &quot;</span> &lt;&lt; place
<a name="l01362"></a>01362         &lt;&lt; endl;
<a name="l01363"></a>01363 
<a name="l01364"></a>01364       <span class="keywordflow">if</span> (uncKnown &amp;&amp; !isExactValue)
<a name="l01365"></a>01365       { <span class="comment">// uncertainty IS known and is NOT exact.</span>
<a name="l01366"></a>01366         <span class="keywordflow">if</span> (beenScaled)
<a name="l01367"></a>01367         { <span class="comment">// So scale standard deviation exactly as value, for example both as mm.</span>
<a name="l01368"></a>01368           scaledStdDeviation = float(stdDeviation / scalePower10);
<a name="l01369"></a>01369         }
<a name="l01370"></a>01370         <span class="keywordflow">else</span>
<a name="l01371"></a>01371         {  <span class="comment">// Not scaled.</span>
<a name="l01372"></a>01372           scaledStdDeviation = stdDeviation;
<a name="l01373"></a>01373         }
<a name="l01374"></a>01374         <span class="comment">// Shift *10 scaledStdDeviation as required to make value d.dddd.</span>
<a name="l01375"></a>01375         <span class="comment">// TODO Might assume sd d.dd is not much &gt; unitsValue to avoid much / ?</span>
<a name="l01376"></a>01376         sdExponent = 0;
<a name="l01377"></a>01377         SDpowerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[0];  <span class="comment">// 10**-38</span>
<a name="l01378"></a>01378         <span class="keywordflow">while</span> (scaledStdDeviation &gt;= SDpowerOfTen)
<a name="l01379"></a>01379         {
<a name="l01380"></a>01380           sdExponent++;
<a name="l01381"></a>01381           SDpowerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[sdExponent];
<a name="l01382"></a>01382         }
<a name="l01383"></a>01383         SDpowerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[sdExponent - 1];
<a name="l01384"></a>01384         sdExponent -= <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a> + 1;  <span class="comment">// if d.d exponent = 0 (10**0 = unity)</span>
<a name="l01385"></a>01385 
<a name="l01386"></a>01386         unitSD = float(scaledStdDeviation / SDpowerOfTen); <span class="comment">// d.dd 10**sdExponent</span>
<a name="l01387"></a>01387 
<a name="l01388"></a>01388         <span class="keywordflow">if</span> (!_finite(<span class="keywordtype">double</span>(unitSD)))
<a name="l01389"></a>01389           <span class="comment">// if ((unitSD == NaNf) || (unitSD == SNaNf) || (unitSD == INFINITYf))</span>
<a name="l01390"></a>01390         {  <span class="comment">// || (unitSD == 0.0f)   ?</span>
<a name="l01391"></a>01391           uncKnown = <span class="keyword">false</span>;
<a name="l01392"></a>01392           <span class="keywordflow">if</span> (trace)
<a name="l01393"></a>01393           {
<a name="l01394"></a>01394             cerr &lt;&lt; <span class="stringliteral">&quot;unitSD NOT finite!&quot;</span>;
<a name="l01395"></a>01395           }
<a name="l01396"></a>01396         }
<a name="l01397"></a>01397         <span class="keywordflow">else</span>
<a name="l01398"></a>01398         {
<a name="l01399"></a>01399           unitsScaledStdDeviation = scaledStdDeviation / powerOfTen;
<a name="l01400"></a>01400           <span class="comment">// To make SD significand same exponent as unitsValue.</span>
<a name="l01401"></a>01401           <span class="comment">// unitsScaledStdDeviation += std::numeric_limits&lt;float&gt;::epsilon();</span>
<a name="l01402"></a>01402           <span class="comment">// To avoid erratic &gt;= comparisons below with 1.0f, 0.1f  ...</span>
<a name="l01403"></a>01403           <span class="comment">// 1.19209e-007 is smallest number differing from 1.0 so</span>
<a name="l01404"></a>01404           <span class="comment">// this isn&#39;t quite right!  TODO !!!??????? or scrap???</span>
<a name="l01405"></a>01405           <span class="keywordflow">if</span> (trace)
<a name="l01406"></a>01406           {
<a name="l01407"></a>01407             cerr &lt;&lt; std::setprecision(6) &lt;&lt; <span class="stringliteral">&quot;Scaled SD &quot;</span> &lt;&lt;  scaledStdDeviation
<a name="l01408"></a>01408               &lt;&lt; <span class="stringliteral">&quot;, unitsScaledSD &quot;</span> &lt;&lt; unitsScaledStdDeviation;
<a name="l01409"></a>01409           }
<a name="l01410"></a>01410         } <span class="comment">//</span>
<a name="l01411"></a>01411       }
<a name="l01412"></a>01412       <span class="comment">// Calculate value sigfigs &amp; Std Deviation sigfigs.</span>
<a name="l01413"></a>01413       <span class="keywordflow">if</span> (isIntegerValue)
<a name="l01414"></a>01414       {
<a name="l01415"></a>01415         sdSigFigs = 0;  <span class="comment">// No uncertainty!</span>
<a name="l01416"></a>01416         sigFigs = exponent + 1; <span class="comment">// 1 to 9: 1 sigfigs, 10 to 19: 2 sigfigs ...</span>
<a name="l01417"></a>01417         powerOfTen = 1.0; <span class="comment">// Unity - No scaling.</span>
<a name="l01418"></a>01418       } <span class="comment">// isIntegerValue.</span>
<a name="l01419"></a>01419       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isExactValue)
<a name="l01420"></a>01420       {
<a name="l01421"></a>01421         sigFigs = doubleDigits10;
<a name="l01422"></a>01422         <span class="comment">// = std::numeric_limits&lt;double&gt;::digits10;  // == 15</span>
<a name="l01423"></a>01423         sdSigFigs = 0; powerOfTen = 1; exponent = 0;
<a name="l01424"></a>01424       } <span class="comment">// isExactValue.</span>
<a name="l01425"></a>01425       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!uncKnown)
<a name="l01426"></a>01426       { <span class="comment">// unitsScaledStdDeviation is not meaningful.</span>
<a name="l01427"></a>01427         sdSigFigs = <a class="code" href="_s_iunits_8hpp.html#a81bf85f628cebd9a5de9f91acade1c0b">notOK</a>;
<a name="l01428"></a>01428         sigFigs = os.precision();
<a name="l01429"></a>01429         <span class="comment">// Use current iostream precision setting, default 6.</span>
<a name="l01430"></a>01430       } <span class="comment">// uncertainty unknown.</span>
<a name="l01431"></a>01431       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isSigFigsSet)
<a name="l01432"></a>01432       { <span class="comment">// Use the set number of significant digits.</span>
<a name="l01433"></a>01433         sigFigs = sigFigsSet;  <span class="comment">// for value,</span>
<a name="l01434"></a>01434         <span class="keywordflow">if</span> (isUncSigFigsSet)
<a name="l01435"></a>01435         {
<a name="l01436"></a>01436           sdSigFigs = uncSigFigsSet;   <span class="comment">// &amp; uncertainty.</span>
<a name="l01437"></a>01437         }
<a name="l01438"></a>01438       }  <span class="comment">// if use set sigfigs.</span>
<a name="l01439"></a>01439       <span class="keywordflow">else</span>
<a name="l01440"></a>01440       { <span class="comment">// uncertainty IS known so calculate sigfigs from standard deviation.</span>
<a name="l01441"></a>01441         <span class="keywordflow">if</span> (unitsValue != 0.0)
<a name="l01442"></a>01442         {  <span class="comment">// Safe to calculate without divide by (near) zero.</span>
<a name="l01443"></a>01443           <span class="keywordtype">double</span> relSD = unitsScaledStdDeviation / unitsValue;
<a name="l01444"></a>01444           relSD -= std::numeric_limits&lt;float&gt;::epsilon();
<a name="l01445"></a>01445           <span class="comment">// Avoid effects of UReal.m_uncertainty being float.</span>
<a name="l01446"></a>01446           <span class="comment">// leading to uneven comparisons &amp; hence sigfigs.</span>
<a name="l01447"></a>01447           <span class="comment">// Choice of 0.5 ... means that input of 1.0 (implicit +/- 0.05)</span>
<a name="l01448"></a>01448           <span class="comment">// shows as 1.00 +/- 0.05.</span>
<a name="l01449"></a>01449           <span class="keywordflow">if</span> (     relSD &lt; 0.000000000005) sigFigs = 13;
<a name="l01450"></a>01450           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.00000000005) sigFigs = 12;
<a name="l01451"></a>01451           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.0000000005) sigFigs = 11;
<a name="l01452"></a>01452           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.000000005) sigFigs = 10;
<a name="l01453"></a>01453           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.00000005) sigFigs = 9;
<a name="l01454"></a>01454           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.0000005) sigFigs = 8;
<a name="l01455"></a>01455           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.000005) sigFigs = 7;
<a name="l01456"></a>01456           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.00005) sigFigs = 6;
<a name="l01457"></a>01457           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.0005) sigFigs = 5;
<a name="l01458"></a>01458           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.005) sigFigs = 4;
<a name="l01459"></a>01459           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.05) sigFigs = 3;
<a name="l01460"></a>01460           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (relSD &lt; 0.5) sigFigs = 2;
<a name="l01461"></a>01461           <span class="keywordflow">else</span> sigFigs = 1;
<a name="l01462"></a>01462           cerr &lt;&lt; <span class="stringliteral">&quot;, relSD &quot;</span> &lt;&lt; setprecision(std::numeric_limits&lt;float&gt;::digits10 + 1)
<a name="l01463"></a>01463             <span class="comment">// Float precision plus a guard digit.</span>
<a name="l01464"></a>01464             &lt;&lt; relSD &lt;&lt; setprecision(6) &lt;&lt; <span class="stringliteral">&quot;, sigFigs &quot;</span> &lt;&lt; sigFigs &lt;&lt; endl;
<a name="l01465"></a>01465         }
<a name="l01466"></a>01466         <span class="comment">// Not now doing this, but logic is used to increase SDsigfigs below.</span>
<a name="l01467"></a>01467         <span class="comment">// if (unitsValue &lt; DIGITS_STEP) sigFigs++;</span>
<a name="l01468"></a>01468         <span class="comment">// For example, show 0.19 but 0.2 if DIGITS_STEP = 2.0.</span>
<a name="l01469"></a>01469         <span class="comment">// Logic of DIGITS_STEP rather arbitrary change point is:</span>
<a name="l01470"></a>01470         <span class="comment">// Rounding 1.5 up to 2.0 by 0.5 is +25%, a rather big step,</span>
<a name="l01471"></a>01471         <span class="comment">// so use an extra sig fig and round by 0.05.</span>
<a name="l01472"></a>01472         <span class="comment">// Rounding larger values by 0.5 :</span>
<a name="l01473"></a>01473         <span class="comment">// 2.5 to 3.0 is 17%, 4.5 to 5 is 10%, 9.5 to 10.0 is 5%.</span>
<a name="l01474"></a>01474         <span class="comment">// One could equally argue for change at 3 or 4.</span>
<a name="l01475"></a>01475         <span class="comment">// Rounding inexact to suit sigFigs.</span>
<a name="l01476"></a>01476         <span class="comment">// roundIndex is Index of rounds[0]=5 (not used), [1]=0.5, [2]=0.05 ...</span>
<a name="l01477"></a>01477         <span class="comment">// So for example, 2.6 to 1 sigfig is rounded by rounds[1] = 0.5 to 3.</span>
<a name="l01478"></a>01478         <span class="comment">// &amp; 1.5 to 2 sigFigs and is rounded at 0.05...</span>
<a name="l01479"></a>01479         <span class="keywordflow">else</span>
<a name="l01480"></a>01480         {  <span class="comment">// unitsValue too near zero.</span>
<a name="l01481"></a>01481           <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 1.0f) sigFigs = 0;
<a name="l01482"></a>01482           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.1) sigFigs = 1;
<a name="l01483"></a>01483           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.01) sigFigs = 2;
<a name="l01484"></a>01484           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.001) sigFigs = 3;
<a name="l01485"></a>01485           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.0001) sigFigs = 4;
<a name="l01486"></a>01486           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.00001) sigFigs = 5;
<a name="l01487"></a>01487           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.000001) sigFigs = 6;
<a name="l01488"></a>01488           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.0000001) sigFigs = 7;
<a name="l01489"></a>01489           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.00000001) sigFigs = 8;
<a name="l01490"></a>01490           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.000000001) sigFigs = 9;
<a name="l01491"></a>01491           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.0000000001) sigFigs = 10;
<a name="l01492"></a>01492           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (unitsScaledStdDeviation &gt;= 0.00000000001) sigFigs = 11;
<a name="l01493"></a>01493           <span class="keywordflow">else</span> sigFigs = 12;
<a name="l01494"></a>01494         }  <span class="comment">// unitsValue near 0</span>
<a name="l01495"></a>01495         sdSigFigs = 1; <span class="comment">// Perhaps increased below if uncertainty more certain.</span>
<a name="l01496"></a>01496         neededWidth += sigFigs;
<a name="l01497"></a>01497         <span class="keywordflow">if</span> (degFree &gt;= 10)
<a name="l01498"></a>01498         {       <span class="comment">// Standard deviation &amp; value better known, so one more sig digit for both.</span>
<a name="l01499"></a>01499           sigFigs++; sdSigFigs++;
<a name="l01500"></a>01500         }
<a name="l01501"></a>01501         <span class="keywordflow">else</span>    <span class="comment">// User may have requested extra digits for</span>
<a name="l01502"></a>01502           <span class="comment">// information loss-free input to other systems.</span>
<a name="l01503"></a>01503           <span class="comment">// But don&#39;t increase sigFigs and sdSigfigs more than once!</span>
<a name="l01504"></a>01504           <span class="keywordflow">if</span> (isNoisyDigit)
<a name="l01505"></a>01505           {
<a name="l01506"></a>01506             sigFigs++; sdSigFigs++; <span class="comment">// Add an extra decimal digit to both.</span>
<a name="l01507"></a>01507           }
<a name="l01508"></a>01508           <span class="keywordflow">else</span>
<a name="l01509"></a>01509           {     <span class="comment">// Provided sdSigfigs not already increased:</span>
<a name="l01510"></a>01510             <span class="keywordflow">if</span> (unitSD &lt; DIGITS_STEP) sdSigFigs++;
<a name="l01511"></a>01511             <span class="comment">// For example, show +/- 0.19 but +/- 0.2</span>
<a name="l01512"></a>01512             <span class="comment">// Choice of 2.0 as change to extra digit is arbitrary,</span>
<a name="l01513"></a>01513             <span class="comment">// see above for step sizes.</span>
<a name="l01514"></a>01514             <span class="comment">// So INPUT: 1.0 +/- 0.001 m  is displayed as</span>
<a name="l01515"></a>01515             <span class="comment">// SI unit of length 1.000 +/- 0.0010 meter or m (rather than +/- 0.001)</span>
<a name="l01516"></a>01516           } <span class="comment">// isNoisyDigit</span>
<a name="l01517"></a>01517           <span class="comment">// From table H page 457 in Oliver &amp; Goldsmith, confidence interval</span>
<a name="l01518"></a>01518           <span class="comment">// of standard deviation is about +/- 20% at 10 degrees of freedom,</span>
<a name="l01519"></a>01519           <span class="comment">// and only &lt; +/- 10% above 100 observations (needing 2 SD sigfigs).</span>
<a name="l01520"></a>01520       } <span class="comment">// uncertainty</span>
<a name="l01521"></a>01521       <span class="keywordflow">if</span> (uncKnown &amp;&amp; !isIntegerValue &amp;&amp; !isExactValue)
<a name="l01522"></a>01522       { <span class="comment">// SD is Roundable.</span>
<a name="l01523"></a>01523         <span class="keywordflow">switch</span> (sdSigFigs)
<a name="l01524"></a>01524         {
<a name="l01525"></a>01525         <span class="keywordflow">case</span> 1:  <span class="comment">// Round to just 1 sigfig. d.</span>
<a name="l01526"></a>01526           roundedUnitSD = float(<span class="keywordtype">int</span>(unitSD + 0.5));  <span class="keywordflow">break</span>;
<a name="l01527"></a>01527         <span class="keywordflow">case</span> 2:  <span class="comment">// Round to 2 sigFigs, d.d</span>
<a name="l01528"></a>01528           roundedUnitSD = int( (unitSD * 10.0 + 0.5) ) * 0.1f; <span class="keywordflow">break</span>; <span class="comment">// /10.0</span>
<a name="l01529"></a>01529         <span class="keywordflow">case</span> 3:   <span class="comment">// Round to 3 sigFigs, d.dd</span>
<a name="l01530"></a>01530           roundedUnitSD = int( (unitSD * 100.0 + 0.5) ) * 0.01f; <span class="keywordflow">break</span>;<span class="comment">// /100.0</span>
<a name="l01531"></a>01531         <span class="keywordflow">case</span> 4:   <span class="comment">// Round to 4 sigFigs, d.ddd</span>
<a name="l01532"></a>01532           roundedUnitSD = int( (unitSD * 1000.0 + 0.5) ) * 0.001f; <span class="keywordflow">break</span>;<span class="comment">// /1000.0</span>
<a name="l01533"></a>01533           <span class="comment">// Standard deviation can&#39;t be known better than this, unless exact.</span>
<a name="l01534"></a>01534         <span class="keywordflow">default</span>:
<a name="l01535"></a>01535           cerr &lt;&lt; <span class="stringliteral">&quot;\nUnexpected sdSigFigs &quot;</span> &lt;&lt; sdSigFigs
<a name="l01536"></a>01536             &lt;&lt; <span class="stringliteral">&quot;, unitSD &quot;</span> &lt;&lt; roundedUnitSD &lt;&lt; <span class="charliteral">&#39;!&#39;</span>
<a name="l01537"></a>01537             &lt;&lt; endl;
<a name="l01538"></a>01538           roundedUnitSD = unitSD;  <span class="comment">// Don&#39;t round at all!??</span>
<a name="l01539"></a>01539         } <span class="comment">// switch(sdSigFigs)</span>
<a name="l01540"></a>01540       }  <span class="comment">// uncKnown (finite unitSD)</span>
<a name="l01541"></a>01541       <span class="keywordflow">else</span>
<a name="l01542"></a>01542       { <span class="comment">// unitSd NOT finite, so DON&#39;T ROUND to a finite := 0.0!</span>
<a name="l01543"></a>01543         roundedUnitSD = unitSD;  <span class="comment">// NOT finite either!</span>
<a name="l01544"></a>01544       } <span class="comment">// Sd rounding.</span>
<a name="l01545"></a>01545       <span class="keywordtype">double</span> round = 0.0;
<a name="l01546"></a>01546       std::streamsize roundIndex = 0;  <span class="comment">// Default if exact or integer.</span>
<a name="l01547"></a>01547       roundedUnitsValue = unitsValue;
<a name="l01548"></a>01548       <span class="keywordflow">if</span> (!isExactValue &amp;&amp; !isIntegerValue)
<a name="l01549"></a>01549       {
<a name="l01550"></a>01550         roundIndex =
<a name="l01551"></a>01551           (sigFigs &lt; doubleDigits10) ? roundIndex = sigFigs : doubleDigits10;
<a name="l01552"></a>01552         round = <a class="code" href="uncmanapp_8cpp.html#a40e45aa12bcc0612336772e53dff1294">rounds</a>[roundIndex];
<a name="l01553"></a>01553         roundedUnitsValue = unitsValue + round; <span class="comment">// Trouble here if &gt;= 9.5 so</span>
<a name="l01554"></a>01554         <span class="keywordflow">if</span> (roundedUnitsValue &gt;= 10.0)
<a name="l01555"></a>01555         {
<a name="l01556"></a>01556           roundedUnitsValue *= 0.1; <span class="comment">// Divide by 10 (but FP multiply is faster).</span>
<a name="l01557"></a>01557           exponent++;
<a name="l01558"></a>01558         }
<a name="l01559"></a>01559         roundedValue = roundedUnitsValue * <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[exponent + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>];
<a name="l01560"></a>01560 
<a name="l01561"></a>01561         <span class="keywordflow">if</span> (trace)
<a name="l01562"></a>01562         {
<a name="l01563"></a>01563           cerr &lt;&lt; <span class="stringliteral">&quot;sigFigs &quot;</span> &lt;&lt; sigFigs
<a name="l01564"></a>01564             &lt;&lt; <span class="stringliteral">&quot;, roundIndex &quot;</span> &lt;&lt; roundIndex &lt;&lt; <span class="stringliteral">&quot;, round &quot;</span> &lt;&lt; <a class="code" href="uncmanapp_8cpp.html#a40e45aa12bcc0612336772e53dff1294">rounds</a>[roundIndex];
<a name="l01565"></a>01565           cerr.precision(doubleDigits10);  <span class="comment">// Full precision.</span>
<a name="l01566"></a>01566           <span class="keywordtype">int</span> savedFlags = cerr.setf(ios::scientific, ios::fixed);
<a name="l01567"></a>01567           <span class="comment">// Set scientific &amp; clear fixed.</span>
<a name="l01568"></a>01568           cerr &lt;&lt; <span class="stringliteral">&quot;, Rounded value &quot;</span> &lt;&lt; roundedValue &lt;&lt; endl;
<a name="l01569"></a>01569           cerr.setf(savedFlags);  <span class="comment">// restore cerr.flags (not the os.savedFlags on entry!)</span>
<a name="l01570"></a>01570         }  <span class="comment">// trace</span>
<a name="l01571"></a>01571       }  <span class="comment">// rounded.</span>
<a name="l01572"></a>01572     }  <span class="comment">// !zero</span>
<a name="l01573"></a>01573     <span class="keywordflow">else</span>
<a name="l01574"></a>01574     { <span class="comment">// value IS zero.</span>
<a name="l01575"></a>01575       <span class="keywordflow">if</span> (isIntegerValue)
<a name="l01576"></a>01576       {
<a name="l01577"></a>01577         sigFigs = 1; <span class="comment">// Integer zero.</span>
<a name="l01578"></a>01578       }
<a name="l01579"></a>01579       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uncKnown &amp;&amp; !isExactValue)
<a name="l01580"></a>01580       { <span class="comment">// unc IS known so can calculate roundedUnitSD.</span>
<a name="l01581"></a>01581         <span class="comment">// Shift *10 stdDeviation as required to make value d.dddd.</span>
<a name="l01582"></a>01582         <span class="comment">// Assume zero NOT scaled, even if set to do so?</span>
<a name="l01583"></a>01583         <span class="comment">// TODO Might assume sd d.dd is not much &gt; unitsValue to avoid much / ?</span>
<a name="l01584"></a>01584         sdExponent = 0;
<a name="l01585"></a>01585         SDpowerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[0];  <span class="comment">// 10**-38</span>
<a name="l01586"></a>01586         <span class="keywordflow">while</span> (stdDeviation &gt;= SDpowerOfTen)
<a name="l01587"></a>01587         {
<a name="l01588"></a>01588           sdExponent++;
<a name="l01589"></a>01589           SDpowerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[sdExponent];
<a name="l01590"></a>01590         }
<a name="l01591"></a>01591         SDpowerOfTen = <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[sdExponent - 1];
<a name="l01592"></a>01592         sdExponent -= <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a> + 1;  <span class="comment">// if d.d exponent = 0 (10**0 = unity)</span>
<a name="l01593"></a>01593         unitSD = float(stdDeviation / SDpowerOfTen); <span class="comment">// d.dd 10**sdExponent</span>
<a name="l01594"></a>01594 
<a name="l01595"></a>01595         sigFigs = 1; place = 1; exponent = 0;
<a name="l01596"></a>01596         roundedUnitsValue = 0.0; roundedValue = 0.0; unitsValue = 0.0;
<a name="l01597"></a>01597         <span class="keywordflow">if</span> (degFree &gt;= 10)
<a name="l01598"></a>01598         {       <span class="comment">// Standard deviation better known, so one more sig digit.</span>
<a name="l01599"></a>01599         sdSigFigs++;
<a name="l01600"></a>01600         }
<a name="l01601"></a>01601 
<a name="l01602"></a>01602         <span class="keywordflow">if</span> (!isIntegerValue &amp;&amp; !isExactValue)
<a name="l01603"></a>01603         { <span class="comment">// SD is Roundable.</span>
<a name="l01604"></a>01604           <span class="keywordflow">switch</span> (sdSigFigs)
<a name="l01605"></a>01605           {
<a name="l01606"></a>01606           <span class="keywordflow">case</span> 1:  <span class="comment">// Round to just 1 sigfig. d.</span>
<a name="l01607"></a>01607             roundedUnitSD = float(<span class="keywordtype">int</span>(unitSD + 0.5));  <span class="keywordflow">break</span>;
<a name="l01608"></a>01608           <span class="keywordflow">case</span> 2:  <span class="comment">// Round to 2 sigFigs, d.d</span>
<a name="l01609"></a>01609             roundedUnitSD = int( (unitSD * 10.0 + 0.5) ) * 0.1f; <span class="keywordflow">break</span>; <span class="comment">// /10.0</span>
<a name="l01610"></a>01610           <span class="keywordflow">case</span> 3:   <span class="comment">// Round to 3 sigFigs, d.dd</span>
<a name="l01611"></a>01611             roundedUnitSD = int( (unitSD * 100.0 + 0.5) ) * 0.01f; <span class="keywordflow">break</span>;<span class="comment">// /100.0</span>
<a name="l01612"></a>01612           <span class="keywordflow">case</span> 4:   <span class="comment">// Round to 4 sigFigs, d.ddd</span>
<a name="l01613"></a>01613             roundedUnitSD = int( (unitSD * 1000.0 + 0.5) ) * 0.001f; <span class="keywordflow">break</span>; <span class="comment">// /1000.0</span>
<a name="l01614"></a>01614             <span class="comment">// Standard deviation can&#39;t be known better than this, unless exact.</span>
<a name="l01615"></a>01615           <span class="keywordflow">default</span>:
<a name="l01616"></a>01616             cerr &lt;&lt; <span class="stringliteral">&quot;\nUnexpected sdSigFigs &quot;</span> &lt;&lt; sdSigFigs
<a name="l01617"></a>01617               &lt;&lt; <span class="stringliteral">&quot;, unitSD &quot;</span> &lt;&lt; roundedUnitSD &lt;&lt; <span class="charliteral">&#39;!&#39;</span>
<a name="l01618"></a>01618               &lt;&lt; endl;
<a name="l01619"></a>01619             roundedUnitSD = unitSD;  <span class="comment">// Don&#39;t round at all!??</span>
<a name="l01620"></a>01620           } <span class="comment">// switch(sdSigFigs)</span>
<a name="l01621"></a>01621         }
<a name="l01622"></a>01622       } <span class="comment">// unc known</span>
<a name="l01623"></a>01623     } <span class="comment">// zero or not</span>
<a name="l01624"></a>01624     cerr &lt;&lt; <span class="stringliteral">&quot;sigfigs &quot;</span> &lt;&lt; sigFigs &lt;&lt; endl;
<a name="l01625"></a>01625 
<a name="l01626"></a>01626     <span class="keywordflow">if</span> (uncKnown &amp;&amp; !isExactValue &amp;&amp; !isIntegerValue)
<a name="l01627"></a>01627     { <span class="comment">// Log scaling.</span>
<a name="l01628"></a>01628       cerr &lt;&lt; std::setprecision(sigFigs+2)
<a name="l01629"></a>01629         &lt;&lt;<span class="stringliteral">&quot;ScaleSD &quot;</span> &lt;&lt; scaledStdDeviation
<a name="l01630"></a>01630         &lt;&lt; <span class="stringliteral">&quot;, valScalSD &quot;</span> &lt;&lt; unitsScaledStdDeviation
<a name="l01631"></a>01631         &lt;&lt; <span class="stringliteral">&quot;, unitSD &quot;</span> &lt;&lt; unitSD
<a name="l01632"></a>01632         &lt;&lt; dec &lt;&lt; <span class="stringliteral">&quot;, SDexp &quot;</span> &lt;&lt; sdExponent
<a name="l01633"></a>01633         &lt;&lt; dec &lt;&lt; <span class="stringliteral">&quot;, SDpowerOfTen &quot;</span> &lt;&lt; SDpowerOfTen
<a name="l01634"></a>01634         &lt;&lt; <span class="stringliteral">&quot;, roundedUnitSD &quot;</span>  &lt;&lt; roundedUnitSD
<a name="l01635"></a>01635         <span class="comment">//&lt;&lt; &quot;, uncSigFigs &quot; &lt;&lt; uncSigFigs</span>
<a name="l01636"></a>01636         &lt;&lt; <span class="stringliteral">&quot;, SDsigFigs &quot;</span> &lt;&lt; sdSigFigs
<a name="l01637"></a>01637         &lt;&lt; endl;
<a name="l01638"></a>01638     } <span class="comment">// Not integer or exact.</span>
<a name="l01639"></a>01639     <span class="comment">// Save previous before actually output anything, so can restore on exit.</span>
<a name="l01640"></a>01640     os.iword(<a class="code" href="unc_init_8cpp.html#aa311b745e265500aedddb1faee22e427">oldSigFigsIndex</a>) = os.iword(<a class="code" href="unc_init_8cpp.html#aa63c3a092935f69ee315002c5181f8e6">sigFigsIndex</a>);  <span class="comment">// Save previous sigFigsIndex.</span>
<a name="l01641"></a>01641     os.iword(<a class="code" href="unc_init_8cpp.html#aa63c3a092935f69ee315002c5181f8e6">sigFigsIndex</a>) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span><span class="keyword">&gt;</span>(sigFigs);  <span class="comment">// Save or &#39;return&#39; sigFigs used next.</span>
<a name="l01642"></a>01642     <span class="comment">// Output value (with +/- if isPlusMinus).</span>
<a name="l01643"></a>01643 
<a name="l01644"></a>01644     <span class="comment">// Output UReal.</span>
<a name="l01645"></a>01645     <span class="keywordtype">bool</span> pointed = <span class="keyword">false</span>; <span class="comment">// Decimal point has not been output yet.</span>
<a name="l01646"></a>01646     std::streamsize digits = 0;
<a name="l01647"></a>01647     used = 0;
<a name="l01648"></a>01648 
<a name="l01649"></a>01649     <span class="keywordflow">if</span> (firmFormat &amp;&amp; rightJustify)
<a name="l01650"></a>01650     { <span class="comment">// Need to pad before to right justify.</span>
<a name="l01651"></a>01651       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; pad; i++) {os &lt;&lt; filler; used++;}
<a name="l01652"></a>01652     }
<a name="l01653"></a>01653 
<a name="l01654"></a>01654     <span class="comment">//</span>
<a name="l01655"></a>01655     <span class="keywordflow">if</span> (sigFigs &lt;= 0)
<a name="l01656"></a>01656     { <span class="comment">// Either VALUE unknown, already been dealt with above,</span>
<a name="l01657"></a>01657       <span class="comment">// or calculated or set sigfigs &lt;= 0 - internal fault?</span>
<a name="l01658"></a>01658 <span class="comment">//                      os &lt;&lt; &#39;$&#39;; used++;  // Unknown value indication. Got here with Meas</span>
<a name="l01659"></a>01659       os &lt;&lt; <span class="charliteral">&#39;?&#39;</span>; used++;  <span class="comment">// Unknown value indication.</span>
<a name="l01660"></a>01660       <span class="comment">//  Unclear what to do about +|- display if output ?</span>
<a name="l01661"></a>01661     }
<a name="l01662"></a>01662     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isZeroValue)
<a name="l01663"></a>01663     {  <span class="comment">// Deal with common special case because it causes trouble below.</span>
<a name="l01664"></a>01664       os &lt;&lt; <span class="charliteral">&#39;0&#39;</span> ; used++;  <span class="comment">// At least one zero.</span>
<a name="l01665"></a>01665       <span class="keywordflow">if</span> (firmFormat &amp;&amp; (sigFigs &gt; 1))
<a name="l01666"></a>01666       {
<a name="l01667"></a>01667         os &lt;&lt; <span class="charliteral">&#39;.&#39;</span>; used++; pointed = <span class="keyword">true</span>;
<a name="l01668"></a>01668         <span class="keywordflow">for</span> (std::streamsize trailingZeros = sigFigs; trailingZeros &gt; 0; trailingZeros--)
<a name="l01669"></a>01669         { os &lt;&lt; <span class="charliteral">&#39;0&#39;</span>; used++; }
<a name="l01670"></a>01670       }
<a name="l01671"></a>01671       <span class="keywordflow">else</span>
<a name="l01672"></a>01672       {  <span class="comment">// flexFormat</span>
<a name="l01673"></a>01673         <span class="comment">// Decimal point only if really wanted (Is it ever really wanted?)</span>
<a name="l01674"></a>01674         <span class="keywordflow">if</span> (showPoint) { os &lt;&lt; <span class="charliteral">&#39;.&#39;</span>; used++; pointed = <span class="keyword">true</span>; }
<a name="l01675"></a>01675         <span class="comment">// Never any trailing zeros in flex format.</span>
<a name="l01676"></a>01676       }
<a name="l01677"></a>01677     }
<a name="l01678"></a>01678     <span class="keywordflow">else</span> <span class="comment">// Value not zero.</span>
<a name="l01679"></a>01679     {  <span class="comment">// Assume never wanted a signed zero.</span>
<a name="l01680"></a>01680       <span class="keywordflow">if</span> (sign != 0)  <span class="comment">// +, - or space for firm, +, - but zero for flexFormat.</span>
<a name="l01681"></a>01681       {
<a name="l01682"></a>01682         os &lt;&lt; sign; used++;
<a name="l01683"></a>01683       }
<a name="l01684"></a>01684       <span class="keywordflow">if</span> (isIntegerValue)
<a name="l01685"></a>01685       {  <span class="comment">// For example: 1 meter.</span>
<a name="l01686"></a>01686         <span class="comment">// 1 inch Autoscaled SI 0.0254 millimeter or 0.0254 mm</span>
<a name="l01687"></a>01687         roundedValue = <span class="keywordtype">long</span> int(value); <span class="comment">// Should NOT be scaled.</span>
<a name="l01688"></a>01688         <span class="comment">// sigFigs already = exponent +1;</span>
<a name="l01689"></a>01689         <span class="comment">// exponent = 0;</span>
<a name="l01690"></a>01690         place = 0;  <span class="comment">// because none after decimal point.</span>
<a name="l01691"></a>01691         digits = exponent + 1;
<a name="l01692"></a>01692         cerr &lt;&lt; <span class="stringliteral">&quot;, Integer &quot;</span> &lt;&lt; roundedValue &lt;&lt; <span class="stringliteral">&quot;, digits &quot;</span> &lt;&lt; digits &lt;&lt;<span class="stringliteral">&quot;, place = 0&quot;</span> &lt;&lt; endl;
<a name="l01693"></a>01693       }
<a name="l01694"></a>01694       <span class="keywordflow">else</span> <span class="keywordflow">if</span> (isExactValue)
<a name="l01695"></a>01695       { <span class="comment">// For example: 1 inch = 2.54 mm but NOT integer.</span>
<a name="l01696"></a>01696         <span class="comment">// 1. inch Autoscaled SI 25. +/- 13. millimeter or 25. mm</span>
<a name="l01697"></a>01697         <span class="comment">// 1.0 inch Autoscaled SI 25.4 +/- 1.3 millimeter or 25.4 mm</span>
<a name="l01698"></a>01698         <span class="comment">// 1.00 Autoscaled SI 25.4 +/- 0.13 millimeter or 25.4 mm</span>
<a name="l01699"></a>01699         <span class="comment">// 1.000 Autoscaled SI 25.400 +/- 0.013 millimeter or 25.400 mm</span>
<a name="l01700"></a>01700 
<a name="l01701"></a>01701         place = (exponent &lt;= 0) ? 1 : exponent + 1; <span class="comment">// Does NOT depend on sigFigs.</span>
<a name="l01702"></a>01702         roundedValue = value;  <span class="comment">// TODO what about scaling?</span>
<a name="l01703"></a>01703         cerr &lt;&lt; <span class="stringliteral">&quot;, Exact &quot;</span> &lt;&lt; value &lt;&lt; endl;
<a name="l01704"></a>01704         digits = sigFigs;  <span class="comment">// doubleDigits10 = 15 or os.precision()?</span>
<a name="l01705"></a>01705         <span class="comment">// would really like to use exactly what was input?</span>
<a name="l01706"></a>01706         <span class="comment">// 0.5, 25.4 ...</span>
<a name="l01707"></a>01707         os &lt;&lt; savedValue;  <span class="comment">// Using existing precision width etc flags.</span>
<a name="l01708"></a>01708         used = os.width(); <span class="comment">// May not be accurate guide to used?</span>
<a name="l01709"></a>01709         <span class="keywordflow">goto</span> padRight;
<a name="l01710"></a>01710         <span class="comment">//  TOTO unreachable code!</span>
<a name="l01711"></a>01711         os.flags(savedFlags);  <span class="comment">// Restore flags IS useful.</span>
<a name="l01712"></a>01712         os.iword(<a class="code" href="unc_init_8cpp.html#a540ce31a9e583612c03e63e1bc11cf82">uncUsedIndex</a>) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span><span class="keyword">&gt;</span>(used);  <span class="comment">// Record width actually used.</span>
<a name="l01713"></a>01713         <span class="keywordflow">return</span>; <span class="comment">// uncertainPrint</span>
<a name="l01714"></a>01714       }
<a name="l01715"></a>01715       <span class="keywordflow">else</span> <span class="comment">// Real, neither integer nor exact.</span>
<a name="l01716"></a>01716       {  <span class="comment">// For example 1.234 mm.</span>
<a name="l01717"></a>01717         cerr &lt;&lt; <span class="stringliteral">&quot;, Real &quot;</span> &lt;&lt; roundedValue  &lt;&lt; endl;
<a name="l01718"></a>01718 
<a name="l01719"></a>01719         place = (exponent &lt;= 0) ? 1 : exponent + 1; <span class="comment">// Does NOT depend on sigFigs.</span>
<a name="l01720"></a>01720         digits = sigFigs;
<a name="l01721"></a>01721         <span class="keywordflow">if</span> (exponent &lt; 0 ) digits = sigFigs - exponent; <span class="comment">// + abs(exponent);</span>
<a name="l01722"></a>01722         <span class="keywordflow">if</span> (exponent &gt;= sigFigs) digits = exponent + 1;
<a name="l01723"></a>01723         cerr &lt;&lt; <span class="stringliteral">&quot;Not int nor exact: place &quot;</span> &lt;&lt; place &lt;&lt; <span class="stringliteral">&quot;, digits &quot;</span> &lt;&lt; digits
<a name="l01724"></a>01724           &lt;&lt; <span class="stringliteral">&quot;, exponent &quot;</span> &lt;&lt; exponent
<a name="l01725"></a>01725           &lt;&lt; <span class="stringliteral">&quot;, sigfigs &quot;</span> &lt;&lt; sigFigs &lt;&lt; endl;
<a name="l01726"></a>01726       }  <span class="comment">// !integer or exact</span>
<a name="l01727"></a>01727 
<a name="l01728"></a>01728       <span class="keywordtype">double</span> m = roundedValue;
<a name="l01729"></a>01729       <span class="keywordflow">if</span> (exponent &gt; 0)
<a name="l01730"></a>01730         m = m / <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[exponent + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>];
<a name="l01731"></a>01731       <span class="comment">// Just use significand d.dd dd.d ddd. ddd0. ddd00. ...</span>
<a name="l01732"></a>01732       <span class="keywordtype">int</span> j = 0;
<a name="l01733"></a>01733       <span class="keywordflow">while</span> (j &lt; digits)
<a name="l01734"></a>01734       {
<a name="l01735"></a>01735         j++;
<a name="l01736"></a>01736         <span class="comment">// Out sigFigs digits (including . if necessary).</span>
<a name="l01737"></a>01737         <span class="keywordtype">int</span> digit;  <span class="comment">// Rounded decimal digit just being output.</span>
<a name="l01738"></a>01738         <span class="keywordflow">if</span> ((exponent &gt; 0) &amp;&amp; (j &gt; sigFigs))
<a name="l01739"></a>01739         {
<a name="l01740"></a>01740           os &lt;&lt; <span class="charliteral">&#39;0&#39;</span>; used++;
<a name="l01741"></a>01741         } <span class="comment">// Insignificant zeros before decimal point.</span>
<a name="l01742"></a>01742         <span class="keywordflow">else</span>
<a name="l01743"></a>01743         {  <span class="comment">// Another significant digit.</span>
<a name="l01744"></a>01744           digit = int(m); <span class="comment">// No rounding here - assume already rounded.</span>
<a name="l01745"></a>01745           <span class="comment">// but C++ truncates to floor not rounds to nearest.</span>
<a name="l01746"></a>01746           m = (m - digit) * 10.; <span class="comment">// Subtract most significant digit &amp; shift up.</span>
<a name="l01747"></a>01747           std::char_traits&lt;char&gt;::int_type c = <span class="charliteral">&#39;0&#39;</span> + digit;  <span class="comment">// Most significant digit.</span>
<a name="l01748"></a>01748           os &lt;&lt; c; used++;
<a name="l01749"></a>01749         }
<a name="l01750"></a>01750         <span class="keywordflow">if</span> ((!pointed) &amp;&amp; (j == place))
<a name="l01751"></a>01751         {
<a name="l01752"></a>01752           os &lt;&lt; <span class="charliteral">&#39;.&#39;</span>; pointed = <span class="keyword">true</span>; used++;
<a name="l01753"></a>01753         }
<a name="l01754"></a>01754       } <span class="comment">// j &lt;digits</span>
<a name="l01755"></a>01755 
<a name="l01756"></a>01756       <span class="keywordflow">if</span> ((pointed == <span class="keyword">false</span>) &amp;&amp; showPoint)
<a name="l01757"></a>01757       {
<a name="l01758"></a>01758         os &lt;&lt; <span class="charliteral">&#39;.&#39;</span>; pointed = <span class="keyword">true</span>; used++;
<a name="l01759"></a>01759       }
<a name="l01760"></a>01760       os &lt;&lt; flush;  <span class="comment">// temp</span>
<a name="l01761"></a>01761     } <span class="comment">// !isZeroValue</span>
<a name="l01762"></a>01762 
<a name="l01763"></a>01763     <span class="keywordflow">if</span> (isExpFormat)
<a name="l01764"></a>01764     { <span class="comment">// Exponent needed. This assumes -99 &lt;= e &lt;=99, in practice it is.</span>
<a name="l01765"></a>01765       <span class="comment">// Layout will be spoilt if exponent &gt;99, but this is acceptable</span>
<a name="l01766"></a>01766       <span class="comment">// compromise to avoid ugly 3 digit exponents and waste of space.</span>
<a name="l01767"></a>01767       <span class="keywordtype">int</span> absExponent = abs(exponent);
<a name="l01768"></a>01768       <span class="keywordflow">if</span> (flexFormat)
<a name="l01769"></a>01769       {
<a name="l01770"></a>01770         <span class="keywordflow">if</span> (exponent != 0) <span class="comment">// 9.9 not 9.9E0 - no redundant E0 in flex format.</span>
<a name="l01771"></a>01771         {
<a name="l01772"></a>01772           os &lt;&lt; expChar;
<a name="l01773"></a>01773           <span class="keywordflow">if</span> (exponent &lt; 0)
<a name="l01774"></a>01774           {
<a name="l01775"></a>01775             os &lt;&lt; <span class="charliteral">&#39;-&#39;</span> ;  used++; <span class="comment">// Always show negative sign of exponent.</span>
<a name="l01776"></a>01776           }
<a name="l01777"></a>01777           <span class="keywordflow">else</span>
<a name="l01778"></a>01778           {
<a name="l01779"></a>01779             <span class="keywordflow">if</span> (showpos) { os &lt;&lt; <span class="charliteral">&#39;+&#39;</span>; used++; } <span class="comment">// 2e+6 if flexFormat &amp; showpos.</span>
<a name="l01780"></a>01780           }
<a name="l01781"></a>01781           <span class="comment">// No leading zero if flex format.</span>
<a name="l01782"></a>01782           os &lt;&lt; absExponent; used++;
<a name="l01783"></a>01783           <span class="keywordflow">if</span> (absExponent &gt;=10) used++;
<a name="l01784"></a>01784         } <span class="comment">// exponent !=0</span>
<a name="l01785"></a>01785       }  <span class="comment">// flexFormat</span>
<a name="l01786"></a>01786       <span class="keywordflow">else</span>
<a name="l01787"></a>01787       { <span class="comment">// firmFormat E+99, E+01, E+00, E-01, E-99   width = 4</span>
<a name="l01788"></a>01788         <span class="comment">// Overflow if exponent &gt; 99</span>
<a name="l01789"></a>01789         os &lt;&lt; expChar  <span class="comment">// e or E</span>
<a name="l01790"></a>01790           &lt;&lt; setw(2) &lt;&lt; dec &lt;&lt; showpos &lt;&lt; exponent;
<a name="l01791"></a>01791         used += 4; <span class="comment">//  Width of E-99 = 4</span>
<a name="l01792"></a>01792       }  <span class="comment">// firm</span>
<a name="l01793"></a>01793     } <span class="comment">// expFormat</span>
<a name="l01794"></a>01794 
<a name="l01795"></a>01795     <span class="keywordflow">if</span> (trace)  { cerr &lt;&lt; <span class="stringliteral">&quot;Chars used for value &quot;</span> &lt;&lt; noshowpos &lt;&lt; dec &lt;&lt; used; }
<a name="l01796"></a>01796 
<a name="l01797"></a>01797     <span class="keywordflow">if</span> (isPlusMinus) <span class="comment">// TODO firm format????</span>
<a name="l01798"></a>01798     { <span class="comment">// Also output uncertainty as +/- standard deviation.</span>
<a name="l01799"></a>01799       <span class="keywordflow">if</span> (!uncKnown || (sdSigFigs &lt;= 0))
<a name="l01800"></a>01800       <span class="comment">// Check || sigfigs &lt;= 0 to avoid display like &quot;? +|- 0.05&quot;.</span>
<a name="l01801"></a>01801       <span class="comment">// But if value is known but setsigfigs = 0 so as to not display,</span>
<a name="l01802"></a>01802       <span class="comment">// it seems reasonable to display uncertainty anyway.</span>
<a name="l01803"></a>01803       {
<a name="l01804"></a>01804         os &lt;&lt; <span class="stringliteral">&quot; +/- ?&quot;</span>;  used += 6;
<a name="l01805"></a>01805       }
<a name="l01806"></a>01806       <span class="keywordflow">else</span>
<a name="l01807"></a>01807       {  <span class="comment">// SD known, but check it is finite.</span>
<a name="l01808"></a>01808         <span class="keywordflow">if</span> (<span class="keyword">true</span>) <span class="comment">// (_finite(roundedUnitSD))</span>
<a name="l01809"></a>01809         {  <span class="comment">// Output standard deviation.</span>
<a name="l01810"></a>01810           <span class="keywordflow">if</span> (uncTypes &amp; <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a5d47c395882673b486113eb7de38a73f">UNC_NOMINUS</a>)
<a name="l01811"></a>01811           {
<a name="l01812"></a>01812             os &lt;&lt;  <span class="stringliteral">&quot; -0/+&quot;</span>; used += 5;
<a name="l01813"></a>01813           }
<a name="l01814"></a>01814           <span class="keywordflow">else</span> <span class="keywordflow">if</span> (uncTypes &amp; <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a10120ed09bb2013a9640635f2a799fbc">UNC_NOPLUS</a>)
<a name="l01815"></a>01815           {
<a name="l01816"></a>01816             os &lt;&lt;  <span class="stringliteral">&quot; +0/-&quot;</span>; used += 5;
<a name="l01817"></a>01817           }
<a name="l01818"></a>01818           <span class="keywordflow">else</span>
<a name="l01819"></a>01819           { <span class="comment">// Normal plus or minus.</span>
<a name="l01820"></a>01820             os &lt;&lt;  <span class="stringliteral">&quot; +/-&quot;</span>; used += 4; <span class="comment">// or +- symbol? used +=3;?</span>
<a name="l01821"></a>01821           }
<a name="l01822"></a>01822           place = (sdExponent &lt;= 0) ? 1 : sdExponent +1;
<a name="l01823"></a>01823           <span class="comment">// Does NOT depend on sd sigFigs.</span>
<a name="l01824"></a>01824           std::streamsize digits = sdSigFigs;
<a name="l01825"></a>01825           <span class="keywordtype">bool</span> pointed = <span class="keyword">false</span>;
<a name="l01826"></a>01826           <span class="keywordflow">if</span> (sdExponent &lt; 0 ) digits = sdSigFigs - sdExponent; <span class="comment">// + abs(exponent);</span>
<a name="l01827"></a>01827           <span class="keywordflow">if</span> (sdExponent &gt;= sdSigFigs)  digits = sdExponent + 1;
<a name="l01828"></a>01828 
<a name="l01829"></a>01829           <span class="keywordflow">if</span> (trace) cerr &lt;&lt; <span class="stringliteral">&quot;, SD place &quot;</span> &lt;&lt; place;
<a name="l01830"></a>01830           <span class="comment">// Effectively inline routine above for speed.</span>
<a name="l01831"></a>01831           <span class="keywordtype">double</span> m = roundedUnitSD * <a class="code" href="_s_iunits_8cpp.html#a6e7aaa22047109351f58361761b895fe">powersOfTen</a>[sdExponent + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>];
<a name="l01832"></a>01832           <span class="keywordflow">if</span> (sdExponent &gt; 0)
<a name="l01833"></a>01833             m /= powersOfTen[sdExponent + <a class="code" href="_s_iunits_8hpp.html#a63dbcde5edd7375d7bb975779017e9cc">maxPowerTen</a>];
<a name="l01834"></a>01834           <span class="comment">// Just use significand d.dd dd.d ddd. ddd0. ddd00. ...</span>
<a name="l01835"></a>01835           <span class="keywordtype">int</span> j = 0;
<a name="l01836"></a>01836           <span class="keywordflow">while</span> (j &lt; digits)
<a name="l01837"></a>01837           {
<a name="l01838"></a>01838             j++;
<a name="l01839"></a>01839             <span class="comment">// Out sdSigFigs digits (including . if necessary).</span>
<a name="l01840"></a>01840             <span class="keywordtype">int</span> digit;  <span class="comment">// Rounded decimal digit just being output.</span>
<a name="l01841"></a>01841             <span class="keywordflow">if</span> ((sdExponent &gt; 0) &amp;&amp; (j &gt; sdSigFigs))
<a name="l01842"></a>01842             {
<a name="l01843"></a>01843               os &lt;&lt; <span class="charliteral">&#39;0&#39;</span>; used++;
<a name="l01844"></a>01844             } <span class="comment">// Insignificant zeros before decimal point.</span>
<a name="l01845"></a>01845             <span class="keywordflow">else</span>
<a name="l01846"></a>01846             {  <span class="comment">// Another significant digit.</span>
<a name="l01847"></a>01847               digit = int(m); <span class="comment">// No rounding here - assume already rounded.</span>
<a name="l01848"></a>01848               <span class="comment">// but C++ truncates to floor not rounds to nearest.</span>
<a name="l01849"></a>01849               m = (m - digit) * 10.0; <span class="comment">// Subtract most significant digit &amp; shift up.</span>
<a name="l01850"></a>01850               <a class="code" href="uncmanapp_8cpp.html#a676c7b527f8549b9a1159b5c17291a0a">int_char</a> c = <span class="charliteral">&#39;0&#39;</span> + digit;  <span class="comment">// Most significant digit.</span>
<a name="l01851"></a>01851               os &lt;&lt; c; used++;
<a name="l01852"></a>01852             }
<a name="l01853"></a>01853             <span class="keywordflow">if</span> ((!pointed) &amp;&amp; (j == place))
<a name="l01854"></a>01854             {
<a name="l01855"></a>01855               os &lt;&lt; <span class="charliteral">&#39;.&#39;</span>; used++; pointed = <span class="keyword">true</span>;
<a name="l01856"></a>01856             }
<a name="l01857"></a>01857           } <span class="comment">// j &lt; digits</span>
<a name="l01858"></a>01858           <span class="keywordflow">if</span> ((pointed == <span class="keyword">false</span>) &amp;&amp; showPoint)
<a name="l01859"></a>01859           {
<a name="l01860"></a>01860             os &lt;&lt; <span class="charliteral">&#39;.&#39;</span>; used++; pointed = <span class="keyword">true</span>;
<a name="l01861"></a>01861           }
<a name="l01862"></a>01862         }  <span class="comment">// SD finite.</span>
<a name="l01863"></a>01863         <span class="keywordflow">else</span>
<a name="l01864"></a>01864         {  <span class="comment">// SD not finite.</span>
<a name="l01865"></a>01865           os &lt;&lt; <span class="stringliteral">&quot; +/-?&quot;</span>; used += 5;
<a name="l01866"></a>01866         }
<a name="l01867"></a>01867       }
<a name="l01868"></a>01868     }  <span class="comment">// isPlusminus.</span>
<a name="l01869"></a>01869 
<a name="l01870"></a>01870     <span class="keywordflow">if</span> (isLimits &amp;&amp; !isExactValue) <span class="comment">//  &amp;&amp; !isExactValue Added 24 Jan 2002 to cure 0 &lt; ?</span>
<a name="l01871"></a>01871     { <span class="comment">// Show low limit = value - uncertainty.</span>
<a name="l01872"></a>01872       <span class="keywordtype">unsigned</span> <span class="keywordtype">long</span> <span class="keywordtype">int</span> oldFlags = os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>); <span class="comment">// Save to allow restore.</span>
<a name="l01873"></a>01873       <span class="comment">// MUST Switch off display of limits - or will recurse for ever!</span>
<a name="l01874"></a>01874       <span class="comment">// And switch off degrees of freedom, plusminus, etc because misleading.</span>
<a name="l01875"></a>01875       os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp;= ~(<a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda8df10473f985e1e141fe13ce1da4b2e7">plusMinus</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda12e427a814d05cf13103a609ef21c2f0">limits</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaac97fd648aedffb05975e58a9531eee9">degfree</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdab5a6082eb1bac1b504465d874da18664">noisyDigit</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda6baa1727b244f9c27c5fa1ffcac571d0">addSISymbol</a> | <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdaff39f67935d3386b19b8a89be2eb711a">replicates</a>);
<a name="l01876"></a>01876       os &lt;&lt; <span class="stringliteral">&quot; &lt; &quot;</span>; <span class="comment">// So display format is 1.2 &lt; 1.3 &lt; 1.4 or 1.2 &lt; 1.3 +/-0.05 &lt; 1.4</span>
<a name="l01877"></a>01877       <a class="code" href="uncmanapp_8cpp.html#ad557d4bbf09fc9c5be7fe73797f2858e">uncertainPrint</a>(value + stdDeviation, stdDeviation, degFree, UNC_KNOWN | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387aba4b122167825b83c4de2ac5190d5c7f">UNC_EXPLICIT</a> | <a class="code" href="unc___types_8cpp.html#a4bfdeee65812d9cc73f9ee7c4c1ca387a6d646b27d92c48dec8b1e8723131f600">DEG_FREE_EXACT</a> | DEG_FREE_KNOWN, os);
<a name="l01878"></a>01878       os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) = oldFlags; <span class="comment">// Restore for display of limits other items after central value.</span>
<a name="l01879"></a>01879     }
<a name="l01880"></a>01880 
<a name="l01881"></a>01881     <span class="keywordflow">if</span> (isDegfree || isReplicates) <span class="comment">// replicates display only if degFree &gt;1</span>
<a name="l01882"></a>01882     { <span class="comment">// Show degrees of freedom as &quot; (99)&quot;, or &quot; (1)&quot;</span>
<a name="l01883"></a>01883       os &lt;&lt; <span class="stringliteral">&quot; (&quot;</span> &lt;&lt; dec;
<a name="l01884"></a>01884       <span class="keywordflow">if</span> (firmFormat)
<a name="l01885"></a>01885       {
<a name="l01886"></a>01886         os &lt;&lt; setw(2) &lt;&lt; degFree + 1; used +=2;
<a name="l01887"></a>01887       }
<a name="l01888"></a>01888       <span class="keywordflow">else</span>
<a name="l01889"></a>01889       {
<a name="l01890"></a>01890         os &lt;&lt; degFree + 1; used += (degFree &gt;= 9) ? 2 : 1;
<a name="l01891"></a>01891       }
<a name="l01892"></a>01892       os &lt;&lt; <span class="stringliteral">&quot;)&quot;</span> ; used += 3; <span class="comment">// space and ()</span>
<a name="l01893"></a>01893     } <span class="comment">// isDegfree</span>
<a name="l01894"></a>01894 
<a name="l01895"></a>01895 padRight:
<a name="l01896"></a>01896     <span class="keywordflow">if</span> (firmFormat &amp;&amp; leftJustify)
<a name="l01897"></a>01897     { <span class="comment">// Pad filler on the right to left justify in firm field.</span>
<a name="l01898"></a>01898       <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 1; i &lt;= pad; ++i) {os &lt;&lt; filler; used++;}
<a name="l01899"></a>01899     } <span class="comment">// Should pad be reduced by used for +/- and/or degrees of freedom?</span>
<a name="l01900"></a>01900 
<a name="l01901"></a>01901     <span class="keywordflow">if</span> (flexFormat)
<a name="l01902"></a>01902     { <span class="comment">// May be inconvenient if no unit name like meter follows,</span>
<a name="l01903"></a>01903       <span class="comment">// for example, if a table using firm (not flex) layout.</span>
<a name="l01904"></a>01904       <span class="keywordtype">bool</span> <a class="code" href="unc___types_8cpp.html#ae141c48cc091f23ca21fdb61072ea38e">addSIprefix</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fdac5a6d576327602677949982970a66740">addSIPrefix</a>);
<a name="l01905"></a>01905       <span class="keywordflow">if</span> (addSIprefix)
<a name="l01906"></a>01906       {  <span class="comment">// Prefix (milli) has priority over SIsymbol (m) if both specified.</span>
<a name="l01907"></a>01907         os &lt;&lt; <span class="charliteral">&#39; &#39;</span> &lt;&lt; SIprefix; used += 1 + strlen(SIprefix);
<a name="l01908"></a>01908       }
<a name="l01909"></a>01909       <span class="keywordflow">else</span>
<a name="l01910"></a>01910       {  <span class="comment">// Perhaps add SI symbol (but ensure NOT both!)</span>
<a name="l01911"></a>01911         <span class="keywordtype">bool</span> <a class="code" href="unc___types_8cpp.html#afeb37375291e658c420b02248f51d01a">addSIsymbol</a> = <span class="keyword">static_cast&lt;</span><span class="keywordtype">bool</span><span class="keyword">&gt;</span>(os.iword(<a class="code" href="_test_quan1_8cpp.html#ae232442bb418cece56776b8b0374886a">uncFlagsIndex</a>) &amp; <a class="code" href="unc___types_8cpp.html#a68335ca359c326cfad799912892984fda6baa1727b244f9c27c5fa1ffcac571d0">addSISymbol</a>);
<a name="l01912"></a>01912         <span class="keywordflow">if</span> (addSIsymbol)
<a name="l01913"></a>01913         {
<a name="l01914"></a>01914           os &lt;&lt; <span class="charliteral">&#39; &#39;</span>&lt;&lt; SIsymbol; used += 1 + strlen(SIsymbol); <span class="comment">// 1 for the space.</span>
<a name="l01915"></a>01915         }
<a name="l01916"></a>01916         <span class="comment">// 1 + for single space before symbol, as in 1.2 kV</span>
<a name="l01917"></a>01917         <span class="comment">// Only one symbol (da = deka) is two letters, or could use 1 + 1.</span>
<a name="l01918"></a>01918         <span class="comment">// Need to use strlen because SIsymbol is a char* and sizeof = 4 always.</span>
<a name="l01919"></a>01919       }
<a name="l01920"></a>01920     }
<a name="l01921"></a>01921     cerr &lt;&lt; <span class="stringliteral">&quot;, Total chars used &quot;</span> &lt;&lt; dec &lt;&lt; used &lt;&lt; endl;
<a name="l01922"></a>01922   }  <span class="comment">// value is finite.</span>
<a name="l01923"></a>01923 
<a name="l01924"></a>01924   os.iword(<a class="code" href="_test_quan1_8cpp.html#ad618eda6e95462f32dea23b4bb3e80ac">oldUncUsedIndex</a>) = os.iword(<a class="code" href="unc_init_8cpp.html#a540ce31a9e583612c03e63e1bc11cf82">uncUsedIndex</a>);
<a name="l01925"></a>01925   <span class="comment">// Save previous used.</span>
<a name="l01926"></a>01926   os.iword(<a class="code" href="unc_init_8cpp.html#a540ce31a9e583612c03e63e1bc11cf82">uncUsedIndex</a>) = <span class="keyword">static_cast&lt;</span><span class="keywordtype">long</span><span class="keyword">&gt;</span>(used);  <span class="comment">// Record width actually used.</span>
<a name="l01927"></a>01927   <span class="comment">// This is needed to calculate layout,</span>
<a name="l01928"></a>01928   <span class="comment">// Std behaviour is to return to default width.</span>
<a name="l01929"></a>01929   <span class="comment">// Field width reverts to its default behavior, width = 0</span>
<a name="l01930"></a>01930   <span class="comment">// (the necessary width) after one field has been printed.</span>
<a name="l01931"></a>01931   <span class="comment">// so must be last item before a ; to be read.  Not ideal!!</span>
<a name="l01932"></a>01932   <span class="comment">// os.width = savedWidth; // Restoring width is pointless.</span>
<a name="l01933"></a>01933   os.flags(savedFlags);  <span class="comment">// Restoring flags IS useful.</span>
<a name="l01934"></a>01934 } <span class="comment">// void uncertainPrint(double value, float stdDeviation,</span>
<a name="l01935"></a>01935   <span class="comment">// unsigned short int degFree, unsigned short int uncTypes, ostream&amp; os);</span>
<a name="l01936"></a>01936 
</pre></div></div><!-- contents -->
<!-- custom Doxygen footer checks_doxygen_footer.html  -->-

<!-- Copyright 2011 Pierre Talbot. -->
<!-- Distributed under the Boost Software License, Version 1.0. -->
<!-- (See accompanying file LICENSE_1_0.txt or copy at          -->
<!-- http://www.boost.org/LICENSE_1_0.txt)                      -->

<hr size="1"/>
<table width="100%">
<tbody>
  <tr>
   <address style="text-align: left;">
     <p>Use, modification and distribution are subject to the Boost Software License, Version 1.0.<br/>
     (See accompanying file LICENSE_1_0.txt or copy at&nbsp;
     <a href="http://www.boost.org/LICENSE_1_0.txt"> http://www.boost.org/LICENSE_1_0.txt </a>)</p>
      <!-- Change copyright to YOUR name (and affiliation, if any) below:  -->
     <p>Copyright  2012 Pierre Talbot</p>
      <!-- 2012 becomes the current year, for example 2010, so claims copyright for a range of years, 2009 - 2010. -->
     <p>Doxygen Documentation generated by&nbsp;<a href="http://www.doxygen.org/index.html"> <img src="doxygen.png" alt="doxygen logo" align="middle" border="0"/> 1.7.6.1</a>, Revised at Tue Jan 17 2012 12:29:03</p>
  </address>
  </tr>
</tbody>
</table>
  <!-- You can also add a footer logo, taking care that the location of the footer.png is correct. -->
  <!-- <img src="../images/my_footer.png" alt="Boost Doxygen documentation footer.png" -->
  </body> <!-- <body> is in doxygen_header.html -->
</html><!-- <html>  is in doxygen_header.html -->


